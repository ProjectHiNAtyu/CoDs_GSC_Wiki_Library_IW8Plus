// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    scripts\mp\killstreaks\killstreaks::registerkillstreak( "_encstr_A8DC0DC82B0B3A0D7D6EDD968EC686", ::tryusedeathswitchfromstruct );
    level.killstreak_laststand_func = ::deathswitch_startpayloadreleasesequence;
}

tryusedeathswitch()
{
    var_0 = scripts\cp_mp\utility\killstreak_utility::createstreakinfo( "_encstr_A8DC0DC82B0B3A0D7D6EDD968EC686", self );
    return tryusedeathswitchfromstruct( var_0 );
}

tryusedeathswitchfromstruct( var_0 )
{
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );

    if ( isdefined( level.killstreaktriggeredfunc ) )
    {
        if ( !level [[ level.killstreaktriggeredfunc ]]( var_0 ) )
            return 0;
    }

    level thread scripts\mp\battlechatter_mp::trysaylocalsound( self, "_encstr_A83C1775EBA3E7FF4840BD60539891FF1A6137C5FF62EAA21A" );
    var_1 = scripts\cp_mp\killstreaks\killstreakdeploy::streakdeploy_dogesturedeploy( var_0, getcompleteweaponname( "_encstr_9D3313529B97013B2ABBA89842C9C5998F24F0D9F0" ) );

    if ( !istrue( var_1 ) )
        return 0;

    if ( isdefined( level.killstreakbeginusefunc ) )
    {
        if ( !level [[ level.killstreakbeginusefunc ]]( var_0 ) )
            return 0;
    }

    scripts\cp_mp\utility\killstreak_utility::playkillstreakoperatordialog( "_encstr_9BE405709A9D69" + var_0.streakname, 1 );
    scripts\common\utility::_id_13E0A( level._id_11B2A, "_encstr_A8DC0DC82B0B3A0D7D6EDD968EC686", self.origin );
    thread scripts\mp\hud_util::teamplayercardsplash( "_encstr_9CC012ABB92B23D7322B0BE80DEBDCEED2E8C686", self );
    thread startdeathswitch( var_0 );
    return 1;
}

weapongivendeathswitch( var_0 )
{
    return 1;
}

startdeathswitch( var_0 )
{
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    self iprintlnbold( "_encstr_97C827A433045280CEB70823DE7737B080A472D608D1C2DA4BE6D9088E34AC5B04BBA58E43085B2B09" );
    scripts\mp\utility\perk::giveperk( "_encstr_9EAA160357C1E73CA33813DBB9D974EF9BB0948C65E96384" );
    self.killstreaklaststand = 1;
    self.deathswitchent = spawn( "_encstr_93DC0DCD1B272D3847AF5BED23B2C6", self gettagorigin( "_encstr_BCBB09D879945B182FC59D" ) );
    self.deathswitchent setmodel( "_encstr_A65C1354FFE9AFCA136BC1E7275BC0936E93BE6FBB" );
    self.deathswitchent.angles = self.angles;
    self.deathswitchent linkto( self, "_encstr_BCBB09D879945B182FC59D", ( 0, 0, 0 ), ( 0, 0, 0 ) );
    thread deathswitch_loopblinkinglight();
}

deathswitch_loopblinkinglight()
{
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    self endon( "_encstr_A144141932662B34872B1B5D5F1B1FB361FBAF894788" );

    for (;;)
    {
        self.deathswitchent setscriptablepartstate( "_encstr_B29B0FBA495C804FE75D4F173099D26863", "_encstr_9707035F3B", 0 );
        wait 0.5;
        self.deathswitchent setscriptablepartstate( "_encstr_B29B0FBA495C804FE75D4F173099D26863", "_encstr_9819045FD029", 0 );
    }
}

debugloc()
{
    self endon( "_encstr_A3750609A5E61883" );

    for (;;)
        waitframe();
}

deathswitch_startpayloadreleasesequence()
{
    var_0 = "_encstr_AF9310234B172F41E14FD8E8170D5BF7FAF2";
    scripts\cp_mp\utility\inventory_utility::_giveweapon( var_0, undefined, undefined, 1 );
    thread scripts\mp\laststand::switchtofists( var_0 );
    self.laststandactionset = "_encstr_A21015FC3FE35B5A6970922A998F14F3B89E6C7A45C97F";
    scripts\mp\playeractions::allowactionset( self.laststandactionset, 0 );
    thread deathswitch_payloadrelease( 3 );
    thread deathswitch_watchbleedout( 3 );
}

deathswitch_payloadrelease( var_0 )
{
    self endon( "_encstr_809410308F128BEDF308D13B38D1A7778B65" );
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    var_1 = 1;
    var_2 = scripts\mp\utility\weapon::_launchgrenade( "_encstr_98301612F9E78B44998F071169908CDF9E30DAEB6350A73A", self gettagorigin( "_encstr_8BE10B4DF5DA2C5A9B39B7EDE8" ), ( 0, 0, 0 ), var_0, 1 );
    var_2 linkto( self );
    thread deathswitch_payloadreleaseondeath( var_1, var_2 );
    var_3 = 1;

    while ( var_0 > 0 )
    {
        self iprintlnbold( "_encstr_8CFC19D07BF19B28A9296F2B7C1A4848F68F6D826CD9F023735AB7" + var_0 );
        var_0 = var_0 - var_3;
        playsoundatpos( self.origin, "_encstr_9F071212F9E78B44998F071169908CDF9E119ADB" );
        wait( var_3 );
        var_3 = var_3 - 0.2;

        if ( var_3 < 0.05 )
            var_3 = 0.05;
    }

    deathswitch_payloadreleasetype( var_1, var_2 );
}

deathswitch_payloadreleaseondeath( var_0, var_1 )
{
    self endon( "_encstr_809410308F128BEDF308D13B38D1A7778B65" );
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    self notify( "_encstr_AF8216586FB4A132614B874B7B76F179C718A1D149F808A8" );
    self endon( "_encstr_AF8216586FB4A132614B874B7B76F179C718A1D149F808A8" );
    self waittill( "_encstr_A3750609A5E61883" );
    deathswitch_payloadreleasetype( var_0, var_1 );
}

deathswitch_payloadreleasetype( var_0, var_1 )
{
    if ( isdefined( var_1 ) )
        var_1 delete();

    switch ( var_0 )
    {
        case 0:
            thread deathswitch_releaselocalexplosion();
            break;
        case 1:
            thread deathswitch_releaseartilleryexplosion();
            break;
        default:
            break;
    }

    self.killstreaklaststand = undefined;
    scripts\mp\utility\perk::removeperk( "_encstr_9EAA160357C1E73CA33813DBB9D974EF9BB0948C65E96384" );
    self notify( "_encstr_809410308F128BEDF308D13B38D1A7778B65" );
}

deathswitch_releaselocalexplosion()
{
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    self notify( "_encstr_A144141932662B34872B1B5D5F1B1FB361FBAF894788" );
    self.deathswitchent setscriptablepartstate( "_encstr_B29B0FBA495C804FE75D4F173099D26863", "_encstr_9819045FD029", 0 );
    self.deathswitchent setscriptablepartstate( "_encstr_AB0808DFB97F822F1899", "_encstr_9707035F3B", 0 );
    self.deathswitchent setentityowner( self );
    self.deathswitchent thread scripts\mp\utility\script::delayentdelete( 5 );
}

deathswitch_releaseartilleryexplosion()
{
    self endon( "_encstr_8A820B4696CDB1ED3737AC1B3A" );
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    self notify( "_encstr_A144141932662B34872B1B5D5F1B1FB361FBAF894788" );
    var_0 = self.origin + ( 0, 0, 20000 );
    var_1 = self.origin;
    var_2 = scripts\cp_mp\utility\weapon_utility::_magicbullet( getcompleteweaponname( "_encstr_A9FF15D192A3C918D12A33F8F350B01789FB28F261E0E3" ), var_0, var_1, self );
    self.deathswitchent setscriptablepartstate( "_encstr_B29B0FBA495C804FE75D4F173099D26863", "_encstr_9819045FD029", 0 );
    self.deathswitchent thread scripts\mp\utility\script::delayentdelete( 5 );
}

deathswitch_watchbleedout( var_0 )
{
    level endon( "_encstr_AD1D0BEF9161A06F1F684ADA39" );
    level endon( "_encstr_87DC14B3C0C903B191786B89AC8373FA90A51D5742F3" );
    scripts\cp_mp\hostmigration::hostmigration_waitlongdurationwithpause( var_0 );
    scripts\mp\utility\damage::_suicide();
}
