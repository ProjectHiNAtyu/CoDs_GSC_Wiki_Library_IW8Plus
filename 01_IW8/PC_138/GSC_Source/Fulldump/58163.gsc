// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

_id_12151( var_0 )
{
    self.spec = "soldier_lw_br";
    self allowedstances( "stand", "crouch" );
    self.dontmeleeme = 1;
    self.aggressivemode = 1;
    self.ignoresuppression = 1;
    self.disablepistol = 1;
    self.meleetryhard = 0;
    self.meleeignorefinalzdiff = 0;
    self.meleeignoreplayerstance = 1;
    self.dontsyncmelee = 1;
    self.disablebulletwhizbyreaction = 1;
    self.neversprintforvariation = 1;
    self.disabledodge = 1;
    self.disablelmgmount = 1;
    self.binoculars_istargetinrange = 1;
    self.combat_func_active = 1;
    self.brtruck_initdialog = 1;
    self.combatmode = "no_cover";
    self.minpaindamage = 200;
    self.meleechargedistvsplayer = 120;
    self.meleechargedist = 120;
    self.meleemaxzdiff = 500;
    self.meleetargetallowedoffmeshdistsq = squared( 50 );
    self.setup_bot_brtdm = 0.5;
    self.pathenemyfightdist = 192;
    self.runngun = 1;
    self.combatrecordsupermisc = 2000;
    self.combatrecordincrementkillstreakextrastat = 100;
    self.spawned_warp_traversethink = 0;
    self.takelaststandtransitionweapon = squared( 730 );
    self.meleebashmaxdistsq = squared( 90 );
    self.fnshouldplaypainanim = ::_id_12161;
    self.isoutside = ::_id_1214B;

    if ( isdefined( self.a ) )
        self.a.disablelongdeath = 1;

    scripts\engine\utility::set_movement_speed( 120 );

    if ( !threatbiasgroupexists( "soldier_lw_br" ) )
    {
        createthreatbiasgroup( "soldier_lw_br" );
        setignoremegroup( "Lethal_Static", "soldier_lw_br" );
    }

    self setthreatbiasgroup( "soldier_lw_br" );
    self disableexecutionvictim();
    self _meth_87BA( gettime() + randomintrange( 1000, 2000 ) );

    if ( self isscriptable() )
        thread initscriptable();
}

initscriptable()
{
    self setscriptablepartstate( "notetrack_handler", "active", 0 );
}

_id_12153( var_0 )
{
    scripts\aitypes\combat_mp::initcombatfunctions_mp( var_0 );
    self.minexposedgrenadedist = 450;
    return anim.success;
}

_id_12150( var_0, var_1 )
{
    if ( !isdefined( self.grenadeweapon ) || self.grenadeweapon.basename != var_0 )
        self.grenadeweapon = getcompleteweaponname( var_0 );

    self.grenadeammo = var_1;
}

_id_1214C()
{
    if ( isdefined( self.favoriteenemy ) && isalive( self.favoriteenemy ) )
        return self.favoriteenemy;

    return self.enemy;
}

_id_1214F()
{
    return "fast";
}

_id_1215B( var_0 )
{
    if ( !isdefined( var_0 ) )
        return;

    self.mover_init = var_0;
}

_id_1214A( var_0, var_1 )
{
    self.spawned_warp_traversethink = gettime() + randomintrange( var_0, var_1 );
}

_id_1214E( var_0 )
{
    var_1 = self.goalradius * 0.66;
    var_2 = [ var_0.origin + ( 0.5, 0.5, 0 ) * var_1, var_0.origin + ( 0.5, -0.5, 0 ) * var_1, var_0.origin + ( -0.5, 0.5, 0 ) * var_1, var_0.origin + ( -0.5, -0.5, 0 ) * var_1 ];
    var_3 = [];

    foreach ( var_5 in var_2 )
    {
        var_6 = getrandomnavpoint( var_5, var_1 * 0.5, self );

        if ( isdefined( var_6 ) )
            var_3[var_3.size] = var_6;
    }

    if ( var_3.size > 0 )
        return var_3[randomint( var_3.size )];

    var_6 = var_0 getpointinbounds( randomfloatrange( -1, 1 ), randomfloatrange( -1, 1 ), 0 );
    return self getclosestreachablepointonnavmesh( var_6 );
}

_id_1214D( var_0 )
{
    var_1 = var_0.enemy;

    if ( !isdefined( var_1 ) )
    {
        if ( isdefined( var_0.mortars_get_player_targeted ) )
        {
            var_0.mortars_get_available_players = 1;
            return _id_1214E( var_0.mortars_get_player_targeted );
        }

        var_0.mortars_get_available_players = 0;
        return self.origin;
    }

    if ( isdefined( var_0.mortars_get_player_targeted ) && isdefined( self.takelaststandtransitionweapon ) )
    {
        var_2 = distance2dsquared( var_0.mortars_get_player_targeted.origin, self.origin );

        if ( var_2 >= self.takelaststandtransitionweapon )
        {
            var_0.mortars_get_available_players = 1;
            return _id_1214E( var_0.mortars_get_player_targeted );
        }
    }

    var_3 = var_1.origin - self.origin;
    var_4 = length2d( var_3 );
    var_5 = scripts\engine\utility::ter_op( var_4 > 400, ( var_4 - 400 ) / 330, 0.0 );
    var_5 = clamp( var_5, 0, 0.85 );

    if ( randomfloat( 1.0 ) < var_5 )
    {
        var_0.mortars_get_available_players = 3;
        return var_1.origin;
    }

    if ( randomfloat( 1.0 ) < 0.66 )
    {
        var_6 = vectortoangles( var_3 );
        var_7 = scripts\engine\utility::ter_op( randomfloat( 1.0 ) > 0.5, 1.0, -1.0 );
        var_8 = self.origin + anglestoright( var_6 ) * 150 * var_7;
        var_9 = getclosestpointonnavmesh( var_8, self );
        var_0.mortars_get_available_players = 2;
        return var_9;
    }

    var_0.mortars_get_available_players = 0;
    return self.origin;
}

_id_12161()
{
    if ( !isdefined( self.a.paintime ) || !isdefined( self.combatrecordincrementkillstreakextrastat ) || !isdefined( self.combatrecordsupermisc ) )
        return 1;

    if ( gettime() - self.a.paintime < self.combatrecordsupermisc )
        return 0;

    return randomfloat( 100 ) < self.combatrecordincrementkillstreakextrastat;
}

_id_1215C( var_0 )
{
    if ( !isdefined( self.enemy ) )
        return anim.success;

    return scripts\aitypes\combat::shoot_update( var_0 );
}

_id_12154( var_0 )
{
    if ( !isdefined( self.weapon ) )
        return anim.failure;

    var_1 = scripts\aitypes\combat::shouldshoot();

    if ( var_1 )
    {
        var_2 = isdefined( self.enemy ) && isdefined( self.enemy.vehicle ) && isdefined( self.enemy.vehicle.vehiclename );

        if ( var_2 && istrue( self.dontgiveuponsuppression ) && isdefined( self.goodshootpos ) )
            return anim.success;

        var_1 = scripts\aitypes\combat::calcgoodshootpos();
    }
    else
        self.goodshootpos = undefined;

    if ( !var_1 )
        return anim.failure;

    return anim.success;
}

_id_1215E( var_0 )
{
    if ( istrue( self.clean_up_search ) )
        return 0;

    var_1 = _id_1214C();

    if ( isdefined( var_1 ) )
    {
        if ( !issentient( var_1 ) )
            return 0;

        if ( self lastknowntime( var_1 ) <= 0 )
            return 0;
    }

    if ( gettime() < self.spawned_warp_traversethink )
        return 0;

    if ( isdefined( self.melee ) )
    {
        self.closestquad = gettime();
        return 0;
    }

    if ( scripts\asm\asm_bb::bb_throwgrenaderequested() )
        return 0;

    return 1;
}

_id_12146( var_0 )
{
    var_1 = _id_1214C();
    var_2 = spawnstruct();
    var_2.enemy = var_1;
    var_2.spawndogtagtoken = 0;
    var_2.mortars_get_player_targeted = self getgoalvolume();
    var_2.mortars_get_available_players = 0;

    if ( isdefined( self._id_11C59 ) )
    {
        var_2.goalpos = self._id_11C59;
        self setbtgoalpos( 0, var_2.goalpos );
        self._id_11C59 = undefined;
    }

    self aisettargetspeed( 120 );
    scripts\engine\utility::set_movement_speed( 120 );
    self.bt.instancedata[var_0] = var_2;
}

_id_12145( var_0 )
{
    var_1 = self.bt.instancedata[var_0];
    var_1.mortars_get_player_targeted = self getgoalvolume();
    var_2 = _id_1214C();
    var_3 = isdefined( self.closestquad ) && gettime() - self.closestquad < 1000;

    if ( var_3 || !isdefined( var_2 ) )
    {
        self setbtgoalpos( 0, self.origin );
        self setbtgoalradius( 0, 35 );
        var_1.mortars_get_available_players = 0;
        return anim.running;
    }

    var_4 = gettime();

    if ( var_4 >= var_1.spawndogtagtoken )
    {
        var_5 = !( isdefined( var_2 ) && isdefined( var_1.enemy ) && var_2 == var_1.enemy );
        var_1.enemy = var_2;

        if ( var_5 || !self aipointinfov( var_2.origin ) )
        {
            _id_1214A( 2000, 3000 );
            self setbtgoalpos( 0, self.origin );
            var_1.mortars_get_available_players = 0;
            return anim.running;
        }

        var_6 = self pathdisttogoal();
        var_7 = var_1.mortars_get_available_players == 2 && var_6 < 35;
        var_8 = var_1.mortars_get_available_players == 1 && var_6 < 35;

        if ( var_7 || var_8 )
        {
            var_1.mortars_get_available_players = 0;
            _id_1214A( 4000, 10000 );
        }

        var_9 = var_1.mortars_get_available_players == 3 && var_6 <= 400;
        var_10 = var_1.mortars_get_available_players == 0 && var_4 >= self.spawned_warp_traversethink;

        if ( var_9 || var_10 )
            var_1.goalpos = _id_1214D( var_1 );

        var_1.spawndogtagtoken = var_4 + 500;
    }

    var_11 = isdefined( var_2 ) && self cansee( var_2 ) && self canshootenemy( 249, 1, 1 );

    if ( var_11 )
        self getenemyinfo( var_2 );

    var_12 = isdefined( var_2 ) && isdefined( var_2.vehicle ) && isdefined( var_2.vehicle.vehiclename );

    if ( var_12 )
    {
        self.dontgiveuponsuppression = 1;
        self.goodshootpos = var_2 getshootatpos();
    }
    else
        self.dontgiveuponsuppression = 0;

    if ( !isdefined( var_1.goalpos ) )
    {
        var_1.goalpos = self.origin;
        var_1.mortars_get_available_players = 0;
    }

    self setbtgoalpos( 0, var_1.goalpos );
    self aisettargetspeed( 120 );
    scripts\engine\utility::set_movement_speed( 120 );
    return anim.running;
}

_id_12147( var_0 )
{
    self.bt.instancedata[var_0] = undefined;

    if ( scripts\asm\asm_bb::bb_throwgrenaderequested() )
    {
        self._id_11C59 = self.goalpos;
        self setbtgoalpos( 0, self.origin );
    }

    scripts\common\utility::demeanor_override( "combat" );
    self.moveplaybackrate = 1;
}

_id_12148( var_0 )
{

}

_id_12160( var_0 )
{
    if ( istrue( self.clean_up_search ) )
        return 0;

    if ( !isdefined( self getgoalvolume() ) )
        return 0;

    return 1;
}

_id_12157( var_0 )
{
    var_1 = spawnstruct();
    var_1.mortars_get_player_targeted = self getgoalvolume();
    var_1.goalpos = self.origin;
    var_1.mortars_get_available_players = 0;

    if ( !ispointinvolume( self getapproxeyepos(), var_1.mortars_get_player_targeted ) )
    {
        var_1.goalpos = self getclosestreachablepointonnavmesh( var_1.mortars_get_player_targeted.origin );
        var_1.spawndropbagatposition = var_1.goalpos;
        var_1.mortars_get_available_players = 1;
    }

    self.bt.instancedata[var_0] = var_1;
}

_id_12156( var_0 )
{
    var_1 = self.bt.instancedata[var_0];
    var_2 = var_1.mortars_get_available_players;
    var_3 = _id_1214C();

    if ( isdefined( var_3 ) )
    {
        _id_1214A( 2000, 3000 );
        self setbtgoalpos( 0, self.origin );
        self getenemyinfo( var_3 );
        return anim.success;
    }

    var_4 = self pathdisttogoal();
    var_5 = var_2 == 1 && ispointinvolume( self getapproxeyepos(), var_1.mortars_get_player_targeted );
    var_6 = var_2 == 2 && self.goalpos == var_1.goalpos && var_4 <= 35;

    if ( var_5 || var_6 )
    {
        var_1.spawndropbagatposition = _id_1214E( var_1.mortars_get_player_targeted );

        if ( var_2 == 2 )
        {
            _id_1214A( 4500, 10000 );
            var_1.mortars_get_available_players = 0;
        }
    }

    if ( isdefined( var_1.spawndropbagatposition ) )
        self.smartfacingpos = var_1.spawndropbagatposition;

    var_7 = var_1.mortars_get_available_players == 0 && gettime() > self.spawned_warp_traversethink;

    if ( ( var_5 || var_7 ) && isdefined( var_1.spawndropbagatposition ) )
    {
        var_1.goalpos = var_1.spawndropbagatposition;
        var_1.mortars_get_available_players = 2;
        var_1.spawndropbagatposition = undefined;
    }

    self setbtgoalpos( 0, var_1.goalpos );
    self aisettargetspeed( 120 );
    scripts\engine\utility::set_movement_speed( 120 );
    return anim.running;
}

_id_12158( var_0 )
{
    var_1 = self.bt.instancedata[var_0];

    if ( isdefined( _id_1214C() ) )
    {
        if ( scripts\asm\asm_bb::bb_throwgrenaderequested() )
            self setbtgoalpos( 0, self.origin );

        self.spawned_warp_traversethink = 0;
    }

    self.bt.instancedata[var_0] = undefined;
}

_id_12149( var_0 )
{

}

_id_1215A()
{
    self.bt.disable_heli_lights = gettime() + randomintrange( 2000, 10000 );
}

_id_1215D( var_0 )
{
    if ( !isdefined( self.bt.disable_heli_lights ) )
        _id_1215A();

    if ( self.currentpose == "crouch" && scripts\asm\asm_bb::bb_meleerequested() )
        return anim.success;

    if ( self pathdisttogoal() > self.goalradius )
        return anim.failure;

    if ( gettime() < self.bt.disable_heli_lights )
        return anim.failure;

    return anim.success;
}

_id_12152( var_0 )
{
    var_1 = undefined;

    if ( self.currentpose != "crouch" || scripts\asm\asm_bb::bb_getrequestedstance() != "crouch" )
        var_1 = "crouch";
    else
        var_1 = "stand";

    scripts\asm\asm_bb::bb_requeststance( var_1 );
}

_id_1213D( var_0 )
{
    if ( scripts\asm\asm::asm_ephemeraleventfired( "cover_stance_trans", "end" ) )
        return anim.success;

    var_1 = 5000;

    if ( gettime() - self.bt.disable_heli_lights > var_1 )
        return anim.success;

    if ( self.currentpose == scripts\asm\asm_bb::bb_getrequestedstance() )
        return anim.success;

    return anim.running;
}

_id_12164( var_0 )
{
    scripts\asm\asm_bb::bb_requeststance( self.currentpose );
    _id_1215A();
}

_id_12165( var_0 )
{
    scripts\asm\asm_bb::bb_requestthrowgrenade( 1, self.enemy );
    self.bt.instancedata[var_0] = spawnstruct();
    self.bt.instancedata[var_0].timeout = gettime() + 6000;
}

_id_12166( var_0 )
{
    scripts\asm\asm_bb::bb_requestthrowgrenade( 0 );
    self.bt.instancedata[var_0] = undefined;
    self.a.nextgrenadetrytime = gettime() + 3000;
}

_id_1213C( var_0 )
{
    if ( self.arriving )
        return anim.failure;

    if ( nullweapon( self.grenadeweapon ) )
        return anim.failure;

    if ( isdefined( self.isspecialiststreak ) )
    {
        if ( scripts\aitypes\throwgrenade::grenadethrowvaliditycheck( level.player, 200 ) )
            return anim.success;
    }

    if ( isdefined( self.enemy ) && isdefined( self.enemy.dontgrenademe ) && self.enemy.dontgrenademe )
        return anim.failure;

    if ( istrue( self.dontevershoot ) )
        return anim.failure;

    if ( isdefined( self.enemy ) && scripts\aitypes\throwgrenade::grenadethrowvaliditycheck( self.enemy, self.minexposedgrenadedist ) )
        return anim.success;

    return anim.failure;
}

_id_1213A( var_0 )
{
    var_1 = self getposoutsidebadplace( 128.0 );

    if ( isdefined( var_1 ) )
    {
        self setbtgoalpos( 2, var_1 );
        self._blackboard.badplaceavoidstarttime = gettime();
        return anim.success;
    }

    return anim.failure;
}

_id_1214B( var_0 )
{
    var_1 = undefined;

    if ( istrue( self.brtruck_initdialog ) )
    {
        var_2 = [];
        var_2[0] = self;
        var_3 = self geteye() - ( 0, 0, 16 );
        var_4 = var_0 geteye() - ( 0, 0, 16 );
        var_5 = scripts\engine\trace::sphere_trace( var_3, var_4, 4, var_2 );

        if ( var_5["fraction"] < 1 )
        {
            var_6 = var_5["entity"];

            if ( isdefined( var_6 ) )
                var_1 = var_6;
        }
    }
    else if ( isenemyinfrontofme( var_0, self.setup_bot_brtdm ) || propminigameupdateshowwinner( var_0 ) )
        var_1 = var_0;

    if ( isdefined( var_1 ) && isalive( var_1 ) )
    {
        var_7 = 30;

        if ( isdefined( self.meleedamageoverride ) )
            var_7 = self.meleedamageoverride;
        else if ( nullweapon( self.weapon ) )
            var_7 = self.unarmedmeleedamageoverride;

        if ( scripts\common\utility::isprotectedbyriotshield( var_1 ) )
            return undefined;

        if ( isplayer( var_1 ) && var_1 scripts\common\utility::isprotectedbyaxeblock( self ) )
            return undefined;

        var_1 dodamage( var_7, self.origin, self, self, "MOD_MELEE", self.weapon );
        return var_1;
    }

    return undefined;
}

isenemyinfrontofme( var_0, var_1 )
{
    var_2 = vectornormalize( ( var_0.origin - self.origin ) * ( 1, 1, 0 ) );
    var_3 = anglestoforward( self.angles );
    var_4 = vectordot( var_2, var_3 );
    return var_4 > var_1;
}

propminigameupdateshowwinner( var_0 )
{
    var_1 = self.origin[2] + self.height;

    if ( var_0.origin[2] < var_1 )
        return 0;

    var_2 = self.origin[2] + self.height + 2 * self.radius;

    if ( var_0.origin[2] > var_2 )
        return 0;

    if ( isplayer( var_0 ) )
    {
        var_3 = var_0 getvelocity()[2];

        if ( abs( var_3 ) > 12 )
            return 0;
    }

    var_4 = 15.0;

    if ( isdefined( var_0.radius ) )
        var_4 = var_0.radius;

    var_5 = self.radius + var_4;
    var_5 = var_5 * var_5;

    if ( distance2dsquared( self.origin, var_0.origin ) > var_5 )
        return 0;

    return 1;
}
