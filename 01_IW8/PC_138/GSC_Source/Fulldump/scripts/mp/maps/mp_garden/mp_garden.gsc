// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    scripts\mp\maps\mp_garden\mp_garden_precache::main();
    scripts\mp\maps\mp_garden\gen\mp_garden_art::main();
    scripts\mp\maps\mp_garden\mp_garden_fx::main();
    scripts\mp\maps\mp_garden\mp_garden_lighting::main();
    scripts\mp\load::main();
    level.music_style = "england";
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    level.kill_border_triggers = getentarray( "kill_border_trigger", "targetname" );
    scripts\mp\compass::setupminimap( "compass_map_mp_garden", "codcaster_compass_map_mp_garden" );
    setdvar( "PKKMTTRQO", 8 );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "urban";
    game["axis_outfit"] = "woodland";
    thread _id_11F95();
    thread outofboundstimebr();
    thread play_movie( "mp_garden_tv" );
    thread hide_headicon();
    thread getlocalestructarray( "policeCarWithLights", "policecarlgt", 0 );
    thread getlocalestructarray( "destructVan", "redvan", 1 );
    scripts\mp\flags::levelflagwait( "scriptables_ready" );
    wait 10.0;
    scripts\engine\utility::array_thread( getscriptablearray( "scriptable_veh8_civ_lnd_victor40_police_mp_piccadilly", "classname" ), ::_id_12C99 );
}

outofboundstimebr()
{
    level waittill( "infil_setup_complete" );

    if ( scripts\mp\flags::gameflag( "infil_will_run" ) )
    {
        var_0 = getent( "infilCones", "targetname" );
        var_0 hide();
    }
    else
    {
        var_1 = getent( "infil_van_col", "targetname" );

        if ( isdefined( var_1 ) )
            var_1 hide();
    }
}

helperdrone_watchscramblereffectdist()
{
    var_0 = easepower( "maphint_offering", level.startingcodephone.origin );
    waitframe();
    scripts\engine\scriptable::_id_11CDB( "maphint_offering", ::set_relic_headbullets );

    for (;;)
    {
        level waittill( "OfferingPlaced" );
        hideallunselectedextractpads();
        wait 20;
        var_0 setscriptablepartstate( "maphint_offering", "on" );
    }
}

hide_headicon()
{
    level.startingcodephone = scripts\engine\utility::getstruct( "offeringLoc", "targetname" );
    level.doexfilallyidle = getent( "cheese", "targetname" );
    level.doexfilallyidle hide();
    level.dogtag_collected_lap = getent( "cheeseWedge", "targetname" );
    level.dogtag_collected_lap.tacinsert_deleteontoofar = level.dogtag_collected_lap.origin;
    level.dogtag_collected_lap.originalangles = level.dogtag_collected_lap.angles;
    level.dogtag_collected_lap hide();
    level.doextractionevent = scripts\engine\utility::getstructarray( "cheeseLoc", "targetname" );
    level.doextractionevent = scripts\engine\utility::array_randomize( level.doextractionevent );
    level.doexfilallyidle.origin = level.doextractionevent[0].origin;
    level.doexfilallyidle.angles = level.doextractionevent[0].angles;
    level.spawn_another_group_and_run_regular_death = getentarray( "mouseTrap", "targetname" );
    level.spawn_and_hide_usb = scripts\engine\utility::getstructarray( "mouseTrapLoc", "targetname" );

    foreach ( var_1 in level.spawn_and_hide_usb )
    {
        if ( var_1.origin == ( 362.93, -1485.9, 0 ) )
            var_1.origin = ( 358.93, -1465.9, 0 );
    }

    level.spawn_and_hide_usb = scripts\engine\utility::array_randomize( level.spawn_and_hide_usb );
    level.spawn_apache_chopper = 0;
    var_3 = 0;

    foreach ( var_5 in level.spawn_another_group_and_run_regular_death )
    {
        var_5.origin = level.spawn_and_hide_usb[var_3].origin;
        var_5.angles = level.spawn_and_hide_usb[var_3].angles;
        var_5.fx = scripts\engine\utility::spawn_tag_origin();
        var_5.fx.origin = var_5.origin;
        var_5.fx.angles = var_5.angles;
        var_5.fx show();
        thread spawn_assault2_extras( var_5 );
        var_3++;
    }

    level.defenderflagreset = getentarray( "candle", "targetname" );
    level.defenderflagreset = scripts\engine\utility::array_randomize( level.defenderflagreset );

    foreach ( var_8 in level.defenderflagreset )
    {
        var_8.fx = scripts\engine\utility::spawn_tag_origin();
        var_8.fx.origin = var_8.origin;
        var_8.fx.angles = var_8.angles;
        var_8.fx show();
        var_8 hide();
    }

    while ( level.spawn_apache_chopper < 5 )
        level waittill( "TrapFound" );

    level.dogtag_visibility_watcher = easepower( "maphint_cheese2", level.dogtag_collected_lap.origin + ( 0, 0, 6 ) );
    waitframe();
    scripts\engine\scriptable::_id_11CDB( "maphint_cheese2", ::set_relic_fastbleedout );
    level waittill( "CheeseWedgeTaken" );
    level.dogtag_collected_lap hide();
    level.doexfilallyidle show();
    level.dogtag_collected = easepower( "maphint_cheese", level.doexfilallyidle.origin + ( 0, 0, 6 ) );
    waitframe();
    scripts\engine\scriptable::_id_11CDB( "maphint_cheese", ::set_relic_focus_fire );
    level waittill( "CheeseTaken" );
    level.doexfilallyidle hide();
    var_10 = easepower( "maphint_offering", level.startingcodephone.origin );
    waitframe();
    scripts\engine\scriptable::_id_11CDB( "maphint_offering", ::set_relic_headbullets );
    level waittill( "OfferingPlaced" );
    hideallunselectedextractpads();
}

spawn_assault2_extras( var_0 )
{
    var_0 setcandamage( 1 );
    var_0 waittill( "damage", var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 );
    var_0 hide();
    level.spawn_apache_chopper++;

    if ( level.spawn_apache_chopper < 5 )
    {
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_trap" ), var_0.fx, "tag_origin" );
        var_0 playsound( "mp_garden_pp_rat_trap" );
    }
    else
    {
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_trap_final" ), var_0.fx, "tag_origin" );
        var_0 playsound( "mp_garden_pp_rat_trap_final" );
        level.dogtag_collected_lap.origin = var_0.origin;
        level.dogtag_collected_lap.angles = var_0.angles;
        waittillframeend;
        level.dogtag_collected_lap show();
    }

    level notify( "TrapFound" );
}

hideallunselectedextractpads()
{
    level.doexfilallyidle.origin = level.startingcodephone.origin;
    level.doexfilallyidle.angles = level.startingcodephone.angles;
    level.dogtag_collected_lap.origin = level.dogtag_collected_lap.tacinsert_deleteontoofar;
    level.dogtag_collected_lap.angles = level.dogtag_collected_lap.originalangles;
    waittillframeend;
    level.doexfilallyidle show();
    wait 0.3;

    foreach ( var_1 in level.defenderflagreset )
    {
        var_1 show();
        waittillframeend;
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_candle_poof" ), var_1.fx, "tag_origin" );
        wait 0.1;
    }

    level.dogtag_collected_lap show();
    wait 1;
    scripts\engine\utility::exploder( "pied_piper" );
    wait 15;
    level.doexfilallyidle hide();

    foreach ( var_1 in level.defenderflagreset )
    {
        killfxontag( scripts\engine\utility::getfx( "vfx_garden_candle_poof" ), var_1.fx, "tag_origin" );
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_trap_final" ), var_1.fx, "tag_origin" );
        wait 0.01;
        var_1 hide();
    }
}

set_relic_headbullets( var_0, var_1, var_2, var_3, var_4 )
{
    level thread add_veh_spawners_to_passive_wave_spawning( var_0, var_1, var_2, var_3, var_4 );
}

add_veh_spawners_to_passive_wave_spawning( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_2 == "on" )
    {
        var_0 setscriptablepartstate( "maphint_offering", "off" );
        var_3 playlocalsound( "ui_interact_cheese" );
        wait 0.3;
        level notify( "OfferingPlaced" );
    }
}

set_relic_focus_fire( var_0, var_1, var_2, var_3, var_4 )
{
    level thread add_to_spotlight_array( var_0, var_1, var_2, var_3, var_4 );
}

add_to_spotlight_array( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_2 == "on" )
    {
        var_0 setscriptablepartstate( "maphint_cheese", "off" );
        var_3 playlocalsound( "ui_interact_cheese_pickup" );
        level notify( "CheeseTaken" );
    }
}

set_relic_fastbleedout( var_0, var_1, var_2, var_3, var_4 )
{
    level thread add_to_spawnflags( var_0, var_1, var_2, var_3, var_4 );
}

add_to_spawnflags( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_2 == "on" )
    {
        var_0 setscriptablepartstate( "maphint_cheese2", "off" );
        level notify( "CheeseWedgeTaken" );
    }
}

play_movie( var_0 )
{
    if ( getdvarint( "LLQQOPKTKM" ) == 1 )
        return;

    for (;;)
    {
        playcinematicforalllooping( var_0 );
        wait 3;
    }
}

_id_11F95()
{
    wait 1;
    var_0 = getentarray( "Train", "targetname" );
    level._id_12851 = 15;
    wait( level._id_12851 );

    foreach ( var_2 in var_0 )
    {
        switch ( var_2.script_noteworthy )
        {
            case "front":
                playfxontag( level._effect["vfx_garden_train_headlight"], var_2, "TAG_TRAIN_LIGHT_FRONT_4" );
                playfxontag( level._effect["vfx_garden_train_headlight"], var_2, "TAG_TRAIN_LIGHT_FRONT_2" );
                break;
            case "mid":
                break;
            case "back":
                playfxontag( level._effect["vfx_garden_train_taillight"], var_2, "TAG_TRAIN_LIGHT_FRONT_4" );
                playfxontag( level._effect["vfx_garden_train_taillight"], var_2, "TAG_TRAIN_LIGHT_FRONT_2" );
                break;
            default:
                break;
        }

        thread _id_12849( var_2 );
        var_2 thread _id_12819();
    }
}

_id_12849( var_0 )
{
    var_1 = 0.00125;
    var_2 = scripts\engine\utility::getstruct( var_0.target, "targetname" );
    var_2 = scripts\engine\utility::getstruct( var_2.target, "targetname" );

    for (;;)
    {
        var_3 = abs( distance( var_0.origin, var_2.origin ) * var_1 );
        var_0 moveto( var_2.origin, var_3, 0, 0 );

        if ( isdefined( var_0.script_noteworthy ) && var_0.script_noteworthy == "back" )
            var_0 rotateto( var_2.angles + ( 0, 180, 0 ), var_3, 0, 0 );
        else
            var_0 rotateto( var_2.angles, var_3, 0, 0 );

        var_2 = scripts\engine\utility::getstruct( var_2.target, "targetname" );
        wait( var_3 );

        if ( isdefined( var_2.script_noteworthy ) && var_2.script_noteworthy == "teleport" )
        {
            var_0.origin = var_2.origin;

            if ( isdefined( var_0.script_noteworthy ) && var_0.script_noteworthy == "back" )
                var_0.angles = var_2.angles + ( 0, 180, 0 );
            else
                var_0.angles = var_2.angles;

            if ( isdefined( var_0.script_noteworthy ) && var_0.script_noteworthy == "front" )
                level._id_12851 = randomint( 30 );

            switch ( var_0.script_noteworthy )
            {
                case "front":
                    killfxontag( level._effect["vfx_garden_train_headlight"], var_0, "TAG_TRAIN_LIGHT_FRONT_4" );
                    killfxontag( level._effect["vfx_garden_train_headlight"], var_0, "TAG_TRAIN_LIGHT_FRONT_2" );
                    break;
                case "mid":
                    break;
                case "back":
                    killfxontag( level._effect["vfx_garden_train_taillight"], var_0, "TAG_TRAIN_LIGHT_FRONT_4" );
                    killfxontag( level._effect["vfx_garden_train_taillight"], var_0, "TAG_TRAIN_LIGHT_FRONT_2" );
                    break;
                default:
                    break;
            }

            wait( level._id_12851 );

            switch ( var_0.script_noteworthy )
            {
                case "front":
                    playfxontag( level._effect["vfx_garden_train_headlight"], var_0, "TAG_TRAIN_LIGHT_FRONT_4" );
                    playfxontag( level._effect["vfx_garden_train_headlight"], var_0, "TAG_TRAIN_LIGHT_FRONT_2" );
                    break;
                case "mid":
                    break;
                case "back":
                    playfxontag( level._effect["vfx_garden_train_taillight"], var_0, "TAG_TRAIN_LIGHT_FRONT_4" );
                    playfxontag( level._effect["vfx_garden_train_taillight"], var_0, "TAG_TRAIN_LIGHT_FRONT_2" );
                    break;
                default:
                    break;
            }

            var_2 = scripts\engine\utility::getstruct( var_2.target, "targetname" );
        }
    }
}

_id_12C99()
{
    level endon( "game_ended" );
    wait( randomfloat( 2 ) );

    if ( self getscriptablehaspart( "lights_controller" ) )
    {
        if ( self getscriptableparthasstate( "lights_controller", "siren_off" ) )
            self setscriptablepartstate( "lights_controller", "siren_off" );
    }

    self.runcontrolledcallback = scripts\engine\utility::spawn_tag_origin();
    self.runcontrolledcallback.origin = self gettagorigin( "tag_body_animate" );
    self.runcontrolledcallback.angles = self gettagangles( "tag_body_animate" );
    self.runcontrolledcallback show();
    self.runcontrolledcallback linkto( self, "tag_body_animate" );
    waitframe();

    if ( self.classname == "scriptable_veh8_civ_lnd_victor40_police_mp_piccadilly" )
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_police_lights" ), self.runcontrolledcallback, "tag_origin" );
    else
        return;

    for (;;)
    {
        self waittill( "scriptableNotification", var_0 );

        if ( var_0 == "vehicle_death" || var_0 == "anim_explosion" || var_0 == "anim_explosion_complete" )
        {
            if ( self.classname == "scriptable_veh8_civ_lnd_victor40_police_mp_piccadilly" )
                killfxontag( scripts\engine\utility::getfx( "vfx_garden_police_lights" ), self.runcontrolledcallback, "tag_origin" );

            self.runcontrolledcallback delete();
            break;
        }
    }
}

getlocalestructarray( var_0, var_1, var_2 )
{
    level endon( "game_ended" );
    wait 10;
    var_3 = getscriptablearray( var_0, "targetname" );
    var_4 = getentarray( var_1, "targetname" );

    if ( var_2 )
    {
        var_3[0].oic_firstspawn = scripts\engine\utility::spawn_tag_origin();
        var_3[0].oic_firstspawn.origin = var_3[0] gettagorigin( "tag_light_front_right" );
        var_3[0].oic_firstspawn.angles = var_3[0] gettagangles( "tag_light_front_right" );
        var_3[0].oic_firstspawn show();
        var_3[0].oic_firstspawn linkto( var_3[0], "tag_light_front_right" );
        var_3[0].ogflaresreservecount = scripts\engine\utility::spawn_tag_origin();
        var_3[0].ogflaresreservecount.origin = var_3[0] gettagorigin( "tag_light_front_Left" );
        var_3[0].ogflaresreservecount.angles = var_3[0] gettagangles( "tag_light_front_Left" );
        var_3[0].ogflaresreservecount show();
        var_3[0].ogflaresreservecount linkto( var_3[0], "tag_light_front_Left" );
        var_3[0]._id_12618 = scripts\engine\utility::spawn_tag_origin();
        var_3[0]._id_12618.origin = var_3[0] gettagorigin( "tag_light_back_right" );
        var_3[0]._id_12618.angles = var_3[0] gettagangles( "tag_light_back_right" );
        var_3[0]._id_12618 show();
        var_3[0]._id_12618 linkto( var_3[0], "tag_light_back_right" );
        var_3[0]._id_12617 = scripts\engine\utility::spawn_tag_origin();
        var_3[0]._id_12617.origin = var_3[0] gettagorigin( "tag_light_back_Left" );
        var_3[0]._id_12617.angles = var_3[0] gettagangles( "tag_light_back_Left" );
        var_3[0]._id_12617 show();
        var_3[0]._id_12617 linkto( var_3[0], "tag_light_back_Left" );
        waitframe();
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_right" ), var_3[0].oic_firstspawn, "tag_origin" );
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_left" ), var_3[0].ogflaresreservecount, "tag_origin" );
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_right" ), var_3[0]._id_12618, "tag_origin" );
        playfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_left" ), var_3[0]._id_12617, "tag_origin" );
    }

    if ( isdefined( var_3 ) && isdefined( var_3[0] ) )
    {
        var_5 = var_3[0];
        var_6 = 1;

        while ( var_6 )
        {
            var_5 waittill( "scriptableNotification", var_7, var_8 );

            switch ( var_7 )
            {
                case "onfire":
                case "flareup":
                case "vehicle_death":
                    trucklightsoff( var_4 );

                    if ( var_2 )
                    {
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_right" ), var_3[0].oic_firstspawn, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_left" ), var_3[0].ogflaresreservecount, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_right" ), var_3[0]._id_12618, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_left" ), var_3[0]._id_12617, "tag_origin" );
                    }

                    var_6 = 0;
                    return;
                case "anim_explosion":
                    trucklightsoff( var_4 );

                    if ( var_2 )
                    {
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_right" ), var_3[0].oic_firstspawn, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_headlight_lensflare_left" ), var_3[0].ogflaresreservecount, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_right" ), var_3[0]._id_12618, "tag_origin" );
                        killfxontag( scripts\engine\utility::getfx( "vfx_garden_taillight_lensflare_left" ), var_3[0]._id_12617, "tag_origin" );
                    }

                    var_6 = 0;
                    return;
            }
        }
    }
}

trucklightsoff( var_0 )
{
    foreach ( var_2 in var_0 )
        var_2 setlightintensity( 0 );
}

_id_12819()
{
    var_0 = spawn( "script_origin", self.origin );
    var_0 endon( "death" );
    thread scripts\engine\utility::delete_on_death( var_0 );
    var_1 = "";

    switch ( self.script_noteworthy )
    {
        case "front":
            var_1 = "mp_garden_passby_long_front";
            break;
        case "mid":
            var_1 = "mp_garden_passby_long_middle";
            break;
        case "back":
            var_1 = "mp_garden_passby_long_back";
            break;
        default:
            break;
    }

    switch ( self.script_noteworthy )
    {
        case "back":
        case "front":
            var_0 linkto( self, "TAG_TRAIN_LIGHT_FRONT_4" );
            break;
        default:
            var_0 linkto( self );
            break;
    }

    wait 0.05;
    var_0 playloopsound( var_1 );
    var_0 waittill( "stop sound" + var_1 );
    var_0 stoploopsound( var_1 );
    var_0 delete();
}
