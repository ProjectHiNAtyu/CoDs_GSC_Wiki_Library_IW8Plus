// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    _codecomputerscriptableused::get_recent_spawn_time_threshold();
    scripts\mp\maps\mp_m_trench\mp_m_trench_precache::main();
    scripts\mp\maps\mp_m_trench\gen\mp_m_trench_art::main();
    scripts\mp\maps\mp_m_trench\mp_m_trench_fx::main();
    scripts\mp\maps\mp_m_trench\mp_m_trench_lighting::main();
    scripts\mp\load::main();
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    scripts\mp\compass::setupminimap( "compass_map_mp_m_trench", "codcaster_compass_map_mp_m_trench" );
    scripts\cp_mp\utility\game_utility::registerarenamap();
    level.requiresminstartspawns = 0;
    level.brjugg_playerwelcomesplashes = getnodesinradius( ( 1952, 0, -192 ), 800, 0, 400 );
    setdvar( "PKKMTTRQO", 8 );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "urban";
    game["axis_outfit"] = "woodland";
    thread onplayerconnect();
    thread wave_cooldown_sounds();
    thread playerpreloadintrocinematic();
    level.hanging_crate_think = 1;
    level.traceresultisvalid = 1;
    thread relic_amped_victim();
    thread _id_11F67();
}

onplayerconnect()
{
    for (;;)
    {
        level waittill( "connected", var_0 );
        var_0 thread current_struct();
    }
}

_id_11E98( var_0, var_1 )
{
    switch ( var_1 )
    {
        case 1:
            var_2 = getent( "Num1", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 2:
            var_2 = getent( "Num2", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 3:
            var_2 = getent( "Num3", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 4:
            var_2 = getent( "Num4", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 5:
            var_2 = getent( "Num5", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 6:
            var_2 = getent( "Num6", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 7:
            var_2 = getent( "Num7", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 8:
            var_2 = getent( "Num8", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        case 9:
            var_2 = getent( "Num9", "targetname" );
            var_2.origin = var_0.origin;
            var_2.angles = var_0.angles;
            break;
        default:
            break;
    }
}

_id_12887()
{
    wait 5;
    var_0 = getent( "BunkerPathBlocker", "targetname" );
    var_0 hide();
    var_0 connectpaths();
    syringe_finish_crouch( level.door );
    level.hidequestcirclefromplayer = getentarray( "elevatorDoor", "targetname" );

    foreach ( var_2 in level.hidequestcirclefromplayer )
        thread _id_11F63( var_2 );

    var_4 = scripts\engine\utility::getstruct( "phoneHint", "targetname" );
    level.tr_vis_radius_override_lod2 = easepower( "maphint_phone_mp_m_trench", var_4.origin );
    waitframe();
    scripts\engine\scriptable::_id_11CDB( "maphint_phone", ::set_relic_healthpacks );

    for (;;)
    {
        level.traceresults = 1;
        thread track_consecutive_kills( var_4 );
        level waittill( "PhoneAnswered" );
        level.track_get_launch_target stoploopsound( "trench_phone_ring" );
        level.track_get_launch_target delete();
        playsoundatpos( level.tr_vis_radius_override_lod2.origin, "trench_phone_pickup" );
        wait 0.5;
        playsoundatpos( level.tr_vis_radius_override_lod2.origin, "dx_bra_rubc_bunker_trench_phone_interact_20" );
        wait 4.9;
        playsoundatpos( level.tr_vis_radius_override_lod2.origin, "trench_phone_hangup" );
        wait 0.5;
        register_wave_spawner();
        wait 5;
        level.tr_vis_radius_override_lod2 setscriptablepartstate( "maphint_phone", "on" );
    }
}

current_struct()
{
    self endon( "disconnect" );
    level endon( "game_ended" );
    var_0 = getent( "bunkerCounterUAV", "targetname" );
    self.playmatchendcamera = 0;

    if ( isdefined( var_0 ) )
    {
        for (;;)
        {
            if ( self istouching( var_0 ) )
            {
                if ( !istrue( self.playmatchendcamera ) )
                {
                    self.playmatchendcamera = 1;
                    self.radarstrength = level._id_12A23;
                    self.isradarblocked = 1;
                    self.hasradar = 0;
                    self.radarshowenemydirection = 0;
                    self.radarmode = "normal_radar";
                }
            }
            else if ( istrue( self.playmatchendcamera ) )
            {
                self.playmatchendcamera = undefined;
                level notify( "uav_update" );
            }

            waitframe();
        }
    }
}

set_relic_healthpacks( var_0, var_1, var_2, var_3, var_4 )
{
    level thread add_wave_overrides_to_module( var_0, var_1, var_2, var_3, var_4 );
}

add_wave_overrides_to_module( var_0, var_1, var_2, var_3, var_4 )
{
    if ( var_2 == "on" )
    {
        var_0 setscriptablepartstate( "maphint_phone", "off" );
        level notify( "PhoneAnswered" );
        level.traceresults = 0;
    }
}

relic_amped_victim()
{
    wait 2;
    level.relic_amped_reset_deathshield_on_revived = getentarray( "KeyPad", "targetname" );

    foreach ( var_1 in level.relic_amped_reset_deathshield_on_revived )
        thread relic_amped_wait_till_revived( var_1 );

    level.enter_numbers_end[0] = randomintrange( 1, 10 );
    level.enter_maze_ai_combat[0] = scripts\engine\utility::getstruct( "Code1", "targetname" );
    _id_11E98( level.enter_maze_ai_combat[0], level.enter_numbers_end[0] );

    for ( level.enter_numbers_end[1] = level.enter_numbers_end[0]; level.enter_numbers_end[1] == level.enter_numbers_end[0]; level.enter_numbers_end[1] = randomintrange( 1, 10 ) )
    {

    }

    level.enter_maze_ai_combat[1] = scripts\engine\utility::getstruct( "Code2", "targetname" );
    _id_11E98( level.enter_maze_ai_combat[1], level.enter_numbers_end[1] );

    for ( level.enter_numbers_end[2] = level.enter_numbers_end[0]; level.enter_numbers_end[2] == level.enter_numbers_end[0] || level.enter_numbers_end[2] == level.enter_numbers_end[1]; level.enter_numbers_end[2] = randomintrange( 1, 10 ) )
    {

    }

    level.enter_maze_ai_combat[2] = scripts\engine\utility::getstruct( "Code3", "targetname" );
    _id_11E98( level.enter_maze_ai_combat[2], level.enter_numbers_end[2] );

    for ( level.enter_numbers_end[3] = level.enter_numbers_end[0]; level.enter_numbers_end[3] == level.enter_numbers_end[0] || level.enter_numbers_end[3] == level.enter_numbers_end[1] || level.enter_numbers_end[3] == level.enter_numbers_end[2]; level.enter_numbers_end[3] = randomintrange( 1, 10 ) )
    {

    }

    level.enter_maze_ai_combat[3] = scripts\engine\utility::getstruct( "Code4", "targetname" );
    _id_11E98( level.enter_maze_ai_combat[3], level.enter_numbers_end[3] );

    for ( level.enter_numbers_end[4] = level.enter_numbers_end[0]; level.enter_numbers_end[4] == level.enter_numbers_end[0] || level.enter_numbers_end[4] == level.enter_numbers_end[1] || level.enter_numbers_end[4] == level.enter_numbers_end[2] || level.enter_numbers_end[4] == level.enter_numbers_end[3]; level.enter_numbers_end[4] = randomintrange( 1, 10 ) )
    {

    }

    level.enter_maze_ai_combat[4] = scripts\engine\utility::getstruct( "Code5", "targetname" );
    _id_11E98( level.enter_maze_ai_combat[4], level.enter_numbers_end[4] );
    level.fxent2 = 0;
    var_3 = getent( "CodePad", "targetname" );
    thread isfirstactivation( var_3 );
    var_4 = getent( "BunkerPathBlocker", "targetname" );
    var_4 disconnectpaths();

    while ( level.hanging_crate_think )
    {
        if ( level.fxent2 < 5 )
        {
            level.allassassin_update = level.enter_numbers_end[level.fxent2];
            level waittill( "CodeKeyPressed" );
            continue;
        }

        killfxontag( scripts\engine\utility::getfx( "TrenchEnterCode" ), var_3, "tag_origin" );
        level.hanging_crate_think = 0;
        var_4 hide();
        waitframe();
        var_4 connectpaths();
        playsoundatpos( var_3.origin, "br_keypad_confirm" );
        killfxontag( scripts\engine\utility::getfx( "TrenchEnterCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 2;
        thread syringe_finish_crouch( level.door );
    }

    wait 1;
    level.enter_numbers_end[0] = 5;
    level.enter_numbers_end[1] = 3;
    level.enter_numbers_end[2] = 1;
    level.enter_numbers_end[3] = 2;
    level.enter_numbers_end[4] = 5;
    level.fxent2 = 0;
    level.hidequestcirclefromplayer = getentarray( "elevatorDoor", "targetname" );

    foreach ( var_6 in level.hidequestcirclefromplayer )
        thread _id_11F63( var_6 );

    while ( level.traceresultisvalid )
    {
        if ( level.fxent2 < 5 )
        {
            level.allassassin_update = level.enter_numbers_end[level.fxent2];
            level waittill( "CodeKeyPressed" );
            continue;
        }

        level.traceresultisvalid = 0;
        level.traceresults = 1;
        playsoundatpos( var_3.origin, "br_keypad_confirm" );
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        killfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        wait 0.25;
        playfxontag( scripts\engine\utility::getfx( "TrenchCorrectCode" ), var_3, "tag_origin" );
        level.tracegroundheightexfil = scripts\engine\utility::getstruct( "phoneHint", "targetname" );
        level.tr_vis_radius_override_lod2 = easepower( "maphint_phone_mp_m_trench", level.tracegroundheightexfil.origin );
        waitframe();
        scripts\engine\scriptable::_id_11CDB( "maphint_phone", ::set_relic_healthpacks );
        thread track_consecutive_kills( level.tracegroundheightexfil );
        level waittill( "PhoneAnswered" );
        level.track_get_launch_target stoploopsound( "trench_phone_ring" );
        level.track_get_launch_target delete();
        playsoundatpos( level.tracegroundheightexfil.origin, "trench_phone_pickup" );
        wait 0.5;
        playsoundatpos( level.tracegroundheightexfil.origin, "dx_bra_rubc_bunker_trench_phone_interact_20" );
        wait 4.9;
        playsoundatpos( level.tracegroundheightexfil.origin, "trench_phone_hangup" );
        wait 0.5;
        register_wave_spawner();
    }
}

track_consecutive_kills( var_0 )
{
    level.track_get_launch_target = spawn( "script_origin", var_0.origin );
    wait 0.05;
    level.track_get_launch_target playloopsound( "trench_phone_ring" );
}

register_wave_spawner()
{
    level.hidequestcirclefromplayer[0] playloopsound( "trench_alarm_lp" );
    scripts\engine\utility::exploder( "teddynaught" );
    wait 3;
    level.hidequestcirclefromplayer[1] playsound( "trench_door_start" );

    foreach ( var_1 in level.hidequestcirclefromplayer )
        thread syringe_out( var_1 );

    level.hidequestcirclefromplayer[1] playloopsound( "trench_door_lp" );
    wait 2;
    level.hidequestcirclefromplayer[1] playsound( "trench_door_stop" );
    level.hidequestcirclefromplayer[1] stoploopsound( "trench_door_lp" );
    var_3 = scripts\engine\utility::getstructarray( "bearGun", "targetname" );
    var_4 = spawn( "script_origin", var_3[0].origin );
    var_4 playsound( "weap_dblmg_spinup_npc" );
    wait 1;
    scripts\engine\utility::exploder( "minigun" );
    var_4 playloopsound( "weap_dblmg_spinloop_npc" );
    level.brtruck_ontimelimit = 0;
    thread pickrandomspawn();
    wait 10;
    level.hidequestcirclefromplayer[0] stoploopsound( "trench_alarm_lp" );
    level.brtruck_ontimelimit = 1;
    scripts\engine\utility::stop_exploder( "minigun" );
    var_4 playsound( "weap_dblmg_spindown_npc" );
    var_4 stoploopsound( "weap_dblmg_spinloop_npc" );
    wait 1;
    scripts\engine\utility::stop_exploder( "teddynaught" );
    scripts\engine\utility::exploder( "teddy_dead" );
    playsoundatpos( ( 2604.05, -0.801273, -153 ), "bunker_exp_trans" );
    var_4 stopsounds();
    var_4 delete();
    wait 0.5;

    foreach ( var_1 in level.hidequestcirclefromplayer )
        thread enemy_rushdown_player( var_1 );

    level.hidequestcirclefromplayer[0] playsound( "trench_door_start" );
    level.hidequestcirclefromplayer[1] playsound( "trench_door_stop" );
}

pickrandomspawn()
{
    var_0 = scripts\engine\utility::getstructarray( "bearGun", "targetname" );
    var_1 = getent( "bunkerHurtTrigger", "targetname" );

    while ( !level.brtruck_ontimelimit )
    {
        magicbullet( "iw8_lm_dblmg_mp", var_0[0].origin, ( 0, randomintrange( -1000, 1000 ), randomintrange( -300, 100 ) ) );
        wait 0.1;
        magicbullet( "iw8_lm_dblmg_mp", var_0[1].origin, ( 0, randomintrange( -1000, 1000 ), randomintrange( -300, 100 ) ) );
        wait 0.1;

        if ( randomint( 2 ) )
        {
            foreach ( var_3 in level.players )
            {
                if ( var_3 istouching( var_1 ) )
                    var_3 dodamage( 4, var_0[0].origin, var_3, var_3, "MOD_RIFLE_BULLET", undefined, "torso_upper" );
            }
        }
    }
}

isfirstactivation( var_0 )
{
    wait 10;

    while ( level.hanging_crate_think )
    {
        playfxontag( scripts\engine\utility::getfx( "TrenchEnterCode" ), var_0, "tag_origin" );
        wait 0.5;
        killfxontag( scripts\engine\utility::getfx( "TrenchEnterCode" ), var_0, "tag_origin" );
        waitframe();
        killfxontag( scripts\engine\utility::getfx( "TrenchEnterCode" ), var_0, "tag_origin" );
        wait 0.5;
    }
}

relic_amped_wait_till_revived( var_0 )
{
    var_0 setcandamage( 1 );

    while ( level.hanging_crate_think || level.traceresultisvalid )
    {
        var_0 waittill( "damage", var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 );

        if ( level.allassassin_update == int( var_0.script_noteworthy ) )
        {
            level.fxent2++;
            level notify( "CodeKeyPressed" );
            continue;
        }

        if ( level.enter_numbers_end[0] == int( var_0.script_noteworthy ) )
        {
            level.fxent2 = 1;
            level notify( "CodeKeyPressed" );
            continue;
        }

        level.fxent2 = 0;
        level notify( "CodeKeyPressed" );
    }
}

_id_11F63( var_0 )
{
    var_0.originalpos = var_0.origin;
    var_1 = scripts\engine\utility::getstruct( var_0.target, "targetname" );
    var_0.table_getaddblueprintattachments = var_1.origin;
}

syringe_out( var_0 )
{
    var_0 moveto( var_0.table_getaddblueprintattachments, 2, 1.5, 0 );
}

enemy_rushdown_player( var_0 )
{
    var_0 moveto( var_0.originalpos, 0.5, 0.25, 0 );
}

playerpreloadintrocinematic()
{
    thread playerprestreamrespawnorigin();
    thread playerpurchaselogic();
}

#using_animtree("animated_props");

playerprestreamrespawnorigin()
{
    level.scr_animtree["bunker_door"] = #animtree;
    level.scr_anim["bunker_door"]["door_open"] = %mp_verdansk_bunkerdoor_open;
    level.scr_animname["bunker_door"]["door_open"] = "mp_verdansk_bunkerdoor_open";
    level.scr_anim["bunker_door"]["door_open_puzzle"] = %mp_verdansk_bunkerdoor_open_puzzle;
    level.scr_animname["bunker_door"]["door_open_puzzle"] = "mp_verdansk_bunkerdoor_open_puzzle";
}

playerpurchaselogic()
{
    level.door = getent( "bunker_door", "targetname" );
    var_0 = getentarray( level.door.target, "targetname" );

    foreach ( var_2 in var_0 )
    {
        if ( var_2.script_noteworthy == "right_door_clip" )
        {
            level.door.endoperatorsfxondisconnect = var_2;
            continue;
        }

        if ( var_2.script_noteworthy == "left_door_clip" )
            level.door.endprematchskydiving = var_2;
    }

    level.door.animname = "bunker_door";
    level.door scripts\common\anim::setanimtree();
}

syringe_finish_crouch( var_0 )
{
    var_1 = "door_open";
    var_0 thread scripts\common\anim::anim_single_solo( var_0, var_1 );
    var_0 playsound( "br_bunker_door_open_01" );
    var_2 = getanimlength( level.scr_anim["bunker_door"][var_1] );
    wait 8;
    var_0.endoperatorsfxondisconnect rotateto( var_0.endoperatorsfxondisconnect.angles - ( 0, 90, 0 ), 5, 0.2, 0.8 );
    var_0.endprematchskydiving rotateto( var_0.endprematchskydiving.angles + ( 0, 90, 0 ), 5, 0.2, 0.8 );
    var_0 playsound( "br_bunker_door_open_02" );
    wait( var_2 - 8 );
    var_0.endoperatorsfxondisconnect connectpaths();
    var_0.endprematchskydiving connectpaths();
}

wave_cooldown_sounds()
{
    wait 3;
    level.init_train_arrays = scripts\engine\utility::getstructarray( "exploPoint", "targetname" );
    var_0 = 0;

    foreach ( var_2 in level.init_train_arrays )
    {
        level.init_trap_room_vfx[var_0] = scripts\engine\utility::spawn_tag_origin();
        level.init_trap_room_vfx[var_0].origin = var_2.origin;
        level.init_trap_room_vfx[var_0] show();
        var_0++;
    }

    for (;;)
    {
        wait( randomintrange( 5, 17 ) );

        if ( var_0 > 0 )
        {
            var_4 = randomintrange( 0, var_0 );
            level.init_trap_room_vfx[var_4] playsound( "trench_mortar_expl_trans" );
            playfxontag( scripts\engine\utility::getfx( "TrenchExplosionFX" ), level.init_trap_room_vfx[var_4], "tag_origin" );
        }
    }
}

_id_11F67()
{
    var_0 = getentarray( "fan", "targetname" );

    foreach ( var_2 in var_0 )
        thread interiordoor( var_2, randomfloatrange( 0.75, 1.25 ) );
}

interiordoor( var_0, var_1 )
{
    for (;;)
    {
        var_0 rotateroll( 360, var_1, 0, 0 );
        wait( var_1 );
    }
}
