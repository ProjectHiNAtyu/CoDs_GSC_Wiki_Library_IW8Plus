// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    _dangercircledurationforplayer::get_recent_spawn_time_threshold();
    level.music_style = "eastern_europe";
    scripts\mp\maps\mp_oilrig\mp_oilrig_precache::main();
    scripts\mp\maps\mp_oilrig\gen\mp_oilrig_art::main();
    scripts\mp\maps\mp_oilrig\mp_oilrig_fx::main();
    scripts\mp\maps\mp_oilrig\mp_oilrig_lighting::main();
    scripts\mp\load::main();
    setdvar( "mantle_force_legacy_system", 1 );
    level.music_style = "england";
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    level.kill_border_triggers = getentarray( "kill_border_trigger", "targetname" );
    scripts\mp\compass::setupminimap( "compass_map_mp_oilrig", "codcaster_compass_map_mp_oilrig" );
    setdvar( "PKKMTTRQO", 8 );
    setdvar( "MTRRKPRML", 2 );
    setdvar( "LTMPKRLLNM", 5000 );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "urban";
    game["axis_outfit"] = "woodland";
    thread _id_125BB();
    thread _id_125BA( "hanging_cord01" );
    thread _id_125BA( "hanging_cord02" );
    thread playerzombiejumpmaxholdwarning( "ship01" );
    thread br_domheight();
    level thread teamsplashbr();
    level thread onplayerconnect();
    thread scripts\mp\animation_suite::animationsuite();
    level._id_11A50 = 1;
    level.requiredplayercount["allies"] = 4;
    level.requiredplayercount["axis"] = 4;
    thread branalytics_dropbagused();
}

teamsplashbr()
{
    if ( !isdefined( level.outofboundstriggers ) )
        level.outofboundstriggers = [];

    var_0 = [ ( -2126, -1616, 983 ), ( -2175, -1400, 980 ), ( -1500, -2600, 850 ) ];

    foreach ( var_2 in var_0 )
    {
        var_3 = spawn( "trigger_radius", var_2, 0, 400, 128 );
        level.outofboundstriggers[level.outofboundstriggers.size] = var_3;
    }
}

br_domheight()
{
    var_0 = getent( "drillAnimatedPivot", "targetname" );
    var_1 = getent( "drillPivot", "script_noteworthy" );
    var_2 = getent( "drillAnimatedPivotSight", "targetname" );

    if ( isdefined( var_0 ) )
    {
        var_0 linkto( var_1 );
        var_2 linkto( var_1 );
    }
}

onplayerconnect()
{
    for (;;)
    {
        level waittill( "connected", var_0 );
        var_0 thread _id_124BE();
        var_0 thread _id_124BF();
    }
}

_id_124BE()
{
    self endon( "disconnect" );
    level endon( "game_ended" );
    self.quest_scavdistmin = 1;
    var_0 = "TAG_EYE";

    for (;;)
    {
        if ( scripts\cp_mp\utility\player_utility::_isalive() && self.quest_scavdistmin )
            playfxontag( level._effect["cold_breath_run"], self, var_0 );

        wait( 2.5 + randomfloat( 3 ) );
    }
}

_id_124BF()
{
    self endon( "disconnect" );
    level endon( "game_ended" );
    var_0 = getent( "insideTrigger", "targetname" );

    for (;;)
    {
        if ( var_0 istouching( self ) )
            self.quest_scavdistmin = 0;
        else
            self.quest_scavdistmin = 1;

        wait 1;
    }
}

_id_125BB()
{
    var_0 = getent( "swayCrate", "targetname" );
    var_1 = getentarray( var_0.target, "targetname" );

    foreach ( var_3 in var_1 )
    {
        var_3.modelscale = 0.5;
        var_3 linkto( var_0 );
    }

    thread _id_125BC( var_0, 4 );
}

_id_125BA( var_0 )
{
    var_1 = getent( var_0, "targetname" );
    thread _id_125BC( var_1, 1.25 );
}

_id_125BC( var_0, var_1 )
{
    level endon( "game_ended" );
    var_2 = var_1;

    for (;;)
    {
        var_3 = 7;
        var_2 = var_2 * -1;
        var_0.goalang = ( randomfloatrange( -1.5, 1.5 ), randomfloatrange( -15, 15 ), var_2 );
        var_0 rotateto( var_0.goalang, var_3, var_3 * 0.45, var_3 * 0.45 );
        wait( var_3 );
        scripts\engine\utility::exploder( "left" );
        var_2 = var_2 * -1;
        var_0.goalang = ( randomfloatrange( -1.5, 1.5 ), randomfloatrange( -15, 15 ), var_2 );
        var_0 rotateto( var_0.goalang, var_3, var_3 * 0.45, var_3 * 0.45 );
        wait( var_3 );
        scripts\engine\utility::exploder( "right" );
    }
}

playerzombiejumpmaxholdwarning( var_0 )
{
    level waittill( "infil_setup_complete" );
    var_1 = getent( "ship01_link", "targetname" );
    var_2 = getentarray( "ship02_link", "targetname" );
    var_3 = getent( "shipPivot", "script_noteworthy" );

    if ( isdefined( var_1 ) )
        var_1 linkto( var_3 );

    if ( isdefined( var_2 ) && isdefined( var_3 ) )
    {
        foreach ( var_5 in var_2 )
            var_5 linkto( var_3 );
    }

    wait 6.0;
    var_1._id_11FB3 = scripts\engine\utility::spawn_tag_origin();
    var_1._id_11FB3.origin = var_1.origin;
    var_1._id_11FB3.angles = var_1.angles;
    var_1._id_11FB3.targetname = "shipFX";
    var_1._id_11FB3 show();
    var_1._id_11FB3 linkto( var_1 );
    wait 0.1;
    playfxontag( scripts\engine\utility::getfx( "vfx_oil_cargo_ship" ), var_1._id_11FB3, "tag_origin" );
    var_1 playloopsound( "emt_cargo_ship_wake" );
}

branalytics_dropbagused()
{
    level endon( "game_ended" );
    level waittill( "connected", var_0 );
    var_1 = 35;
    var_2 = 35.0;
    var_3 = 50.0;
    var_4 = [];

    for ( var_5 = 1; var_5 < var_1 + 1; var_5++ )
    {
        var_6 = "dx_mpm_rupa_loudspeaker_announcements_" + var_5 + "0";

        if ( soundexists( var_6 ) )
            var_4[var_4.size] = var_6;
    }

    var_7 = spawn( "script_origin", ( 0, 0, 0 ) );
    level thread brallowclasschoicefunc();
    var_8 = [];
    var_8[var_8.size] = -1;
    var_8[var_8.size] = -1;
    var_8[var_8.size] = -1;

    for (;;)
    {
        for ( var_9 = randomintrange( 0, var_4.size ); var_9 == var_8[0] || var_9 == var_8[1] || var_9 == var_8[2]; var_9 = randomintrange( 0, var_4.size ) )
        {

        }

        var_8[0] = var_8[1];
        var_8[1] = var_8[2];
        var_8[2] = var_9;
        var_7 playsound( var_4[var_9] );
        wait 5.0;
        wait( randomfloatrange( var_2, var_3 ) );
    }
}

brallowclasschoicefunc()
{
    wait 10;
    enablepaspeaker( "oilrig_pa" );
}
