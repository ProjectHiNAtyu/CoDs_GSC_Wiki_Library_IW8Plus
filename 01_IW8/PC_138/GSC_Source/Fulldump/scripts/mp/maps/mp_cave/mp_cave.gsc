// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    level.music_style = "middle_east";
    scripts\mp\maps\mp_cave\mp_cave_precache::main();
    scripts\mp\maps\mp_cave\gen\mp_cave_art::main();
    scripts\mp\maps\mp_cave\mp_cave_fx::main();
    scripts\cp_mp\utility\game_utility::registernightmap();
    scripts\mp\load::main();
    scripts\mp\utility\player::overridevisionsetnightforlevel( "nvg_base_mp_cave" );
    level thread scripts\engine\scriptable_door::system_init();
    var_0 = spawn( "trigger_radius", ( 376, -1568, -112 ), 0, 128, 300 );
    var_0.targetname = "OutOfBounds";
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    scripts\mp\compass::setupminimap( "compass_map_mp_cave", "codcaster_compass_map_mp_cave" );
    level.kill_border_triggers = getentarray( "kill_border_trigger", "targetname" );
    setdvar( "LKOLRONRNQ", 500 );
    setdvar( "PKKMTTRQO", 8 );
    setdvar( "NKLMONNPNN", 1024 );
    setdvar( "NOSQLKNSQO", 45 );
    setdvar( "MRNRKKOPLN", 2 );
    setdvar( "MQPQKNPQOK", 5 );
    setdvar( "NQNQPRLRQM", 2 );
    setdvar( "NSSMQLPRNT", 0.01 );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "desert";
    game["axis_outfit"] = "desert";
    thread scripts\mp\motiondetectors::init();
    level thread managegate();
    thread destructibletrucksetup( "destructibleTruck01", "truckHeadlights01", "destructibleTruck01_edges", "destructibleTruck01_edges_dst", 51 );
    thread destructibletrucksetup( "destructibleTruck02", "truckHeadlights02", "destructibleTruck02_edges", "destructibleTruck02_edges_dst", 52 );
    thread matchfxexploder();
    thread stack_patch_thread_node();
    thread _id_11D0B();
    thread isbestplayertime();
}

isbestplayertime()
{
    var_0 = spawn( "script_model", ( 1592, 561, 176 ) );
    var_0 setmodel( "me_construction_plank_bridge_a_11" );
    var_0.angles = ( 85.3, 326, -11 );
    var_1 = spawn( "script_model", ( -1034, 844, 92 ) );
    var_1 setmodel( "me_construction_plank_bridge_a_11" );
    var_1.angles = ( 0, 275, -90 );
    var_2 = spawn( "script_model", ( 3715, 1658.5, 262 ) );
    var_2 setmodel( "me_construction_plank_bridge_a_11" );
    var_2.angles = ( 272, 145, -90 );
    var_3 = spawn( "script_model", ( -1061, 917.5, 112 ) );
    var_3 setmodel( "hardware_plywood_bare_01_24_dirty" );
    var_3.angles = ( 270, 0, 0 );
    var_4 = spawn( "script_model", ( 842, 332, 60 ) );
    var_4 setmodel( "me_construction_plank_bridge_a_11" );
    var_4.angles = ( 270, 0, 0 );
    var_5 = getent( "tactical_cover_col", "targetname" );
    var_6 = spawn( "script_model", ( 1768, 2128, 80 ) );
    var_6.angles = ( 0, 255, 0 );
    var_6 clonebrushmodeltoscriptmodel( var_5 );
}

matchfxexploder()
{
    level waittill( "prematch_countdown" );
    scripts\engine\utility::exploder( 77 );
}

#using_animtree("script_model");

managegate()
{
    level waittill( "infil_setup_complete" );

    if ( !scripts\mp\flags::gameflag( "infil_will_run" ) )
        return;

    scripts\mp\flags::gameflagwait( "infil_started" );
    level.scr_animtree["gate_left"] = #animtree;
    level.scr_anim["gate_left"]["close"] = %mp_trainyard_gatel_close;
    level.scr_animname["gate_left"]["close"] = "mp_trainyard_gateL_close";
    level.scr_anim["gate_left"]["open"] = %mp_trainyard_gatel_open;
    level.scr_animname["gate_left"]["open"] = "mp_trainyard_gateL_open";
    level.scr_animtree["gate_right"] = #animtree;
    level.scr_anim["gate_right"]["close"] = %mp_trainyard_gater_close;
    level.scr_animname["gate_right"]["close"] = "mp_trainyard_gateR_close";
    level.scr_anim["gate_right"]["open"] = %mp_trainyard_gater_open;
    level.scr_animname["gate_right"]["open"] = "mp_trainyard_gateR_open";
    var_0 = getent( "infil_door_left", "targetname" );
    var_1 = getent( "infil_door_right", "targetname" );
    var_2 = getent( "infil_door_chain", "targetname" );
    var_0.animname = "gate_left";
    var_0 scripts\common\anim::setanimtree();
    var_1.animname = "gate_right";
    var_1 scripts\common\anim::setanimtree();
    var_0 thread scripts\common\anim::anim_single_solo( var_0, "open" );
    var_1 thread scripts\common\anim::anim_single_solo( var_1, "open" );
    var_2 hide();
    level waittill( "prematch_countdown" );
    var_0 thread scripts\common\anim::anim_single_solo( var_0, "close" );
    var_1 thread scripts\common\anim::anim_single_solo( var_1, "close" );
    var_3[0] = "_left";
    var_3[1] = "_right";
    var_4 = randomint( 2 );

    if ( var_4 > 1 )
        var_4 = 1;

    var_0 playsound( "mp_runner_gate_close" + var_3[var_4] );

    if ( var_3[var_4] == "_left" )
        var_1 playsound( "mp_runner_gate_close_right" );
    else
        var_1 playsound( "mp_runner_gate_close_left" );

    wait 1.0;
    var_2 show();
}

destructibletrucksetup( var_0, var_1, var_2, var_3, var_4 )
{
    level endon( "game_ended" );
    wait 5;
    var_5 = getscriptablearray( var_0, "targetname" );
    var_6 = getent( var_2, "targetname" );
    var_7 = getent( var_3, "targetname" );
    var_8 = getentarray( var_1, "targetname" );
    var_7 hide();
    scripts\engine\utility::exploder( var_4 );

    if ( isdefined( var_5 ) && isdefined( var_5[0] ) )
    {
        var_9 = var_5[0];
        var_10 = 1;

        while ( var_10 )
        {
            var_9 waittill( "scriptableNotification", var_11, var_12 );

            switch ( var_11 )
            {
                case "vehicle_death":
                case "onfire":
                case "flareup":
                    trucklightsoff( var_8 );
                    var_10 = 0;
                    scripts\engine\utility::kill_exploder( var_4 );
                    var_7 show();
                    var_6 hide();
                    return;
                case "anim_explosion":
                    trucklightsoff( var_8 );
                    var_10 = 0;
                    scripts\engine\utility::kill_exploder( var_4 );
                    var_7 show();
                    var_6 hide();
                    return;
            }
        }
    }
}

trucklightsoff( var_0 )
{
    foreach ( var_2 in var_0 )
        var_2 setlightintensity( 0 );
}

stack_patch_thread_node()
{
    level endon( "game_ended" );
    level waittill( "used_nuke" );
    var_0 = spawn( "script_origin", ( -106, 364, 216 ) );
    var_0 makeusable();
    var_0 thread isxmike109explosiveheadshot();
}

isxmike109explosiveheadshot()
{
    self waittill( "trigger", var_0 );
    var_0 playerhide();
    var_0 sethidenameplate( 0 );
    var_0 allowmovement( 0 );
    var_0 allowfire( 0 );
    var_0 disableoffhandprimaryweapons( 0 );
    var_0 disableoffhandsecondaryweapons( 0 );
    var_0 disableweapons( 0 );
    var_0 disableweaponswitch( 0 );
    var_0 setcamerathirdperson( 1 );
    var_0 allowcrouch( 0 );
    var_0 allowmelee( 0 );
    var_0 allowjump( 0 );
    var_0 allowprone( 0 );
    var_0 scripts\common\utility::allow_killstreaks( 0 );
    var_0 scripts\common\utility::allow_supers( 0 );
    var_0._id_11C19 = 1;
    var_0 scripts\mp\hud_message::showerrormessage( "MP_INGAME_ONLY/SAFE" );
}

_id_11D0B()
{
    var_0 = [];
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( -548, 2268, 100 ), ( 0, 330, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 655, 2395, 149 ), ( 0, 315, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 576, 1152, 176 ), ( 0, 315, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 177, 1394, 108 ), ( 0, 15, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 1847, 1074, 112 ), ( 0, 225, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 1555, -52, 92 ), ( 0, 135, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 1292, 1024, 129 ), ( 0, 270, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 1554, -223, 97 ), ( 0, 195, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 84, -484, 93 ), ( 0, 90, 0 ) );
    var_0[var_0.size] = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_tdm_spawn_secondary", ( 16, -932, 33 ), ( 0, 15, 0 ) );

    if ( var_0.size > 0 )
        scripts\mp\spawnlogic::amped_wid( var_0 );
}
