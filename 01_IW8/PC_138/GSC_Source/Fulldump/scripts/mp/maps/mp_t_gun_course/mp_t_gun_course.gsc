// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    _codecomputerscriptableused::get_recent_spawn_time_threshold();
    level._id_128BA = 1;
    level.music_style = "middle_east";
    var_0 = getentarrayinradius( "trial_weapon", "targetname", ( -610.39, 705.465, 45.9237 ), 1 )[0];
    var_0.origin = var_0.origin + ( 0, 0, 1 );
    var_1 = getdvarint( "LTTRKNNKTQ", 0 );

    if ( var_1 == 104 )
    {
        level.mud_sfx = 0;
        var_2 = "forward";
        var_3 = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_trial_spawn", ( -700, 400, 24 ), ( 0, 50, 0 ) );
    }
    else
    {
        level.mud_sfx = 1;
        var_2 = "backward";
        var_3 = scripts\mp\spawnlogic::force_teleport_downedplayer( "mp_trial_spawn", ( -709, 472, 24 ), ( 0, 150, 0 ) );
    }

    var_4 = getentarray();

    foreach ( var_6 in var_4 )
    {
        if ( isdefined( var_6.script_wtf ) && var_6.script_wtf == var_2 )
            var_6 delete();
    }

    scripts\mp\spawnlogic::amped_wid( [ var_3 ] );
    scripts\mp\maps\mp_t_gun_course\mp_t_gun_course_precache::main();
    scripts\mp\maps\mp_t_gun_course\gen\mp_t_gun_course_art::main();
    scripts\mp\maps\mp_t_gun_course\mp_t_gun_course_fx::main();
    scripts\mp\maps\mp_t_gun_course\mp_t_gun_course_lighting::main();
    scripts\mp\load::main();
    level.ttlos_suppressasserts = 1;
    level.trial_infinite_reserve_ammo = 1;
    scripts\mp\compass::setupminimap( "compass_map_mp_t_gun_course" );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "urban";
    game["axis_outfit"] = "woodland";
    thread _id_11A5B();
    thread door_surprise_breach();
    thread progression_gates();
    thread target_random_models();
    var_8 = spawn( "script_model", ( -20, 1648, 68 ) );
    var_8.angles = ( 0, 180, 0 );
    var_8 setmodel( "building_wall_broken_corner_48x48_01_tan2" );
    var_9 = spawn( "script_model", ( -1352, 1780.5, 160 ) );
    var_9.angles = ( 0, 270, 0 );
    var_9 setmodel( "cinderblock_wall_topper_02_128" );
    var_10 = spawn( "script_model", ( -256, 536, 244 ) );
    var_10.angles = ( 0, 270, 0 );
    var_10 setmodel( "hardware_plywood_bare_01" );
    var_11 = spawn( "script_model", ( -998.672, 1585, 25.4966 ) );
    var_11.angles = ( 0, 184.399, -180 );
    var_11 setmodel( "barrier_traffic_concrete_block_01_chip_away_dead" );
    var_12 = spawn( "script_model", ( -1128, 672, 120 ) );
    var_12.angles = ( 360, 345, -90 );
    var_12 setmodel( "player128x128x8" );

    if ( !level.mud_sfx )
    {
        var_13 = getent( "end", "script_noteworthy" );
        var_13.origin = var_13.origin + ( 0, 48, 0 );
        var_14 = spawn( "script_model", ( -499.179, 667.972, -15.5977 ) );
        var_14.angles = ( 0, 303.999, -90.0001 );
        var_14 setmodel( "player128x128x8" );
    }
}

door_surprise_breach()
{
    var_0 = getent( "door", "script_noteworthy" );
    var_1 = getent( "door_l", "script_noteworthy" );
    var_2 = getent( "door_r", "script_noteworthy" );

    for (;;)
    {
        level waittill( "course_started" );

        while ( !var_0.activated )
            waitframe();

        playsoundatpos( var_1.origin + ( 0, 0, 42 ), "scrpt_door_heavy_metal_single_bash" );
        playsoundatpos( var_2.origin + ( 0, 0, 42 ), "scrpt_door_heavy_metal_single_bash" );
        var_1 rotateyaw( -135, 0.3, 0, 0.1 );
        var_2 rotateyaw( 135, 0.3, 0, 0.1 );
        level waittill( "course_ended" );
        var_1 rotateyaw( 135, 1 );
        var_2 rotateyaw( -135, 1 );
    }
}

progression_gates()
{
    var_0 = getent( "start_fence", "targetname" );
    var_1 = getent( "start_fence_collision", "targetname" );
    var_2 = getent( "start_fence_collision_opening", "targetname" );
    var_3 = getent( "end_fence", "targetname" );
    var_4 = getent( "end_fence_collision", "targetname" );
    var_5 = getent( "backtrack_fence", "targetname" );
    var_6 = getent( "backtrack_fence_collision_closed", "targetname" );
    var_2 linkto( var_0 );

    if ( level.mud_sfx )
    {
        var_7 = ( 0, 90, 0 );
        var_8 = ( 0, 0, 0 );
        var_9 = ( 0, 290, 0 );
        var_10 = ( 0, 0, 0 );
        var_11 = ( 0, 4, 0 );
        var_12 = ( 0, 270, 0 );
        var_13 = ( -1030, 484, 82 );
    }
    else
    {
        var_7 = ( 0, 290, 0 );
        var_8 = ( 0, 0, 0 );
        var_9 = ( 0, 90, 0 );
        var_10 = ( 0, 0, 0 );
        var_11 = ( 0, 0, 0 );
        var_12 = ( 0, 90, 0 );
        var_13 = ( -448, 530, 82 );
    }

    level waittill( "player_spawned" );

    while ( level.player getvelocity() == 0 )
        waitframe();

    for (;;)
    {
        var_0 rotateto( var_7, 2 );
        scripts\engine\utility::play_sound_in_space( "trial_sfx_door_chainlink_slow", var_13 );
        wait 1.5;
        var_1 notsolid();
        level waittill( "course_started" );
        var_1 solid();
        var_2 notsolid();
        var_6 notsolid();
        var_4 notsolid();
        var_0 rotateto( var_8, 2 );
        var_3 rotateto( var_9, 3 );
        var_5 rotateto( var_11, 1 );
        level waittill( "course_ended" );
        var_2 solid();
        var_6 solid();
        var_5 rotateto( var_12, 3 );
        _debug_rooftop_raid_exfil::trial_ui_waittill_retry();
    }
}

_id_11A5B()
{
    for (;;)
    {
        level waittill( "course_ended" );
        var_0 = getentitylessscriptablearrayinradius( "scriptable_scriptable_door_industrial_metal_mp_01", "classname" );

        foreach ( var_2 in var_0 )
            var_2 scriptabledoorclose();
    }
}

target_random_models()
{
    while ( !isdefined( level.targets_thinking ) || istrue( level.targets_thinking ) )
        waitframe();

    var_0 = [ "ee_military_shooting_range_plate_enemy_01", "ee_military_shooting_range_plate_enemy_02", "ee_military_shooting_range_plate_enemy_03", "ee_military_shooting_range_plate_enemy_04", "ee_military_shooting_range_plate_enemy_05", "ee_military_shooting_range_plate_enemy_06" ];
    var_1 = [ "ee_military_shooting_range_plate_civilian_01", "ee_military_shooting_range_plate_civilian_02", "ee_military_shooting_range_plate_civilian_03" ];
    var_2 = [ "ee_military_shooting_range_plate_bullet", "ee_military_shooting_range_plate_bullet_01", "ee_military_shooting_range_plate_bullet_02", "ee_military_shooting_range_plate_bullet_03" ];
    var_3 = scripts\engine\utility::array_randomize( level.enemy_targets );
    var_4 = scripts\engine\utility::array_randomize( level.civilian_targets );

    foreach ( var_6 in var_3 )
    {
        var_6.bullet_decal = spawn( "script_model", var_6.plate.origin );
        var_6.bullet_decal.angles = var_6.plate.angles;
        var_6.bullet_decal linkto( var_6.plate );

        if ( isdefined( var_6.script_parameters ) )
            var_6.plate setmodel( var_6.script_parameters );
    }

    foreach ( var_6 in var_3 )
    {
        var_9 = scripts\engine\utility::getclosest( var_6.origin, scripts\engine\utility::array_remove( var_3, var_6 ) );
        var_10 = scripts\engine\utility::getclosest( var_6.origin, scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_3, var_6 ), var_9 ) );
        var_11 = scripts\engine\utility::getclosest( var_6.origin, scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_3, var_6 ), var_9 ), var_10 ) );
        var_12 = scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_2, var_9.bullet_decal.model ), var_10.bullet_decal.model ), var_11.bullet_decal.model );

        if ( !isdefined( var_6.script_parameters ) )
        {
            var_13 = scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_0, var_9.plate.model ), var_10.plate.model ), var_11.plate.model );
            var_6.plate setmodel( scripts\engine\utility::random( var_13 ) );
        }

        var_6.bullet_decal setmodel( scripts\engine\utility::random( var_12 ) );
    }

    foreach ( var_16 in var_4 )
    {
        var_9 = scripts\engine\utility::getclosest( var_16.origin, scripts\engine\utility::array_remove( var_4, var_16 ) );
        var_10 = scripts\engine\utility::getclosest( var_16.origin, scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_4, var_16 ), var_9 ) );

        if ( isdefined( var_16.script_parameters ) )
        {
            var_16.plate setmodel( var_16.script_parameters );
            continue;
        }

        var_13 = scripts\engine\utility::array_remove( scripts\engine\utility::array_remove( var_1, var_9.plate.model ), var_10.plate.model );
        var_16.plate setmodel( scripts\engine\utility::random( var_13 ) );
    }
}
