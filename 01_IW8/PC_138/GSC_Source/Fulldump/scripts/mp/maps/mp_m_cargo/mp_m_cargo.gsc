// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

main()
{
    scripts\mp\maps\mp_m_cargo\mp_m_cargo_precache::main();
    scripts\mp\maps\mp_m_cargo\gen\mp_m_cargo_art::main();
    scripts\mp\maps\mp_m_cargo\mp_m_cargo_fx::main();
    scripts\mp\maps\mp_m_cargo\mp_m_cargo_lighting::main();
    scripts\mp\load::main();
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    scripts\mp\compass::setupminimap( "compass_map_mp_m_cargo", "codcaster_compass_map_mp_m_cargo" );
    scripts\cp_mp\utility\game_utility::registerarenamap();
    level.requiresminstartspawns = 0;
    setdvar( "PKKMTTRQO", 8 );
    game["attackers"] = "allies";
    game["defenders"] = "axis";
    game["allies_outfit"] = "urban";
    game["axis_outfit"] = "woodland";
    thread _id_125BB();
    thread jugg_combo();
    thread deploy_subway_cars_on_track();
    thread isbestplayertime();
    thread failsmokinggunquest();
}

isbestplayertime()
{
    var_0 = getent( "mount32", "targetname" );
    var_1 = spawn( "script_model", ( -337, -264, 92 ) );
    var_1.angles = ( 270, 0, -45 );
    var_1 clonebrushmodeltoscriptmodel( var_0, 1 );
    var_2 = getent( "mount64", "targetname" );
    var_3 = spawn( "script_model", ( 58, 7, 5 ) );
    var_3.angles = ( 0, 80, 0 );
    var_3 clonebrushmodeltoscriptmodel( var_2, 1 );
    var_4 = getent( "tactical_cover_col", "targetname" );
    var_5 = spawn( "script_model", ( -368, 244, 2 ) );
    var_5.angles = ( 0, 90, 0 );
    var_5 clonebrushmodeltoscriptmodel( var_4 );
    var_6 = getent( "tactical_cover_col", "targetname" );
    var_7 = spawn( "script_model", ( -368, 152, 2 ) );
    var_7.angles = ( 0, 90, 0 );
    var_7 clonebrushmodeltoscriptmodel( var_6 );
}

failsmokinggunquest()
{
    var_0 = spawn( "script_model", ( 267.67, 222.004, 11.5 ) );
    var_0.angles = ( 0, 270, 0 );
    var_0 setmodel( "weapon_wm_la_juliet_missile_fat" );
    var_1 = spawn( "script_model", ( 267.67, 222.01, 26.0559 ) );
    var_1.angles = ( 0, 90, -180 );
    var_1 setmodel( "weapon_wm_la_juliet_missile_fat" );
    var_2 = spawn( "script_model", ( 267.67, 222.004, 37.5 ) );
    var_2.angles = ( 0, 270, 0 );
    var_2 setmodel( "weapon_wm_la_juliet_missile_fat" );
}

_id_125BB()
{
    var_0 = getent( "swayCrate", "targetname" );
    var_1 = getentarray( var_0.target, "targetname" );

    foreach ( var_3 in var_1 )
        var_3 linkto( var_0 );

    thread _id_125BC( var_0 );
    thread starting_boxes();
}

starting_boxes()
{
    var_0 = getent( "ocean", "targetname" );
    var_1 = 7;
    var_0 rotateto( ( 0, 0, -1.5 ), 5, 2.25, 2.25 );
    wait 5;

    for (;;)
    {
        var_0 rotateto( ( 0, 0, 1.5 ), var_1, var_1 * 0.45, var_1 * 0.45 );
        wait( var_1 );
        var_0 rotateto( ( 0, 0, -1.5 ), var_1, var_1 * 0.45, var_1 * 0.45 );
        wait( var_1 );
    }
}

_id_125BC( var_0 )
{
    var_1 = 4;

    for (;;)
    {
        var_2 = 7;
        var_1 = var_1 * -1;
        var_0.goalang = ( randomfloatrange( -1.5, 1.5 ), randomfloatrange( -15, 15 ), var_1 );
        var_0 rotateto( var_0.goalang, var_2, var_2 * 0.45, var_2 * 0.45 );
        wait( var_2 );
        scripts\engine\utility::exploder( "left" );
        var_1 = var_1 * -1;
        var_0.goalang = ( randomfloatrange( -1.5, 1.5 ), randomfloatrange( -15, 15 ), var_1 );
        var_0 rotateto( var_0.goalang, var_2, var_2 * 0.45, var_2 * 0.45 );
        wait( var_2 );
        scripts\engine\utility::exploder( "right" );
    }
}

jugg_combo()
{
    var_0 = getent( "swayCrate", "targetname" );
    var_1 = ( 0, 0, -386.09 );

    for (;;)
    {
        waitframe();
        var_2 = var_0.angles * ( 0, 0, 3 );
        var_3 = anglestoup( var_2 );
        var_4 = var_3 * -386.09;
        waitframe();
        physics_setgravity( var_4 );
        waitframe();
        physicsjolt( ( 0, 0, 0 ), 1024, 1000, ( 0.1, 0.1, 0.1 ) );
        waitframe();
    }
}

deploy_subway_cars_on_track()
{
    while ( !istrue( game["gamestarted"] ) )
        waitframe();

    if ( scripts\mp\utility\game::getgametype() == "arena" )
    {
        var_0 = getentarray( "toy", "targetname" );
        var_1 = getentarray( "magic", "targetname" );
    }
    else
    {
        var_0 = getentarray( "magic", "targetname" );
        var_1 = getentarray( "toy", "targetname" );
    }

    level.start_chopper_boss = 0;

    foreach ( var_3 in var_1 )
        var_3 thread trackhiddenobj( var_1.size );

    level.start_coop_bomb_case_defusal = 0;

    foreach ( var_3 in var_0 )
        var_3 thread _id_127D9( var_0.size );

    while ( level.start_chopper_boss < var_1.size && level.start_coop_bomb_case_defusal == 0 )
        wait 1;

    if ( level.start_coop_bomb_case_defusal == 0 )
    {
        for ( var_7 = 30; var_7 > 0; var_7-- )
        {
            var_8 = ( randomintrange( -400, 400 ), randomintrange( -400, 400 ), 800 );
            var_9 = spawn( "script_model", var_8 );
            var_9 setmodel( "p7_spl_toy_beach_ball_01_clean" );
            var_9 physicslaunchserver( ( 0, 0, 0 ), ( 0, 0, 0 ), -500 );
            wait 0.1;
        }
    }
}

trackhiddenobj( var_0 )
{
    level endon( "game_ended" );
    self setcandamage( 1 );
    self.found = [];

    for (;;)
    {
        self waittill( "damage", var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 );

        if ( isdefined( var_10 ) )
        {
            if ( var_5 == "MOD_EXPLOSIVE" || var_5 == "MOD_GRENADE_SPLASH" )
                continue;
        }
        else if ( isdefined( var_14.streakinfo ) && scripts\mp\utility\killstreak::iskillstreak( var_14.streakinfo.streakname ) )
        {
            self.health = 5;
            continue;
        }

        if ( !isdefined( self.found[var_2.guid] ) )
        {
            self.found[var_2.guid] = 1;

            if ( !isdefined( var_2.hiddenobjcount ) )
                var_2.hiddenobjcount = 1;
            else
                var_2.hiddenobjcount++;
        }

        if ( self.health <= 0 )
            break;
    }

    level.start_chopper_boss++;
    self delete();
}

_id_127D9( var_0 )
{
    level endon( "game_ended" );
    self setcandamage( 1 );
    self.found = [];

    for (;;)
    {
        self waittill( "damage", var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 );

        if ( isdefined( var_10 ) )
        {
            if ( var_5 == "MOD_EXPLOSIVE" || var_5 == "MOD_GRENADE_SPLASH" )
                continue;
        }
        else if ( isdefined( var_14.streakinfo ) && scripts\mp\utility\killstreak::iskillstreak( var_14.streakinfo.streakname ) )
        {
            self.health = 5;
            continue;
        }

        if ( !isdefined( self.found[var_2.guid] ) )
        {
            self.found[var_2.guid] = 1;

            if ( !isdefined( var_2.hiddenobjcount ) )
                var_2.hiddenobjcount = 1;
            else
                var_2.hiddenobjcount++;
        }

        if ( self.health <= 0 )
            break;
    }

    level.start_coop_bomb_case_defusal++;
    self delete();
}
