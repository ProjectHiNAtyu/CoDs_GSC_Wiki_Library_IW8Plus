// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

init()
{
    if ( getdvarint( "scr_arms_deal_enabled", 1 ) > 0 && istrue( level.prepickupweapon ) )
    {
        _handlefieldupgradepurchase::registerscriptedagent();
        helipad_getheli();
        level thread init_intro_anims();
    }
}

helipad_getheli()
{
    if ( !isdefined( level.ai_event ) )
        level.ai_event = spawnstruct();

    level.ai_event.armorbox_usedcallback = getdvarint( "scr_arms_deal_ai_event_cooldown_time", 15 );
    level.ai_event.armorweapon = getdvarfloat( "scr_arms_deal_ai_event_timeout_time", 180 );
    level.ai_event.applylocaledefaults = getdvarint( "scr_arms_deal_total_agent_points_wave_1", 15 );
    level.ai_event.applylocaledvars = getdvarint( "scr_arms_deal_total_agent_points_wave_2", 50 );
    level.ai_event.applyminigunrestrictions = getdvarint( "scr_arms_deal_total_agent_points_wave_3", 25 );
    level.ai_event.applyxyzoffset = getdvarint( "scr_arms_deal_agent_spawn_count_max", 8 );
    level.ai_event.applyprematchplotarmor = getdvarint( "scr_arms_deal_agent_spawn_count_base", 6 );
    level.ai_event.aq_ontimerexpired = getdvarint( "scr_arms_deal_agent_spawn_count_min", 6 );
    level.ai_event.applyquest = getdvarint( "scr_arms_deal_agent_spawn_count_gain_per_wave", 2 );
    level.ai_event.aq_playerdisconnect = getdvarint( "scr_arms_deal_agent_spawn_next_group_threshold", 7 );
    level.ai_event.apcturret = getdvarint( "scr_arms_deal_agent_health_value_default", 100 );
    level.ai_event.apc_rus_update = getdvarint( "scr_arms_deal_agent_armor_value_default", 250 );
    level.ai_event.apc_rus_updatedriverturretammoui = getdvarint( "scr_arms_deal_agent_armor_gain_per_wave", 50 );
    level.ai_event.applymovingcircles = getdvarfloat( "scr_arms_deal_agent_reposition_interval", 5 );
    level.ai_event.apc_rus_monitordriverturretfire = getdvarfloat( "scr_arms_deal_agent_accuray_max", 0.45 );
    level.ai_event.apc_rus_initdamage = getdvarfloat( "scr_arms_deal_agent_accuray_base", 0.27 );
    level.ai_event.apc_rus_monitordriverturretreload = getdvarfloat( "scr_arms_deal_agent_accuray_min", 0.25 );
    level.ai_event.apc_rus_initomnvars = getdvarfloat( "scr_arms_deal_agent_accuray_gain_per_wave", 0.12 );
    level.ai_event.apc_target_enemies = getdvarint( "scr_arms_deal_agent_brute_health_default", 10000 );
    level.ai_event.apc_shoot_at_target = getdvarint( "scr_arms_deal_agent_brute_armor_default", 10000 );
    level.ai_event.aq_ontimerupdate = getdvarfloat( "scr_arms_deal_agent_spawn_delay_after_brute_spawn", 0 );
    level.ai_event.apcrespawntime = getdvarfloat( "scr_arms_deal_agent_agent_brute_stop_agent_spawns_at_health_percentage", 0.2 );
    level.ai_event.appliednukethreads = getdvarint( "scr_arms_deal_agent_melee_damage", 30 );
    level.ai_event.apce_p1 = getdvarint( "scr_arms_deal_agent_brute_melee_damage", 90 );
    level.ai_event.setuptrain = getdvarfloat( "scr_arms_deal_agent_minimap_ping_lifetime", 0.5 );
    level.ai_event.setuptimelimit = getdvarfloat( "scr_arms_deal_agent_minimap_ping_interval", 2.5 );
}

init_intro_anims()
{
    scripts\cp\utility\cp_controlled_callbacks::init_battlechatter();
    level.agent_funcs["actor_enemy_lw_br"]["on_damaged"] = ::are_relics_active;
    level.agent_funcs["actor_enemy_lw_br_brute"]["on_damaged"] = ::are_relics_active;
    level.agent_funcs["actor_enemy_lw_br"]["gametype_on_damage_finished"] = ::area1_targets;
    level.agent_funcs["actor_enemy_lw_br_brute"]["gametype_on_damage_finished"] = ::area1_targets;
    level.cleanupallbutxcratesforteam = 1;
    level.ispayloadautomaticallymoving = ::_id_11F3A;

    if ( !isdefined( level.ai_event ) )
        level.ai_event = spawnstruct();

    level.ai_event.inited = 0;
    level.ai_event.states = [ "inactive", "wave_incoming", "wave_active", "wave_active_brute", "wave_complete", "complete" ];
    level.ai_event.current_state = "inactive";
    level.ai_event._id_1273D = -1;
    level.ai_event.spawn_points = scripts\engine\utility::getstructarray( "agent_spawn_point_team_200", "targetname" );
    level.ai_event._id_1223B = [];
    level.ai_event.enemygunship_watchtargets = [];
    level.ai_event.mortar_remove_fov_user_scale = asm_playfacialaniminternalmp();
    level.ai_event.mortar_smoke_occlusions = [];
    level.ai_event.init_manned_turret = getent( "br_soa_tower_ai_event_vol", "targetname" );
    level.ai_event scripts\mp\utility\trigger::makeenterexittrigger( level.ai_event.init_manned_turret, ::_id_12912, ::_id_12913, undefined, undefined, ::_id_1290C );
    level.ai_event.use_contract = [];
    level.ai_event.use_struct = [];
    level.ai_event.use_trace_radius = [];
    level.ai_event.use_nvg_think = [];
    level.ai_event.battle_tracks_stopbattletrackstoalloccupants = [];
    level.ai_event._id_12780 = 0;
    level.ai_event._id_12781 = [];
    level.ai_event._id_12782 = 0;
    level.ai_event._id_12F88 = [];
    level.ai_event.hvt_waittill_pickup_players_gobackup = -1;
    level.ai_event.cp_dntsk_raid_sound_load = 0;
    level.ai_event.applycirclesettings = [];
    level.ai_event.applycirclesettings[0] = getdvarint( "scr_arms_deal_total_agent_points_wave_0", 10 );
    level.ai_event.applycirclesettings[1] = level.ai_event.applylocaledefaults;
    level.ai_event.applycirclesettings[2] = level.ai_event.applylocaledefaults;
    level.ai_event.applycirclesettings[3] = level.ai_event.applylocaledefaults;
    level.ai_event.lap = 1;
    level.ai_event.impactfunc_fire = [];
    level.ai_event._id_11D7F = [];
    level.ai_event.impactfunc_explo = [ "smg", "smg_frag", "smg_molotov", "smg_flash", "smg_gas", "smg_smoke", "assault", "assault_frag", "assault_molotov", "assault_flash", "assault_gas", "assault_smoke", "brute_danny_the_firecracker", "brute_johnny_the_detonator", "brute_tommy_the_toxic", "brute_gary_the_blinder", "brute_anthony_fogwalker" ];
    level.ai_event.fulton_init = 0;
    level.ai_event._id_12F8B = "NULL";
    level.ai_event.play_hack_reminder_goto1 = 0;
    waittillframeend;
    scripts\mp\gametypes\br_soa_tower_rewards::init();
    scripts\mp\flags::gameflagwait( "prematch_done" );

    if ( !scripts\engine\utility::flag_exist( "scriptables_ready" ) )
        scripts\engine\utility::flag_init( "scriptables_ready" );

    level.ai_event thread init_level_drop_structs();
    level.ai_event thread arenaballs();
}

init_level_drop_structs()
{
    var_0 = scripts\engine\utility::getstruct( "arms_deal_start_button", "targetname" );
    var_1 = 0;
    var_2 = scripts\engine\utility::ter_op( var_1, ( 8, 17, 3 ), ( 0, 0, 0 ) );
    var_3 = scripts\mp\gameobjects::createhintobject( var_0.origin + var_2, "HINT_BUTTON", undefined, &"BR_SOA_EVENT/AI_EVENT_INTERACT" );
    var_3 thread init_loadout_selection_structs();
    var_3 waittill( "trigger" );
    var_3 notify( "kill_interact_fx" );
    var_3 delete();
    level thread init_hacking_consoles();
}

init_loadout_selection_structs()
{
    self endon( "death" );
    self endon( "kill_interact_fx" );

    for (;;)
    {
        playsoundatpos( self.origin, "emt_soa_static_glitch" );
        wait 4.0;
    }
}

init_hacking_consoles()
{
    level.ai_event thread init_laser();
    wait 0.01;

    if ( level.ai_event.fulton_init < 1 )
        init_intro_obj( "br_soa_tower_event_arms_deal" );

    level.ai_event.play_hack_reminder_goto1 = 1;
    level.ai_event.fulton_init = level.ai_event.fulton_init + 1;
    _id_12A2B();
    level.ai_event init_leave_cave();
}

init_intro_armor()
{
    if ( !level.ai_event.lap )
        return;

    var_0 = [];
    var_0[1] = [ "brute_danny_the_firecracker", "brute_johnny_the_detonator", "brute_tommy_the_toxic", "brute_gary_the_blinder", "brute_anthony_fogwalker" ];
    var_0[2] = [ "smg_molotov", "assault_molotov", "smg_flash", "assault_flash" ];
    var_0[3] = [ "smg_frag", "assault_frag", "smg_gas", "assault_gas" ];
    var_0[4] = [ "smg", "assault" ];
    var_1 = scripts\engine\utility::random( var_0[1] );
    level.ai_event._id_11D7F[0] = var_1;
    var_2 = undefined;

    switch ( var_1 )
    {
        case "brute_danny_the_firecracker":
            var_2 = "molotov";
            break;
        case "brute_johnny_the_detonator":
            var_2 = "frag";
            break;
        case "brute_tommy_the_toxic":
            var_2 = "gas";
            break;
        case "brute_gary_the_blinder":
            var_2 = "flash";
            break;
        case "brute_anthony_fogwalker":
            var_2 = "smoke";
            break;
    }

    var_3 = 2;
    var_4 = [];

    for ( var_5 = 1; var_5 <= var_3; var_5++ )
    {
        var_6 = 3;
        var_7 = 5 - var_5;
        var_4[var_5] = [];

        for ( var_8 = 4; var_8 >= var_7; var_8-- )
        {
            var_9 = var_0[var_8];

            foreach ( var_11 in var_9 )
            {
                if ( issubstr( var_11, var_2 ) )
                    var_9 = scripts\engine\utility::array_remove( var_9, var_11 );
            }

            var_4[var_5] = scripts\engine\utility::array_combine_unique( var_4[var_5], var_9 );
        }

        level.ai_event.impactfunc_fire[var_5] = var_4[var_5];
    }

    level.ai_event.lap = 0;
}

init_leave_cave()
{
    level.ai_event init_hacking_consoles_internal();
    level.ai_event init_intro_armor();
    var_0 = level.ai_event.impactfunc_fire[level.ai_event.fulton_init];

    switch ( level.ai_event.fulton_init )
    {
        case 1:
            level.ai_event thread armsrace_phase_hold_behavior( var_0, 4, 7, level.ai_event.applycirclesettings[1] );
            break;
        case 2:
            level.ai_event thread armsrace_phase_hold_behavior( level.ai_event._id_11D7F, 3, 5, 1 );
            level.ai_event thread armsrace_phase_hold_behavior( var_0, 4, 7, level.ai_event.applycirclesettings[2], level.ai_event.aq_ontimerupdate );
            break;
        default:
            level.ai_event thread armsrace_phase_hold_behavior( level.ai_event.impactfunc_explo, 3, 6, level.ai_event.applycirclesettings[0] );
            break;
    }

    level.ai_event init_intel();
}

init_hacking_consoles_internal()
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );
    level.ai_event.current_state = "wave_incoming";
    _id_12A2D( "wave_incoming" );
    var_0 = 0;
    var_1 = gettime() / 1000;
    var_2 = gettime() / 1000;
    var_3 = scripts\engine\utility::ter_op( level.ai_event.fulton_init == 1, 1, 10 );

    for (;;)
    {
        var_4 = gettime() / 1000;
        var_0 = var_3 - ( var_4 - var_1 );

        foreach ( var_6 in level.ai_event.use_struct )
        {
            if ( isdefined( var_6.armored_basic_combat ) )
            {
                var_6.armsdealer_loadout_interaction setvalue( ceil( var_0 ) );

                if ( var_4 - var_2 > 1.0 )
                {
                    var_7 = init_loot_structs( var_0 );
                    var_6 playlocalsound( var_7 );
                    var_2 = gettime() / 1000;
                }
            }
        }

        if ( var_0 <= 0 )
            break;

        waitframe();
    }

    if ( level.ai_event.fulton_init > 1 )
    {
        foreach ( var_6 in level.ai_event.use_struct )
            var_6 playlocalsound( "iw8_games_splash_silver" );
    }

    level.ai_event._id_1273D = gettime();
    level.ai_event.current_state = "wave_active";
    level.ai_event.hvt_waittill_pickup_players_gobackup = level.ai_event.applycirclesettings[level.ai_event.fulton_init];
    _id_12A2D( "wave_active" );
}

init_intel()
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );
    var_0 = gettime() / 1000;
    var_1 = 0;
    var_2 = undefined;

    for (;;)
    {
        var_3 = gettime() / 1000;
        var_1 = floor( var_3 - var_0 );

        if ( var_1 >= level.ai_event.armorweapon && level.ai_event.use_struct.size == 0 )
        {
            level.ai_event.fulton_init = level.ai_event.fulton_init - 1;
            var_2 = "timeout";
            break;
        }

        if ( level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size <= 0 && level.ai_event._id_12F88.size == 0 )
        {
            var_2 = "success";
            break;
        }

        wait 0.1;
    }

    init_infil( var_2 );
}

init_infil( var_0 )
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );

    switch ( var_0 )
    {
        case "success":
            level.ai_event.current_state = "wave_complete";
            _id_12A2D( "wave_complete" );

            if ( level.ai_event.fulton_init < 2 )
            {
                init_intro_obj( "br_soa_tower_ai_event_wave_cleared", int( level.ai_event.fulton_init ) );
                wait 0.1;
                level thread init_hacking_consoles();
            }
            else
            {
                init_intro_obj( "br_soa_tower_event_arms_deal_complete_full_splash" );
                level.ai_event.current_state = "complete";
                _id_12A2D( "complete" );
                scripts\mp\gametypes\br_soa_tower_rewards::_id_11B16( "most_agent_kills" );

                foreach ( var_2 in level.ai_event.use_struct )
                {
                    if ( getdvarint( "seasonal_event_id_num", 0 ) == 6 )
                        var_2 scripts\cp\helicopter\chopper_boss::_id_11A49( "t9_ch_global_complete_side_mission_for_s3_5_event_wz", 1 );
                }

                init_lbravo_spawn_after_level_restart();
            }

            break;
        case "timeout":
            init_intro_obj( "br_soa_tower_ai_event_timer_expired" );

            foreach ( var_5 in level.ai_event.battle_tracks_stopbattletrackstoalloccupants )
            {
                var_5.spawnhandled = 1;
                var_5 [[ var_5.get_center_loc_among_target_players ]]();
                var_5 kill();
            }

            init_lbravo_spawn_after_level_restart();
            break;
    }
}

init_lbravo_spawn_after_level_restart()
{
    level.ai_event.lap = 1;
    level.ai_event._id_11D7F = [];
    level.ai_event.cp_dntsk_raid_sound_load = 0;
    level.ai_event.play_hack_reminder_goto1 = 0;
    level.ai_event._id_1273D = -1;
    level.ai_event.fulton_init = 0;
    level.ai_event.current_state = "inactive";
    level.ai_event.hvt_waittill_pickup_players_gobackup = -1;
    level.ai_event._id_12F88 = [];
    _id_12A2C();

    foreach ( var_1 in level.ai_event.use_nvg_think )
    {
        var_1.armorqueued = 0;
        var_1.armorstructreplenish = 0;
    }

    level.ai_event.use_nvg_think = [];
    level thread init_level_drop_structs();
    level.ai_event notify( "soa_tower_stop_ai_event" );
}

init_laser()
{
    level endon( "game_ended" );
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level.ai_event notify( "stop_subscription_watcher" );
    level.ai_event endon( "stop_subscription_watcher" );

    for (;;)
    {
        var_0 = scripts\engine\utility::array_combine_unique( level.ai_event.use_contract, level.ai_event.use_struct );

        foreach ( var_2 in var_0 )
        {
            var_3 = var_2 init_key();

            if ( !var_3 && var_2 init_laser_traps() )
                var_2 init_killstreak_data_for_challenges();
            else if ( isalive( var_2 ) )
                var_2 init_laser_trap();
            else
                var_2 init_laser_panel_anims();

            var_4 = gettime() / 1000;

            foreach ( var_2 in level.ai_event.use_trace_radius )
            {
                var_6 = gettime() / 1000 - var_2.armsrace_c4_charge_detonate_think / 1000;
                var_7 = var_2.arms2think;

                if ( isdefined( var_7 ) )
                {
                    if ( var_7.hidden )
                        var_7 scripts\mp\hud_util::showelem();

                    var_7 setvalue( ceil( 10 - var_6 ) );
                }

                if ( var_2 init_laser_traps() )
                {
                    var_2 init_killstreak_data_for_challenges();

                    if ( isdefined( var_7 ) )
                        var_7 scripts\mp\hud_util::hideelem();

                    continue;
                }

                if ( var_6 >= 10 )
                {
                    var_2 init_laser_panel_anims();
                    init_intro_heli_anims( var_2, "br_soa_tower_ai_event_unsubscribe" );
                }
            }
        }

        wait 0.1;
    }
}

init_killstreak_data_for_challenges()
{
    if ( !isdefined( self ) )
        return;

    if ( !init_key() )
    {
        level.ai_event.use_struct = scripts\engine\utility::array_add( level.ai_event.use_struct, self );
        self.armorqueued = 0;
        self.armorstructreplenish = 0;
        _id_12A31();

        if ( level.ai_event.current_state != "inactive" )
            init_intro_heli_anims( self, "br_soa_tower_event_arms_deal" );
    }
    else if ( init_jugg_maze() )
    {
        self.armsrace_c4_charge_detonate_think = undefined;
        level.ai_event.use_trace_radius = scripts\engine\utility::array_remove( level.ai_event.use_trace_radius, self );
    }
}

init_laser_panel_anims()
{
    if ( !isdefined( self ) )
        return;

    if ( init_key() )
    {
        _id_12A32();
        level.ai_event.use_struct = scripts\engine\utility::array_remove( level.ai_event.use_struct, self );
        level.ai_event.use_trace_radius = scripts\engine\utility::array_remove( level.ai_event.use_trace_radius, self );
    }
}

init_laser_trap()
{
    if ( !isdefined( self ) )
        return;

    if ( init_key() && !init_jugg_maze() )
    {
        self.armsrace_c4_charge_detonate_think = gettime();
        level.ai_event.use_trace_radius = scripts\engine\utility::array_add( level.ai_event.use_trace_radius, self );
    }
}

init_laser_traps()
{
    if ( !isdefined( self ) )
        return 0;

    var_0 = 150;
    var_1 = abs( self.origin[2] - ( level.ai_event.init_manned_turret.origin[2] - var_0 ) ) < 100;

    if ( scripts\engine\utility::array_contains( level.ai_event.use_contract, self ) && var_1 )
        return 1;

    return 0;
}

init_key()
{
    if ( !isdefined( self ) )
        return 0;

    return scripts\engine\utility::array_contains( level.ai_event.use_struct, self );
}

init_jugg_maze()
{
    if ( !isdefined( self ) )
        return 0;

    return scripts\engine\utility::array_contains( level.ai_event.use_trace_radius, self );
}

init_lethal_boxes( var_0 )
{
    foreach ( var_2 in level.ai_event.battle_tracks_stopbattletrackstoalloccupants )
    {
        if ( isdefined( var_2.play_3p_anim ) )
        {
            if ( var_0 )
            {
                scripts\mp\objidpoolmanager::objective_playermask_addshowplayer( var_2.play_3p_anim, self );
                continue;
            }

            scripts\mp\objidpoolmanager::objective_playermask_hidefrom( var_2.play_3p_anim, self );
        }
    }
}

init_keypad_display_digits()
{
    if ( !isdefined( self ) )
        return 0;

    if ( !scripts\engine\utility::array_contains( level.ai_event.use_nvg_think, self ) )
    {
        level.ai_event.use_nvg_think = scripts\engine\utility::array_add( level.ai_event.use_nvg_think, self );
        self.armorqueued = 0;
        self.armorstructreplenish = 0;
    }
}

init_loot_structs( var_0 )
{
    return "ui_mp_timer_countdown_10";
    return "ui_mp_timer_countdown";
    return "ui_mp_timer_countdown_half_sec";
    return "ui_mp_timer_countdown_quarter_sec";
    return "ui_mp_timer_countdown_1";
}

_id_12912( var_0, var_1 )
{
    if ( !isdefined( var_0 ) )
        return;

    if ( issubstr( var_1.targetname, "event" ) )
    {
        if ( isplayer( var_0 ) && !scripts\engine\utility::array_contains( level.ai_event.use_contract, var_0 ) )
        {
            level.ai_event.use_contract = scripts\engine\utility::array_add( level.ai_event.use_contract, var_0 );
            var_0 init_lethal_boxes( 1 );
        }
    }

    if ( issubstr( var_1.targetname, "garage" ) )
    {
        var_2 = getsubstr( var_1.targetname, 11 );

        if ( isdefined( var_0.reset_ability_invulnerable ) )
        {
            if ( isplayer( var_0 ) && scripts\engine\utility::array_contains( level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players, var_0 ) )
                level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players = scripts\engine\utility::array_remove( level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players, var_0 );
        }

        if ( isplayer( var_0 ) && !scripts\engine\utility::array_contains( level.ai_event.mortar_remove_fov_user_scale[var_2].players, var_0 ) )
        {
            level.ai_event.mortar_remove_fov_user_scale[var_2].players = scripts\engine\utility::array_add( level.ai_event.mortar_remove_fov_user_scale[var_2].players, var_0 );
            var_0.reset_ability_invulnerable = var_2;
        }
    }
}

_id_12913( var_0, var_1 )
{
    if ( !isdefined( var_0 ) )
        return;

    if ( issubstr( var_1.targetname, "event" ) )
    {
        if ( isplayer( var_0 ) && scripts\engine\utility::array_contains( level.ai_event.use_contract, var_0 ) )
        {
            level.ai_event.use_contract = scripts\engine\utility::array_remove( level.ai_event.use_contract, var_0 );
            var_0 init_lethal_boxes( 0 );

            if ( isdefined( var_0.reset_ability_invulnerable ) )
            {
                if ( isplayer( var_0 ) && scripts\engine\utility::array_contains( level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players, var_0 ) )
                    level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players = scripts\engine\utility::array_remove( level.ai_event.mortar_remove_fov_user_scale[var_0.reset_ability_invulnerable].players, var_0 );
            }
        }
    }

    if ( issubstr( var_1.targetname, "garage" ) )
    {
        waitframe();
        var_2 = getsubstr( var_1.targetname, 11 );
        var_3 = var_2 != var_0.reset_ability_invulnerable;

        if ( isplayer( var_0 ) && scripts\engine\utility::array_contains( level.ai_event.mortar_remove_fov_user_scale[var_2].players, var_0 ) && var_3 )
            level.ai_event.mortar_remove_fov_user_scale[var_2].players = scripts\engine\utility::array_remove( level.ai_event.mortar_remove_fov_user_scale[var_2].players, var_0 );
    }
}

_id_1290C( var_0, var_1 )
{
    if ( !isdefined( var_0 ) )
        return 1;

    if ( !isplayer( var_0 ) )
        return 1;

    return 0;
}

init_intro_obj( var_0, var_1 )
{
    var_2 = undefined;

    if ( isdefined( var_1 ) )
    {
        var_2 = spawnstruct();
        var_2.intvar = var_1;
    }

    foreach ( var_4 in level.ai_event.use_struct )
        scripts\mp\gametypes\br_quest_util::displayplayersplash( var_4, var_0, var_2 );
}

init_intro_heli_anims( var_0, var_1, var_2 )
{
    var_3 = undefined;

    if ( isdefined( var_2 ) )
    {
        var_3 = spawnstruct();
        var_3.intvar = var_2;
    }

    scripts\mp\gametypes\br_quest_util::displayplayersplash( var_0, var_1, var_3 );
}

_id_11F3A()
{
    if ( scripts\mp\utility\game::getgametype() != "brtdm" )
        return;

    if ( !isdefined( level.teamnamelist ) || !scripts\engine\utility::array_contains( level.teamnamelist, "team_two_hundred" ) )
        return;

    scripts\mp\utility\teams::setteamdata( "team_two_hundred", "teamCount", 999 );
}

attack_heli( var_0, var_1, var_2, var_3 )
{
    var_4 = issubstr( var_2, "brute" );
    var_5 = scripts\mp\mp_agent::spawnnewagent( scripts\engine\utility::ter_op( var_4, "actor_enemy_lw_br_brute", "actor_enemy_lw_br" ), "team_two_hundred", var_0, var_1 );

    if ( !isdefined( var_5 ) )
        return;

    level.ai_event.battle_tracks_stopbattletrackstoalloccupants = scripts\engine\utility::array_add( level.ai_event.battle_tracks_stopbattletrackstoalloccupants, var_5 );
    var_5 thread assassinationcontract_complete();
    var_5.type = var_2;
    var_5.cp_arms_dealer_sound_load = var_4;
    var_5 scripts\cp_mp\utility\omnvar_utility::_id_12150( "frag_grenade_mp", 1 );
    var_5 armsrace_caches_defended();
    var_5 asm_setanimscripted();
    var_5 thread assassinationtimewarning();
    var_5.guid = var_5 getguid();
    var_5.name = var_5.guid;
    var_5.agentname = &"BR_SOA_EVENT/HENCHMAN";
    var_5 attachmentisselectablerootname();
    var_5 array_contains_solution();
    var_5 attachmentmap_attachtoblocks( var_2 );
    var_5 attachment( var_3 );

    if ( var_4 )
    {
        var_5 attachmentisselectable();

        foreach ( var_7 in level.ai_event.use_struct )
            var_7 playlocalsound( "ui_splash_zxp_juggspawn" );

        if ( level.ai_event.fulton_init == 2 )
        {
            level.ai_event.cp_dntsk_raid_sound_load = 1;
            _id_12A2D( "wave_active_brute" );
        }
    }

    var_5 thread atcapacitycallback();
    var_5 thread attackpressed();
    return var_5;
}

asm_setanimscripted()
{
    self.recentkillcount = 0;
    self.recentdefendcount = 0;
    self.kills = 0;
    self.deaths = 0;
    self.pers["cur_kill_streak"] = 0;
    self.pers["cur_death_streak"] = 0;
    self.pers["cur_kill_streak_for_nuke"] = 0;
    self.tookweaponfrom = [];
    self.killedplayers = [];
    self._id_12B81 = 0;
}

attachmentisselectablerootname()
{
    self.maxhealth = level.ai_event.apcturret;
    self.health = level.ai_event.apcturret;
    self.health_remaining = level.ai_event.apcturret;
    self.old_load_hvt = level.ai_event.apcturret;
    self.old_maxhealth = level.ai_event.apcturret;
    self.meleedamageoverride = level.ai_event.appliednukethreads;
    self.operator_reward_id = 0;
    self._id_11B1C = undefined;
    self._id_11B1D = undefined;
    self._id_11B19 = 0;
    var_0 = level.ai_event.apc_rus_monitordriverturretfire;
    var_1 = level.ai_event.apc_rus_initdamage;
    var_2 = level.ai_event.apc_rus_monitordriverturretreload;
    var_3 = level.ai_event.apc_rus_initomnvars;
    var_4 = var_1 + var_3 * ( level.ai_event.fulton_init - 1 );
    var_5 = clamp( var_4, var_2, var_0 );
    self.baseaccuracy = var_5;
    self.scripted_long_deaths = 0;
    self.agentdamagefeedback = 1;
    self.get_center_loc_among_target_players = ::area1_targets_mount;
    self.secretstashlootcacheused = scripts\mp\gametypes\br_soa_tower_rewards::select_boss_one_spawners;
    self._id_11E40 = scripts\mp\gametypes\br_soa_tower_rewards::_id_11B1B;
    self.molotov_register_cast = scripts\mp\gametypes\br_soa_tower_rewards::_id_11B17;
    self.spawnhandled = scripts\mp\utility\game::getgametype() == "brtdm";
    self.cp_dntsk_raid_specific_init = 0;
    self.ignoreall = getdvarint( "scr_br_arms_ai_diable_agent_fire", 0 );
}

assassinationcontract_complete()
{
    self endon( "death" );
    level endon( "game_ended" );
    var_0 = randomfloatrange( 1.25, 2.75 );
    wait( var_0 );
    scripts\cp\utility\cp_controlled_callbacks::allow_cp_munitions( self );
    scripts\cp\utility\cp_controlled_callbacks::playorderevent( "move", "movecombat", anim.player );
}

array_contains_solution( var_0 )
{
    if ( scripts\mp\utility\game::getgametype() == "br" )
    {
        if ( !isdefined( var_0 ) )
        {
            var_1 = level.ai_event.apc_rus_update;
            var_2 = level.ai_event.apc_rus_updatedriverturretammoui;
            var_0 = var_1 + clamp( level.ai_event.fulton_init - 1, 0, 10 ) * var_2;
        }

        scripts\mp\gametypes\br_armor::playerpowerscleanupkeybindings();
        scripts\mp\gametypes\br_armor::monitor_truck();
        attachedvelocity( var_0 );
    }
}

attachedvelocity( var_0 )
{
    if ( !isdefined( var_0 ) || var_0 < 0 )
        return;

    self.br_maxarmorhealth = var_0;
    self.br_armorhealth = var_0;
    var_1 = self.br_armorhealth / self.br_maxarmorhealth;

    if ( isplayer( self ) )
    {
        self setclientomnvar( "ui_br_armor_damage", var_1 );
        scripts\mp\equipment\armor_plate::checkifteamrewardsareenabled( self.br_armorhealth );
    }
}

attachmentmap_attachtoblocks( var_0 )
{
    if ( !isdefined( var_0 ) )
        return;

    if ( issubstr( var_0, "assault" ) )
    {
        array_convert_keys_to_ints( "iw8_ar_akilo47" );
        self.goalradius = randomintrange( 100, 200 );
    }

    if ( issubstr( var_0, "smg" ) )
    {
        array_convert_keys_to_ints( "iw8_sm_mpapa5" );
        self.goalradius = randomintrange( 50, 100 );
    }

    var_1 = undefined;

    if ( issubstr( var_0, "frag" ) )
        var_1 = "frag_grenade_mp";

    if ( issubstr( var_0, "molotov" ) )
        var_1 = "molotov_mp";

    if ( issubstr( var_0, "flash" ) )
        var_1 = "flash_grenade_mp";

    if ( issubstr( var_0, "gas" ) )
        var_1 = "gas_grenade_mp";

    if ( issubstr( var_0, "smoke" ) )
        var_1 = "smoke_grenade_mp";

    if ( isdefined( var_1 ) )
        scripts\cp_mp\utility\omnvar_utility::_id_12150( var_1, 2 );

    if ( self.cp_arms_dealer_sound_load )
    {
        scripts\cp_mp\utility\omnvar_utility::_id_12150( "frag_grenade_mp", 10 );
        self.baseaccuracy = 0.65;
        self.meleedamageoverride = 30;
        self.scripted_long_deaths = 1;
        self.maxhealth = level.ai_event.apc_target_enemies;
        self.health = level.ai_event.apc_target_enemies;
        self.health_remaining = level.ai_event.apc_target_enemies;
        self.old_load_hvt = level.ai_event.apc_target_enemies;
        self.old_maxhealth = level.ai_event.apc_target_enemies;
        self.agentdamagefeedback = 0;
        self.combatrecordsupermisc = 8000;
        self.combatrecordincrementkillstreakextrastat = 5;
        self.meleedamageoverride = level.ai_event.apce_p1;
        attachedvelocity( level.ai_event.apc_shoot_at_target );

        switch ( var_0 )
        {
            case "brute_danny_the_firecracker":
                scripts\cp_mp\utility\omnvar_utility::_id_12150( "molotov_mp", 99 );
                array_convert_keys_to_ints( "iw8_ar_mike4", 30 );
                attachmentmap_baseattachtocategory( 10 );
                self.agentname = &"BR_SOA_EVENT/BRUTE_DANNY";
                break;
            case "brute_johnny_the_detonator":
                scripts\cp_mp\utility\omnvar_utility::_id_12150( "frag_grenade_mp", 99 );
                array_convert_keys_to_ints( "iw8_ar_mike4", 32 );
                attachmentmap_baseattachtocategory( 11 );
                self.agentname = &"BR_SOA_EVENT/BRUTE_JOHNNY";
                break;
            case "brute_tommy_the_toxic":
                scripts\cp_mp\utility\omnvar_utility::_id_12150( "gas_grenade_mp", 99 );
                array_convert_keys_to_ints( "iw8_ar_mcharlie", 24 );
                attachmentmap_baseattachtocategory( 12 );
                self.agentname = &"BR_SOA_EVENT/BRUTE_TOMMY";
                break;
            case "brute_gary_the_blinder":
                scripts\cp_mp\utility\omnvar_utility::_id_12150( "flash_grenade_mp", 99 );
                array_convert_keys_to_ints( "iw8_ar_akilo47", 20 );
                attachmentmap_baseattachtocategory( 13 );
                self.agentname = &"BR_SOA_EVENT/BRUTE_GARY";
                break;
            case "brute_anthony_fogwalker":
                scripts\cp_mp\utility\omnvar_utility::_id_12150( "smoke_grenade_mp", 99 );
                array_convert_keys_to_ints( "iw8_ar_anovember94", 3 );
                attachmentmap_baseattachtocategory( 14 );
                self.agentname = &"BR_SOA_EVENT/BRUTE_ANTHONY";
                break;
        }
    }
    else
        attachmentmap_baseattachtocategory( level.ai_event.fulton_init );
}

attachment( var_0 )
{
    var_1 = scripts\engine\utility::ter_op( isdefined( var_0 ), var_0, scripts\engine\utility::random( level.ai_event.mortar_remove_fov_user_scale ) );
    self setgoalvolumeauto( var_1 );
}

array_convert_keys_to_ints( var_0, var_1 )
{
    self.weapon = scripts\mp\class::buildweapon( var_0, [ "laserrange", "none", "none", "none", "none", "none" ], "none", "none", var_1 );
    self giveweapon( self.weapon );
    self.bulletsinclip = weaponclipsize( self.weapon );
    self.primaryweapon = self.weapon;
}

assignspectatortospectatetryagain( var_0 )
{
    if ( level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size <= var_0 && level.ai_event._id_12F88.size == 0 )
    {
        foreach ( var_2 in level.ai_event.battle_tracks_stopbattletrackstoalloccupants )
        {
            if ( !isdefined( var_2.play_3p_anim ) )
                var_2 attachmentisselectable();
            else
                continue;

            var_3 = scripts\engine\utility::array_randomize( level.ai_event.mortar_remove_fov_user_scale );
            var_4 = scripts\engine\utility::random( var_3 );

            foreach ( var_6 in var_3 )
            {
                if ( var_6.players.size > var_4.players.size )
                    var_4 = var_6;
            }

            var_2 setgoalvolumeauto( var_4 );
        }
    }
}

attachmentisselectable()
{
    var_0 = undefined;
    var_1 = undefined;

    if ( self.cp_arms_dealer_sound_load )
    {
        var_1 = "icon_waypoint_jugg";
        var_0 = "BR_SOA_EVENT/BRUTE_";
        var_2 = undefined;

        switch ( self.type )
        {
            case "brute_danny_the_firecracker":
                var_2 = "DANNY";
                break;
            case "brute_johnny_the_detonator":
                var_2 = "JOHNNY";
                break;
            case "brute_tommy_the_toxic":
                var_2 = "TOMMY";
                break;
            case "brute_gary_the_blinder":
                var_2 = "GARY";
                break;
            case "brute_anthony_fogwalker":
                var_2 = "ANTHONY";
                break;
        }

        if ( isdefined( var_2 ) )
            var_0 = var_0 + var_2;
    }
    else
        var_1 = "icon_waypoint_generic";

    var_3 = scripts\mp\objidpoolmanager::requestobjectiveid( 1 );
    self.play_3p_anim = var_3;
    objective_state( self.play_3p_anim, "current" );
    objective_position( self.play_3p_anim, self.origin + ( 0, 0, 100 ) );
    objective_setplayintro( self.play_3p_anim, self.cp_arms_dealer_sound_load );
    objective_setshowoncompass( self.play_3p_anim, 0 );
    objective_setshowdistance( self.play_3p_anim, 0 );
    scripts\mp\objidpoolmanager::update_objective_icon( self.play_3p_anim, var_1 );
    scripts\mp\objidpoolmanager::update_objective_setbackground( self.play_3p_anim, 1 );
    scripts\mp\objidpoolmanager::update_objective_setzoffset( self.play_3p_anim, 80 );
    scripts\mp\objidpoolmanager::update_objective_onentity( self.play_3p_anim, self );

    if ( isdefined( var_0 ) )
        scripts\mp\objidpoolmanager::update_objective_setneutrallabel( self.play_3p_anim, var_0 );

    if ( self.cp_arms_dealer_sound_load )
        scripts\mp\objidpoolmanager::objective_set_pulsate( self.play_3p_anim, 1 );

    scripts\mp\objidpoolmanager::objective_playermask_hidefromall( self.play_3p_anim );

    foreach ( var_5 in level.ai_event.use_struct )
        var_5 init_lethal_boxes( 1 );
}

attachmentmap_baseattachtocategory( var_0 )
{
    if ( !isdefined( var_0 ) )
        var_0 = level.ai_event.fulton_init;

    var_1 = [];

    switch ( var_0 )
    {
        case 1:
            var_1["AI_frag_grenade_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_flash_grenade_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_smoke_grenade_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_concussion_grenade_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_splash_grenade_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_molotov_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_semtex_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_gas_mp"] = randomintrange( 30000, 50000 );
            var_1["AI_gas_grenade_mp"] = randomintrange( 30000, 50000 );
            break;
        case 2:
            var_1["AI_frag_grenade_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_flash_grenade_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_smoke_grenade_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_concussion_grenade_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_splash_grenade_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_molotov_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_semtex_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_gas_mp"] = randomintrange( 5000, 12000 );
            var_1["AI_gas_grenade_mp"] = randomintrange( 5000, 12000 );
            break;
        case 3:
            var_1["AI_frag_grenade_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_flash_grenade_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_smoke_grenade_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_concussion_grenade_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_splash_grenade_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_molotov_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_semtex_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_gas_mp"] = randomintrange( 3000, 6000 );
            var_1["AI_gas_grenade_mp"] = randomintrange( 3000, 6000 );
            break;
        case 10:
            var_1["AI_molotov_mp"] = randomintrange( 2000, 4000 );
            break;
        case 11:
            var_1["AI_frag_grenade_mp"] = randomintrange( 2000, 6000 );
            break;
        case 12:
            var_1["AI_gas_mp"] = randomintrange( 2000, 4000 );
            var_1["AI_gas_grenade_mp"] = randomintrange( 2000, 4000 );
            break;
        case 13:
            var_1["AI_flash_grenade_mp"] = randomintrange( 2000, 6000 );
            break;
        case 14:
            var_1["AI_smoke_grenade_mp"] = randomintrange( 2000, 5000 );
            break;
        default:
            var_1["AI_frag_grenade_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_flash_grenade_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_smoke_grenade_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_concussion_grenade_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_splash_grenade_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_molotov_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_semtex_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_gas_mp"] = randomintrange( 5000, 20000 );
            var_1["AI_gas_grenade_mp"] = randomintrange( 5000, 20000 );
            break;
    }

    if ( var_1.size > 0 )
        scripts\cp_mp\utility\omnvar_utility::_id_1215B( var_1 );
}

attackpressed()
{
    self endon( "death" );

    for (;;)
    {
        self waittill( "grenade_fire", var_0, var_1, var_2, var_3 );

        if ( !scripts\mp\utility\weapon::grenadethrown( var_0 ) )
            continue;

        scripts\mp\weapons::grenadeinitialize( var_0, var_1, var_2, var_3 );
        self notify( "grenade_throw" );

        if ( !isdefined( var_0 ) )
            return;

        if ( !isdefined( var_0.weapon_name ) )
            return;

        var_0.spawnpos = var_0.origin;

        switch ( var_0.weapon_name )
        {
            case "molotov_mp":
                thread scripts\mp\equipment\molotov::molotov_used( var_0 );
                break;
            case "gas_grenade_mp":
                thread scripts\mp\equipment\gas_grenade::gas_used( var_0 );
                break;
        }
    }
}

atcapacitycallback()
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );
    self endon( "terminate_ai_threads" );
    self endon( "death" );
    var_0 = gettime() / 1000;

    for (;;)
    {
        var_1 = self getgoalvolume();
        var_2 = distance2d( self.origin, var_1.origin );
        var_3 = var_2 < 600;
        self._id_13022 = var_3;

        if ( var_3 )
        {
            var_4 = gettime() / 1000;
            var_5 = var_4 - var_0;
            self._id_12718 = var_5;
            var_6 = level.ai_event.applymovingcircles;
            self._id_12719 = var_6 - var_5;

            if ( var_4 - var_0 >= var_6 )
            {
                var_7 = [];

                foreach ( var_9 in level.ai_event.mortar_remove_fov_user_scale )
                {
                    if ( var_9.players.size > 0 && var_9 != var_1 )
                        var_7[var_7.size] = var_9;
                }

                if ( var_7.size > 0 )
                {
                    var_11 = scripts\engine\utility::random( var_7 );
                    self setgoalvolumeauto( var_11 );
                }

                var_0 = gettime() / 1000;
            }
        }
        else
            var_0 = gettime() / 1000;

        wait 1.0;
    }
}

assassinationtimewarning()
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );
    self endon( "terminate_ai_threads" );
    self endon( "death" );

    while ( !self.cp_arms_dealer_sound_load )
    {
        self setperk( "specialty_radarblip", 1 );
        wait( level.ai_event.setuptrain );
        self unsetperk( "specialty_radarblip", 1 );
        wait( level.ai_event.setuptimelimit );
    }
}

armsrace_caches_defended()
{
    if ( !ispointonnavmesh( self.origin, self, 1 ) )
    {
        var_0 = getclosestpointonnavmesh( self.origin, self );

        if ( isdefined( var_0 ) )
            self forceteleport( var_0, self.angles );
    }
}

are_relics_active( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12 )
{
    var_13 = self;

    if ( !isdefined( var_13.agent_type ) || var_13.asm.archetype != "soldier_lw_br" )
        return;

    var_14 = isdefined( var_1 ) && isplayer( var_1 );
    var_15 = isdefined( var_1.owner ) && isplayer( var_1.owner );
    var_16 = var_4 == "MOD_EXPLOSIVE_BULLET" && ( isdefined( var_8 ) && var_8 == "none" ) || var_4 == "MOD_EXPLOSIVE" || var_4 == "MOD_GRENADE_SPLASH" || var_4 == "MOD_PROJECTILE" || var_4 == "MOD_PROJECTILE_SPLASH" || var_4 == "MOD_GRENADE";
    var_17 = var_4 == "MOD_FIRE";

    if ( var_14 || var_15 )
    {
        var_18 = var_2;
        var_19 = weaponclass( var_5 );
        var_20 = scripts\mp\utility\weapon::getweapongroup( var_5 );
        var_21 = scripts\mp\utility\weapon::getequipmenttype( var_5.basename );
        var_22 = var_19 == "throwingknife";

        if ( var_16 && var_19 == "grenade" )
            var_2 = var_18 * 2;

        if ( var_22 )
            var_2 = var_18 * 2.5;
    }

    if ( self.cp_arms_dealer_sound_load && !self.cp_dntsk_raid_specific_init )
    {
        var_23 = float( level.ai_event.apc_target_enemies ) * 0.2;

        if ( self.health < var_23 )
        {
            level.ai_event notify( "stop_pending_agent_spawns" );
            self.cp_dntsk_raid_specific_init = 1;
        }
    }

    scripts\cp\vehicles\vehicle_damage_cp::callbacksoldieragentdamaged( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12 );
}

area1_targets( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 )
{
    var_15 = scripts\engine\utility::ter_op( isdefined( var_2 ), var_2, 0 ) + scripts\engine\utility::ter_op( isdefined( var_13 ), var_13, 0 );
    [[ self._id_11E40 ]]( var_1, var_12, var_4, var_15 );

    if ( self.cp_arms_dealer_sound_load )
        var_1 init_keypad_display_digits();

    scripts\cp\vehicles\vehicle_damage_cp::callbacksoldieragentgametypedamagefinished( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10, var_11, var_12, var_13, var_14 );
}

area1_targets_mount( var_0 )
{
    level.ai_event.battle_tracks_stopbattletrackstoalloccupants = scripts\engine\utility::array_remove( level.ai_event.battle_tracks_stopbattletrackstoalloccupants, self );

    if ( !isdefined( level.ai_event._id_12781[level.ai_event.fulton_init] ) )
        level.ai_event._id_12781[level.ai_event.fulton_init] = 0;

    level.ai_event._id_12781[level.ai_event.fulton_init] = level.ai_event._id_12781[level.ai_event.fulton_init] + 1;
    level.ai_event._id_12780 = level.ai_event._id_12780 + 1;
    assignspectatortospectatetryagain( 3 );

    if ( isdefined( self.play_3p_anim ) )
        objective_delete( self.play_3p_anim );

    if ( self.cp_arms_dealer_sound_load )
    {
        init_intro_obj( "br_soa_tower_reward_brute_eliminated" );
        scripts\mp\gametypes\br_soa_tower_rewards::_id_11B16( "most_brute_damage" );
        level.ai_event notify( "stop_pending_agent_spawns" );
        level.ai_event._id_12F88 = [];

        foreach ( var_2 in level.ai_event.use_struct )
        {
            var_2 playlocalsound( "br_splash_vip_eliminated" );
            var_2 playlocalsound( "mp_enemy_hvt_killed" );
        }

        level.ai_event.cp_dntsk_raid_sound_load = 0;
        assignspectatortospectatetryagain( level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size );
        _id_12A2D( "wave_active_brute" );
    }

    level.ai_event.hvt_waittill_pickup_players_gobackup--;
    _id_12A2F();

    if ( !isdefined( var_0 ) )
        return;

    self.gas_vfx_and_triggers = var_0;
    var_0.agent = self;
    var_0.eattacker init_keypad_display_digits();
    var_4 = spawnstruct();
    var_4.eattacker = var_0.eattacker;
    var_4.origin = self.origin;
    var_4.angles = self.angles;

    if ( !self.spawnhandled )
    {
        level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_ammo", 1, var_4 );
        level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_cash", 1, var_4 );
        level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_gear", 1, var_4 );
        level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_deployables", 1, var_4 );

        if ( self.cp_arms_dealer_sound_load )
        {
            level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_brute", 25, var_4 );
            level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_deployables", 6, var_4 );
            level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_brute_legendary_weapon", 1, var_4 );
            playfx( scripts\engine\utility::getfx( "vfx_golden_loot_explosion_flare" ), self.origin );

            if ( getdvar( "scr_br_gametype", "" ) == "bodycount" )
                level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_power_grab_revive_token", 1, var_4 );
        }

        if ( level.ai_event.fulton_init == 2 && level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size == 0 )
        {
            playfx( scripts\engine\utility::getfx( "vfx_golden_loot_explosion_flare" ), self.origin );
            level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_brute_vault_key", 1, var_4 );

            if ( getdvar( "scr_br_gametype", "" ) == "bodycount" )
                level.ai_event thread [[ self.secretstashlootcacheused ]]( "loot_table_power_grab_dog_tags", 2, var_4 );
        }
    }

    [[ self._id_11E40 ]]( var_0.eattacker, var_0.shitloc, var_0.smeansofdeath, var_0.idamage );
    [[ self.molotov_register_cast ]]( "takedown" );
    [[ self.molotov_register_cast ]]( "assist" );
    [[ self.molotov_register_cast ]]( "killing_blow" );
}

armsrace_phase_hold_behavior( var_0, var_1, var_2, var_3, var_4 )
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level.ai_event endon( "stop_pending_agent_spawns" );
    level endon( "game_ended" );

    if ( isdefined( var_4 ) )
        wait( var_4 );

    for ( var_5 = undefined; !isdefined( var_5 ) || scripts\engine\utility::array_contains_key( level.ai_event._id_12F88, var_5 ); var_5 = randomint( 1000 ) )
    {

    }

    level.ai_event._id_12F88 = scripts\engine\utility::array_add( level.ai_event._id_12F88, var_5 );
    var_6 = level.ai_event.enemygunship_watchtargets;
    var_7 = var_3;
    var_8 = undefined;
    var_9 = undefined;
    var_10 = randomintrange( var_1, var_2 );
    var_11 = 0;

    while ( var_7 > 0 )
    {
        var_12 = level.ai_event.applyxyzoffset;
        var_13 = level.ai_event.applyprematchplotarmor;
        var_14 = level.ai_event.aq_ontimerexpired;
        var_15 = level.ai_event.applyquest * ( level.ai_event.fulton_init - 1 );
        var_16 = clamp( var_13 + var_15, var_14, var_12 );

        while ( level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size >= var_16 )
            wait 1.0;

        if ( var_11 >= var_10 )
            var_11 = 0;

        if ( var_11 == 0 )
        {
            if ( var_6.size == 0 )
                var_6 = level.ai_event.enemygunship_watchtargets;

            var_8 = int( clamp( randomint( var_6.size ), 0, var_6.size ) );
            var_9 = var_6[var_8];
            var_6 = scripts\engine\utility::array_remove_index( var_6, var_8, 0 );
        }

        var_17 = scripts\engine\utility::random( var_0 );
        var_18 = armorbox_used( var_17 );
        var_19 = scripts\engine\utility::ter_op( 1, 1, armsrace_phase_hold_behavior_internal( var_17 ) );

        if ( issubstr( var_17, "brute" ) )
            var_7 = var_19;

        if ( var_19 > var_7 )
        {
            var_20 = [];

            foreach ( var_22 in var_0 )
            {
                if ( var_19 <= var_7 )
                    var_20[var_20.size] = var_22;
            }

            if ( var_20.size > 0 )
                var_17 = scripts\engine\utility::random( var_20 );
            else
                var_18 = 0;
        }

        if ( var_18 )
        {
            var_24 = undefined;
            var_25 = attached_bag( var_9 );

            if ( isdefined( var_25 ) )
                var_24 = attack_next_available_time( var_17, var_25 );

            if ( isdefined( var_24 ) )
            {
                var_7 = var_7 - var_19;
                var_11++;
            }
        }

        waitframe();

        while ( level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size > 7 || level.ai_event.use_struct.size == 0 )
            wait 1.0;
    }

    level.ai_event._id_12F88 = scripts\engine\utility::array_remove( level.ai_event._id_12F88, var_5 );
}

armsrace_phase_hold_behavior_internal( var_0 )
{
    switch ( var_0 )
    {
        case "smg":
            return 1;
        case "smg_frag":
            return 2;
        case "smg_gas":
            return 2;
        case "smg_smoke":
            return 2;
        case "smg_molotov":
            return 3;
        case "smg_flash":
            return 3;
        case "assault":
            return 1;
        case "assault_frag":
            return 1;
        case "assault_gas":
            return 2;
        case "assault_smoke":
            return 2;
        case "assault_molotov":
            return 3;
        case "assault_flash":
            return 3;
    }

    if ( issubstr( var_0, "brute" ) )
        return 10;

    return 1;
}

attachmentsourceweapon( var_0, var_1, var_2, var_3 )
{
    var_4 = [];

    if ( var_1 < 1 )
        return;

    if ( !isdefined( var_2 ) )
        var_2 = scripts\engine\utility::random( level.ai_event.enemygunship_watchtargets );

    for ( var_5 = 0; var_5 < var_1; var_5++ )
    {
        var_6 = scripts\engine\utility::random( var_2 );
        var_7 = attack_heli( var_6.origin, var_6.angles, var_0, var_3 );

        if ( !isdefined( var_7 ) )
            return;

        var_4 = scripts\engine\utility::array_add( var_4, var_7 );
    }

    return var_4;
}

attack_next_available_time( var_0, var_1, var_2 )
{
    var_3 = attack_heli( var_1.origin, var_1.angles, var_0, var_2 );
    return var_3;
}

armorbox_used( var_0 )
{
    return scripts\engine\utility::array_contains( level.ai_event.impactfunc_explo, var_0 );
}

attached_bag( var_0 )
{
    var_1 = undefined;

    if ( !isdefined( var_0 ) )
        return undefined;

    var_0 = scripts\engine\utility::array_randomize( var_0 );

    foreach ( var_3 in var_0 )
    {
        var_4 = [];

        foreach ( var_6 in var_3.spawn_silo_door_ai )
        {
            if ( var_6.players.size > 0 )
                var_4 = scripts\engine\utility::array_combine_unique( var_4, var_6.players );
        }

        if ( var_4.size == 0 )
        {
            var_1 = var_3;
            continue;
        }

        var_8 = 1;

        foreach ( var_10 in var_4 )
        {
            var_11 = distance2d( var_10.origin, var_3.origin );
            var_12 = var_11 <= 500;

            if ( var_12 )
            {
                var_8 = 0;
                continue;
            }

            var_13 = scripts\engine\utility::within_fov( var_10.origin, var_10.angles, var_3.origin, cos( 45 ) );
            var_14 = scripts\engine\utility::ter_op( var_13, spawnsighttrace( var_3, var_10.origin + ( 0, 0, 75 ), var_3.origin + ( 0, 0, 50 ) ) > 0.2, 0 );

            if ( var_14 )
            {
                var_8 = 0;
                continue;
            }

            if ( var_8 )
                var_1 = var_3;
        }
    }

    return var_1;
}

arenaflag_objectivehide( var_0 )
{
    level.ai_event endon( "soa_tower_stop_ai_event" );
    level endon( "game_ended" );

    while ( level.ai_event.spawn_points.size == 0 || !isdefined( level.ai_event.use_contract ) )
        wait 0.1;

    for (;;)
    {
        for ( var_1 = 0; var_1 < var_0.size; var_1++ )
        {
            var_2 = var_0[var_1].origin;
            var_3 = ( 0, 0, 40 );
            var_4 = -1;
            var_5 = ( 0, 1, 0 );
            var_6 = 0;
            var_7 = 0;
            var_8 = 3200;
            var_9 = 0;

            foreach ( var_11 in level.ai_event.use_contract )
            {
                var_12 = distance2d( var_11.origin, var_2 );
                var_13 = var_11.origin + ( 0, 0, 75 );
                var_14 = var_12 < 3200;
                var_15 = abs( var_2[2] - var_11.origin[2] ) < 200;
                var_9 = scripts\engine\utility::within_fov( var_11.origin, var_11.angles, var_2, cos( 45 ) );
                var_16 = scripts\engine\utility::ter_op( var_9, spawnsighttrace( var_0[var_1], var_2, var_13 ) > 0.2, 0 );
                var_17 = var_12 <= 500 && var_15;
                var_18 = var_17 || var_14 && var_15 && ( var_16 && var_9 );

                if ( var_18 )
                {
                    if ( var_12 < var_8 )
                        var_8 = var_12;

                    var_7 = var_7 + var_12;
                    var_6 = var_6 + 1;
                }
            }

            var_20 = -1;
            var_21 = 100;

            if ( var_6 > 0 )
            {
                var_4 = floor( var_7 / var_6 );
                var_20 = ( min( var_4, var_8 ) - 500 ) / 2700 * 100;
                var_21 = floor( max( var_20, 0 ) );
                var_22 = ( 1, 0, 0 );
                var_23 = ( 0, 1, 0 );
                var_5 = vectorlerp( var_22, var_23, var_20 / 100 );
            }

            var_0[var_1]._id_12176 = var_21;
        }

        level.ai_event._id_1223B = scripts\engine\utility::array_sort_with_func( var_0, ::arenaflag_setenabled );
        wait 0.1;
    }
}

arenaflag_setenabled( var_0, var_1 )
{
    return var_0._id_12176 > var_1._id_12176;
}

arenaballs()
{
    var_0 = [];
    var_1 = undefined;
    var_2 = 1050;
    var_3 = 0;

    while ( var_0.size != level.ai_event.spawn_points.size )
    {
        level.ai_event.enemygunship_watchtargets[var_3] = [];

        foreach ( var_5 in level.ai_event.spawn_points )
        {
            if ( !scripts\engine\utility::array_contains( var_0, var_5 ) )
            {
                if ( !isdefined( var_1 ) )
                    var_1 = var_5.origin;

                var_6 = distance2d( var_1, var_5.origin );

                if ( var_6 <= var_2 )
                {
                    var_0 = scripts\engine\utility::array_add( var_0, var_5 );
                    level.ai_event.enemygunship_watchtargets[var_3] = scripts\engine\utility::array_add( level.ai_event.enemygunship_watchtargets[var_3], var_5 );
                    var_5.enemygunship_watchweaponimpact = var_3;
                    var_5.enemyhasuavkill = var_1;
                    var_5.enemymarker = var_2;
                    var_7 = 2000;
                    var_5.spawn_silo_door_ai = [];

                    foreach ( var_9 in level.ai_event.mortar_remove_fov_user_scale )
                    {
                        var_10 = distance2d( var_5.origin, var_9.origin );

                        if ( var_10 < var_7 )
                            var_5.spawn_silo_door_ai = scripts\engine\utility::array_add( var_5.spawn_silo_door_ai, var_9 );
                    }
                }
            }
        }

        var_1 = undefined;
        var_3++;
        waitframe();
    }
}

asm_playfacialaniminternalmp()
{
    var_0 = [];
    var_1 = [ "a", "b", "c" ];

    for ( var_2 = 0; var_2 < var_1.size; var_2++ )
    {
        for ( var_3 = 1; var_3 <= 5; var_3++ )
        {
            var_4 = var_1[var_2] + scripts\engine\utility::string( var_3 );
            var_0[var_4] = getent( "vol_garage_" + var_4, "targetname" );
            var_0[var_4].warningstartcallbacks = var_4;
            var_0[var_4].players = [];
            level.ai_event scripts\mp\utility\trigger::makeenterexittrigger( var_0[var_4], ::_id_12912, ::_id_12913, undefined, undefined, ::_id_1290C );
        }
    }

    return var_0;
}

_id_12A31()
{
    if ( isdefined( self.armored_basic_combat ) )
        return;

    self.arms_race_p1 = _id_12A25( &"BR_SOA_EVENT/WAVE_COUNT", -1, 1.0, ( 1, 1, 1 ), 0, 50 );
    self.armsdealer_loadout_interaction = _id_12A25( &"BR_SOA_EVENT/WAVE_INCOMING", -1, 1.0, ( 1, 1, 1 ), 0, 62 );
    self.arms4think = _id_12A25( &"BR_SOA_EVENT/WAVE_COMPLETE", -1, 1.0, ( 1, 1, 1 ), 0, 50 );
    self.armorylights = _id_12A25( &"BR_SOA_EVENT/WAVE_ENEMIES_REMAINING", -1, 1.0, ( 1, 1, 1 ), 0, 62 );
    self.armoryswitches = _id_12A25( &"BR_SOA_EVENT/AI_EVENT_KILL_THE_BRUTE", undefined, 1.0, ( 1, 1, 1 ), 0, 62 );
    self.arms1think = _id_12A26();
    self.arms2think = _id_12A25( &"BR_SOA_EVENT/AI_EVENT_UNSUBSCRIBING", -1, 1.2, ( 1, 1, 1 ), -300, 100 );
    _id_12A33();
    _id_12A34( level.ai_event.current_state );
}

_id_12A32()
{
    if ( !isdefined( self.armored_basic_combat ) )
        return;

    foreach ( var_1 in self.armored_basic_combat )
    {
        var_1 scripts\mp\hud_util::destroyelem();
        self.armored_basic_combat = scripts\engine\utility::array_remove( self.armored_basic_combat, var_1 );
        var_1 = undefined;
    }

    self.armored_basic_combat = undefined;
}

_id_12A33()
{
    if ( !isdefined( self.armored_basic_combat ) )
        return;

    foreach ( var_1 in self.armored_basic_combat )
        var_1 scripts\mp\hud_util::hideelem();
}

_id_12A2D( var_0 )
{
    foreach ( var_2 in level.ai_event.use_struct )
        var_2 _id_12A34( var_0 );
}

_id_12A2F()
{
    foreach ( var_1 in level.ai_event.use_struct )
    {
        var_2 = scripts\engine\utility::ter_op( level.ai_event.fulton_init < 2, level.ai_event.hvt_waittill_pickup_players_gobackup, level.ai_event.battle_tracks_stopbattletrackstoalloccupants.size );
        var_1.armorylights setvalue( var_2 );
    }
}

_id_12A2B()
{
    foreach ( var_1 in level.ai_event.use_struct )
        var_1 _id_12A31();
}

_id_12A2C()
{
    foreach ( var_1 in level.ai_event.use_struct )
        var_1 _id_12A32();
}

_id_12A34( var_0 )
{
    _id_12A33();

    switch ( var_0 )
    {
        case "inactive":
            break;
        case "wave_incoming":
            self.arms_race_p1 setvalue( level.ai_event.fulton_init );
            self.arms_race_p1 scripts\mp\hud_util::showelem();
            self.armsdealer_loadout_interaction scripts\mp\hud_util::showelem();
            break;
        case "wave_active":
            self.arms_race_p1 setvalue( level.ai_event.fulton_init );
            self.arms_race_p1 scripts\mp\hud_util::showelem();
            self.armorylights setvalue( level.ai_event.hvt_waittill_pickup_players_gobackup );
            self.armorylights scripts\mp\hud_util::showelem();
            break;
        case "wave_active_brute":
            self.arms_race_p1 setvalue( level.ai_event.fulton_init );
            self.arms_race_p1 scripts\mp\hud_util::showelem();

            if ( level.ai_event.cp_dntsk_raid_sound_load )
                self.armoryswitches scripts\mp\hud_util::showelem();
            else
            {
                _id_12A2F();
                self.armorylights scripts\mp\hud_util::showelem();
            }

            break;
        case "wave_complete":
            self.arms4think setvalue( level.ai_event.fulton_init );
            self.arms4think scripts\mp\hud_util::showelem();
            self.armsdealer_loadout_interaction scripts\mp\hud_util::showelem();
            break;
        case "complete":
            self.arms4think setvalue( level.ai_event.fulton_init );
            self.arms4think scripts\mp\hud_util::showelem();
            break;
    }
}

_id_12A24( var_0 )
{
    if ( !isdefined( self.armored_basic_combat ) )
        self.armored_basic_combat = [];

    self.armored_basic_combat = scripts\engine\utility::array_add( self.armored_basic_combat, var_0 );
}

_id_12A25( var_0, var_1, var_2, var_3, var_4, var_5, var_6 )
{
    if ( !isdefined( var_6 ) )
        var_6 = "TOPLEFT";

    var_7 = scripts\mp\hud_util::createfontstring( "default", var_2 );
    var_8 = 40;
    var_9 = ( 1.0 - getdvarfloat( "LQORTPMNLL", 0 ) ) * var_8;
    var_10 = ( 1.0 - getdvarfloat( "NPLKLQMNPL", 0 ) ) * var_8 / 2;
    var_7 scripts\mp\hud_util::setpoint( var_6, var_6, 143 + var_9, var_5 + var_10 );
    var_7.color = var_3;
    var_7.label = var_0;

    if ( isdefined( var_1 ) )
        var_7 setvalue( var_1 );

    var_7 scripts\mp\hud_util::setparent( level.uiparent );
    _id_12A24( var_7 );
    return var_7;
}

_id_12A26()
{
    var_0 = newclienthudelem( self );
    var_0.elemtype = "timer";
    var_0.font = "default";
    var_0.fontscale = 1.25;
    var_0.basefontscale = 1.25;
    var_0.width = 0;
    var_0.height = 10;
    var_0.x = 45;
    var_0.y = 60;
    var_0.xoffset = 0;
    var_0.yoffset = 0;
    var_0.children = [];
    var_0.hidden = 0;
    var_0 scripts\mp\hud_util::setparent( level.uiparent );
    _id_12A24( var_0 );
    return var_0;
}
