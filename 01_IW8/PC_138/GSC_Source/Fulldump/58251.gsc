// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

get_recent_spawn_time_threshold()
{
    if ( !isdefined( level._id_128BB ) )
        level._id_128BB = [];

    level._id_128BB["race"] = ::watchforapcdamage;
}

watchforapcdamage()
{
    level.outofboundstriggers = getentarray( "OutOfBounds", "targetname" );
    blockreviveanimation();

    if ( isdefined( level._id_128C5 ) )
        level._id_128C4 = level._id_128C5;
    else
        level._id_128C4 = 3;

    level._id_128FA = scripts\engine\utility::getstruct( "StrucSpawnATV", "targetname" );

    if ( !isdefined( level._id_128FA ) )
        level._id_128FA = scripts\engine\utility::getstruct( "trial_vehicle_spawn", "targetname" );

    if ( isdefined( level._id_128FA.script_noteworthy ) )
    {
        switch ( level._id_128FA.script_noteworthy )
        {
            case "little_bird":
                level._id_128C6 = 1;
                level.br_standard_loadout = scripts\cp_mp\vehicles\vehicle_spawn::vehicle_spawn_spawnvehicle( "little_bird", level._id_128FA );
                level.ringing = 0.25;
                level.ringphoneoccasionally = 0.25;
                thread keephudhiddentillfadein();
                break;
            case "tac_rover":
            default:
                level.br_standard_loadout = scripts\cp_mp\vehicles\vehicle_spawn::vehicle_spawn_spawnvehicle( "atv", level._id_128FA );
                break;
        }
    }
    else
        level.br_standard_loadout = scripts\cp_mp\vehicles\vehicle_spawn::vehicle_spawn_spawnvehicle( "atv", level._id_128FA );

    level._id_129D8 = getentarray( "shield", "targetname" );
    level.dialog_monitor_shieldstow = getentarray( "center", "targetname" );
    level._id_11BB2 = getentarray( "rpg", "targetname" );

    if ( level._id_11BB2.size > 0 )
    {
        if ( !isdefined( level._id_128CD ) )
            _id_128CC();

        foreach ( var_1 in level._id_11BB2 )
        {
            var_1 thread searchcircleorigin();
            var_1 thread _id_11FBB();

            if ( istrue( level._id_128C6 ) )
                var_1 thread _id_128AE();
        }
    }

    level.x1opsnpc = getentarray( "gate_hide", "targetname" );
    level.heliplayloopbadanim = getentarray( "dyn_gate", "targetname" );

    foreach ( var_4 in level.heliplayloopbadanim )
        var_4 thread heliplayloopropeanim();

    level.course_triggers = getentarray( "progression", "targetname" );
    level.failedtext = getentarray( "progressionfire", "targetname" );

    if ( game["trial"]["tries_remaining"] < level.trial["attempts"] )
        level._id_128D3 = level.br_standard_loadout;

    scripts\engine\utility::getstructarray_delete( "atv_spawn", "targetname" );
    level scripts\engine\utility::flag_init( "trial_completed" );
    level scripts\engine\utility::flag_init( "trial_in_progress" );
    level scripts\engine\utility::flag_init( "trial_player_death" );
    level scripts\engine\utility::flag_init( "trial_start" );
    level scripts\engine\utility::flag_init( "player_not_on_vehicle" );
    level scripts\engine\utility::flag_init( "gate_flares_0" );
    thread _id_12A30();
    thread _id_128B2();

    if ( issubstr( level.trial["zone"], "_gw" ) && game["trial"]["tries_remaining"] == 3 )
        wait 11;

    thread dialog_init();
    thread watchflashgrenadeexplode();
    thread isdragonsbreath();
    thread player_monitor_death();
    thread _id_1242D();
    thread try_add_targetmarkergroup();
    _id_12D53();
    var_6 = getentarray( "traficcone", "targetname" );

    foreach ( var_8 in var_6 )
        var_8 notsolid();

    level._id_128A5 = [];
    _debug_rooftop_raid_exfil::waittill_player_isdefined();
    waitframe();
    level._id_128FB = scripts\mp\utility\outline::outlineenableforplayer( level.br_standard_loadout, level.player, "outline_trial_item", "level_script" );

    if ( istrue( level._id_12899 ) )
    {
        var_10 = getentarray( "OutOfBounds", "targetname" );

        foreach ( var_12 in var_10 )
            var_12 scripts\engine\utility::trigger_off();
    }

    thread watchdangerresetaction();

    foreach ( var_15 in level._id_128A5 )
        var_15 thread hacking_lua_notify_func();

    setomnvar( "ui_trial_objective_total", level._id_128A5.size );
    level.nosuspensemusic = 1;

    if ( issubstr( level.trial["zone"], "_gw" ) && game["trial"]["tries_remaining"] == 3 )
    {
        level.player scripts\mp\utility\dialog::leaderdialogonplayer( "trial_intro" );
        wait 8;
    }
}

_id_128B2()
{
    if ( issubstr( level.trial["zone"], "_gw" ) && game["trial"]["tries_remaining"] == 3 )
    {
        while ( !isalive( level.player ) )
            waitframe();

        wait 1;
        level.player freezecontrols( 1 );
        level.player freezelookcontrols( 1 );
        var_0 = newhudelem();
        var_0.x = 0;
        var_0.y = 0;
        var_0 setshader( "black", 640, 480 );
        var_0.alignx = "left";
        var_0.aligny = "top";
        var_0.sort = 1;
        var_0.horzalign = "fullscreen";
        var_0.vertalign = "fullscreen";
        var_0.foreground = 1;
        var_0.alpha = 1;
        wait 22;
        var_0.alpha = 1;
        var_0 fadeovertime( 4 );
        var_0.alpha = 0;
        level.player freezecontrols( 0 );
        level.player freezelookcontrols( 0 );
    }
}

_id_1242D()
{
    var_0 = getent( "StartWaypoint", "targetname" );
    _debug_rooftop_raid_exfil::waittill_player_isdefined();

    while ( !isdefined( level.player.vehicle ) )
        waitframe();

    level scripts\engine\utility::flag_set( "trial_start" );
    scripts\mp\utility\outline::outlinedisable( level._id_128FB, level.br_standard_loadout );
    _debug_rooftop_raid_exfil::_id_128F2();

    if ( !istrue( level._id_128C6 ) )
    {
        level.player allowmovement( 0 );
        level.player freezecontrols( 1 );
        wait 1.5;
    }

    level._id_128B4 = var_0.origin;
    level._id_128B3 = thread _id_121EE();
    scripts\mp\gamelogic::teamstarttimer( level.player.team, 3 );
    level.player setclientomnvar( "ui_match_start_countdown", -1 );
    level scripts\engine\utility::flag_set( "gate_flares_0" );
    level.player playsound( "trial_sfx_start" );
    setmusicstate( "" );

    if ( !istrue( level._id_128C6 ) )
    {
        level.player allowmovement( 1 );
        level.player freezecontrols( 0 );
    }

    level scripts\engine\utility::flag_set( "trial_in_progress" );
    thread getquestrewardgroupstablerewards();
    thread _id_12C67();
    _debug_rooftop_raid_exfil::_id_128F3( 0 );
    hud_timer();
}

watchflashgrenadeexplode()
{
    level endon( "trial_completed" );
    level.removematchingents_bycodeclassname = [];
    level._id_128B4 = ( 0, 0, 0 );
    level.start_timer = ( 0, 0, 0 );
    level scripts\engine\utility::flag_wait( "trial_start" );
    var_0 = getent( "StartCheckpoint", "targetname" );
    level.fulton_destroy = var_0;
    var_0 waittill( "trigger" );

    if ( isdefined( level.fulton_destroy.juggheli_spawner_jammer5_3 ) )
    {
        level.player playsound( "trial_sfx_success" );
        stopfxontag( scripts\engine\utility::getfx( "circle" ), level.fulton_destroy.juggheli_spawner_jammer5_3, "tag_origin" );
        level.fulton_destroy.juggheli_spawner_jammer5_3 delete();
    }

    if ( isdefined( level._id_1288C ) )
        level._id_1288C--;

    var_1 = getent( level.fulton_destroy.target, "targetname" );
    level._id_128B4 = var_1.origin;
    level.start_timer = var_1.origin;

    if ( isdefined( level._id_128B3 ) )
        level._id_128B3 moveto( level._id_128B4, 0.5, 0.1, 0.3 );

    var_2 = thread _id_1222E();
    level.player setclientomnvar( "ui_edge_glow_trials", 255 );
    level.player scripts\engine\utility::delaycall( 0.5, ::setclientomnvar, "ui_edge_glow_trials", 0 );

    for (;;)
    {
        var_1 waittill( "trigger" );

        if ( isdefined( level._id_1288C ) )
            level._id_1288C--;

        level.do_cache_2_prep++;
        level._id_12740 = 0;
        level._id_12742 = 6;
        level.fulton_destroy = var_1;

        if ( isdefined( level.fulton_destroy.juggheli_spawner_jammer5_3 ) )
        {
            stopfxontag( scripts\engine\utility::getfx( "circle" ), level.fulton_destroy.juggheli_spawner_jammer5_3, "tag_origin" );
            level.fulton_destroy.juggheli_spawner_jammer5_3 delete();
        }

        if ( isdefined( level.fulton_destroy.script_noteworthy ) && level.removelinkdamagemodifierontimeout == level._id_128C4 )
        {
            if ( level.fulton_destroy.script_noteworthy == "end" )
                var_1 = getent( level.fulton_destroy.script_noteworthy, "targetname" );
        }
        else
            var_1 = getent( level.fulton_destroy.target, "targetname" );

        level.player notify( "newcheckpoint" );
        level.player setclientomnvar( "ui_edge_glow_trials", 255 );
        level.player scripts\engine\utility::delaycall( 0.5, ::setclientomnvar, "ui_edge_glow_trials", 0 );

        if ( level.fulton_destroy.targetname == "StartCheckpoint" || level.fulton_destroy.targetname == "end" || level.fulton_destroy.targetname == "lap" && level.removelinkdamagemodifierontimeout < level._id_128C4 )
        {
            level._id_128B8 = gettime() - gettime() % 100 - level._id_12409;
            level.removematchingents_bycodeclassname = scripts\engine\utility::array_add( level.removematchingents_bycodeclassname, level._id_128B8 );

            if ( level.removelinkdamagemodifierontimeout >= level._id_128C4 )
            {
                if ( level._id_128C4 == 1 )
                    _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level.removelinkdamagemodifierontimeout, "lap_" + level.removelinkdamagemodifierontimeout + "_time", level.removematchingents_bycodeclassname[level.removelinkdamagemodifierontimeout - 1], 0 );

                level.player.vehicle vehicle_turnengineoff();
                level scripts\engine\utility::flag_set( "trial_completed" );
            }
            else
            {
                level._id_12409 = gettime() - gettime() % 100;
                _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level.removelinkdamagemodifierontimeout, "lap_" + level.removelinkdamagemodifierontimeout + "_time", level.removematchingents_bycodeclassname[level.removelinkdamagemodifierontimeout - 1], 0 );
                level.player playsound( "trial_sfx_start" );
                setmusicstate( "" );
                level.removelinkdamagemodifierontimeout++;
                var_3 = "trial_lap_" + level.removelinkdamagemodifierontimeout;
                _debug_rooftop_raid_exfil::_id_128F7( level.removelinkdamagemodifierontimeout, level._id_128C4 );
                _id_12D53();

                if ( level.removelinkdamagemodifierontimeout == level._id_128C4 )
                {
                    var_3 = "trial_lap_final";
                    var_4 = [ "race_final_lap", "race_one_lap" ];
                    level.player scripts\mp\utility\dialog::leaderdialogonplayer( scripts\engine\utility::random( var_4 ) );
                }

                if ( level._id_128B8 <= ( level.trial["tier3"] + level.dogtags.size / 2 * 1000 ) / level._id_128C4 )
                    level.player scripts\mp\utility\dialog::leaderdialogonplayer( "race_good_lap" );
                else if ( level._id_128B8 >= ( level.trial["tier1"] + level.dogtags.size * 1000 ) / level._id_128C4 )
                    level.player scripts\mp\utility\dialog::leaderdialogonplayer( "race_bad_lap" );

                level.player thread scripts\mp\hud_message::showsplash( var_3 );
                level.gunship_assignedtargetmarkers_onnewai = 0;
            }
        }
        else
            level.player playsound( "trial_sfx_success" );

        level._id_128B4 = var_1.origin;
        level.start_timer = var_1.origin;
        level._id_128B3 moveto( level._id_128B4, 0.5, 0.1, 0.3 );
        thread _id_1222E();
    }
}

isdragonsbreath()
{
    var_0 = getentarray( "gate_flare", "targetname" );

    if ( isdefined( var_0[0] ) && var_0[0].model == "misc_wm_flarestick" )
        var_1 = "j_cap";
    else
        var_1 = "TAG_FIRE_FX";

    foreach ( var_3 in var_0 )
    {
        var_4 = var_3 gettagangles( var_1 );
        var_5 = var_3 gettagorigin( var_1 );
        var_6 = spawn( "script_model", var_5 );
        var_6.angles = var_4;
        var_6 linkto( var_3, var_1, ( 1, 0, 0 ), ( 90, 0, 0 ) );
        var_6 setmodel( "tag_origin" );
        var_7 = spawn( "script_model", var_5 );
        var_7.angles = var_4;
        var_7 linkto( var_3, var_1, ( 0, 0, -1.75 ), ( 0, 180, 0 ) );
        var_7 setmodel( "tag_origin" );
        scripts\engine\utility::flag_init( "gate_flares_" + var_3.script_noteworthy );
        thread kothlaststarttime( var_3.script_noteworthy, var_6, var_7 );
    }
}

kothlaststarttime( var_0, var_1, var_2 )
{
    level endon( "trial_completed" );

    for (;;)
    {
        scripts\engine\utility::flag_wait( "gate_flares_" + var_0 );
        playfxontag( level._id_12D4F, var_1, "TAG_ORIGIN" );
        playfxontag( level._id_12D48, var_2, "TAG_ORIGIN" );

        while ( scripts\engine\utility::flag( "gate_flares_" + var_0 ) )
            waitframe();

        stopfxontag( level._id_12D4F, var_1, "TAG_ORIGIN" );
        stopfxontag( level._id_12D48, var_2, "TAG_ORIGIN" );
    }
}

try_add_targetmarkergroup()
{
    level scripts\engine\utility::flag_wait( "trial_completed" );
    thread _debug_rooftop_raid_exfil::_id_128F4( 0 );
    level.player allowmovement( 0 );
    level.player freezecontrols( 1 );
    level notify( "stop_timer" );

    if ( !scripts\engine\utility::flag( "trial_player_death" ) )
    {
        if ( level._id_128C4 == 0 )
        {

        }

        for ( var_0 = 2; var_0 <= level._id_128C4; var_0++ )
            _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( var_0, "lap_" + var_0 + "_time", level.removematchingents_bycodeclassname[var_0 - 1], 0 );

        if ( level._id_128A5.size > 0 )
        {
            _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level._id_128C4 + 1, "dogtag_collected", level.gunnerdamagemodifier, level._id_12717 * -1 );

            if ( level.gunnerdamagemodifier == level._id_128A5.size )
            {
                _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level._id_128C4 + 2, "all_dogtag_collected", 0, -5000 );
                level.gameending = level.gameending - 5000;
            }
        }

        scripts\engine\utility::delaythread( 3, _debug_rooftop_raid_exfil::trial_ui_set_subtime, level.gameendfreezemovement );
        _debug_rooftop_raid_exfil::trial_ui_set_main_time( level.gameending );

        if ( level.gameending <= level.trial["tier3"] )
            level.reward_tier = 3;
        else if ( level.gameending <= level.trial["tier2"] )
            level.reward_tier = 2;
        else if ( level.gameending <= level.trial["tier1"] )
            level.reward_tier = 1;
        else
            level.reward_tier = 0;

        var_1 = game["trial"]["best_reward"];

        if ( level.reward_tier > var_1 )
        {
            game["trial"]["best_reward"] = level.reward_tier;
            _debug_rooftop_raid_exfil::trial_ui_set_reward_tier( level.reward_tier );
        }

        var_2 = game["trial"]["best_time"];

        if ( game["trial"]["best_time"] <= 0 || level.gameending < game["trial"]["best_time"] )
        {
            game["trial"]["best_time"] = level.gameending;
            hud_besttime_update();
            game["trial"]["analytics"]["best_lap1"] = level.removematchingents_bycodeclassname[0];

            if ( isdefined( level.removematchingents_bycodeclassname[1] ) )
                game["trial"]["analytics"]["best_lap2"] = level.removematchingents_bycodeclassname[1];

            if ( isdefined( level.removematchingents_bycodeclassname[2] ) )
                game["trial"]["analytics"]["best_lap3"] = level.removematchingents_bycodeclassname[2];
        }

        if ( level.reward_tier == 3 )
        {
            var_3 = game["music"]["trials_win_high"].size;
            var_4 = randomint( var_3 );
            level.player setplayermusicstate( game["music"]["trials_win_high"][var_4] );
        }
        else if ( level.reward_tier == 2 )
        {
            var_3 = game["music"]["trials_win_mid"].size;
            var_4 = randomint( var_3 );
            level.player setplayermusicstate( game["music"]["trials_win_mid"][var_4] );
        }
        else if ( level.reward_tier == 1 )
        {
            var_3 = game["music"]["trials_win_low"].size;
            var_4 = randomint( var_3 );
            level.player setplayermusicstate( game["music"]["trials_win_low"][var_4] );
        }
        else
        {
            var_3 = game["music"]["trials_loss"].size;
            var_4 = randomint( var_3 );
            level.player setplayermusicstate( game["music"]["trials_loss"][var_4] );
        }
    }
    else if ( scripts\engine\utility::flag( "trial_player_death" ) )
    {
        _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 0 );
        _debug_rooftop_raid_exfil::trial_ui_set_main_time( 0 );
        _debug_rooftop_raid_exfil::trial_ui_set_subtime( 0 );
        setomnvar( "ui_trial_failed", 1 );

        if ( level._id_128A5.size > 0 )
            _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level._id_128C4 + 1, "dogtag_collected", 0, 0 );

        level.player playsound( "trial_sfx_failure" );
        var_3 = game["music"]["trials_loss"].size;
        var_4 = randomint( var_3 );
        level.player setplayermusicstate( game["music"]["trials_loss"][var_4] );
        level._id_128D4 = 1;
        var_5 = 1.25;
        hud_fade_to_black( var_5 );
        wait( var_5 );

        if ( isdefined( level.br_standard_loadout ) )
            level.br_standard_loadout delete();
    }

    waitframe();
    _debug_rooftop_raid_exfil::trial_ui_open_results_screen();
    level._id_128CA = 1;
    _debug_rooftop_raid_exfil::trial_ui_waittill_retry();
    var_6 = game["trial"]["tries_remaining"];

    if ( var_6 > 0 )
        _debug_rooftop_raid_exfil::_id_128C8();
}

player_monitor_death()
{
    _debug_rooftop_raid_exfil::waittill_player_isdefined();
    level.player waittill( "death" );
    level.trial_fail_alt = 1;
    level.player freezecontrols( 1 );
    level.player freezelookcontrols( 1 );
    scripts\engine\utility::flag_set( "trial_player_death" );
    scripts\engine\utility::flag_set( "trial_completed" );
}

_id_12A30()
{
    if ( !isdefined( game["trial"]["best_reward"] ) )
        game["trial"]["best_reward"] = 0;

    if ( isdefined( level._id_128A4 ) )
        var_0 = level._id_128A4;
    else
        var_0 = "dogtag_spawn";

    level.removelinkdamagemodifierontimeout = 1;
    level.gunnerdamagemodifier = 0;
    level.gunship_assignedtargetmarkers_onnewai = 0;
    level.dogtags = scripts\engine\utility::getstructarray( var_0, "script_noteworthy" );
    level._id_12717 = 0;
    level.do_cache_2_prep = 1;
    _debug_rooftop_raid_exfil::_id_128F7( level.removelinkdamagemodifierontimeout, level._id_128C4 );
    _debug_rooftop_raid_exfil::trial_ui_set_subtime( 0 );
    _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 3 );
    thread br_skipending();
    thread hud_besttime_update();
    thread hud_reward_tiers_tracking();
    thread petrograd_interaction_delayed();
    thread persistantgametypeteamassign();
}

hud_timer()
{
    level endon( "trial_completed" );
    level.gameendfreezemovement = 0;
    level.gameending = 0;
    level._id_12409 = gettime() - gettime() % 100;

    for (;;)
    {
        var_0 = gettime() - gettime() % 100;
        waitframe();

        while ( !scripts\engine\utility::flag( "trial_completed" ) )
        {
            level.gameendfreezemovement = gettime() - gettime() % 100 - var_0;
            level.gameending = level.gameendfreezemovement - level._id_12717;

            if ( level.gameending < 0 )
                _debug_rooftop_raid_exfil::trial_ui_set_subtime( 0 );
            else
                _debug_rooftop_raid_exfil::trial_ui_set_subtime( level.gameending );

            waitframe();
        }
    }

    waitframe();
}

persistantgametypeteamassign()
{
    for ( var_0 = 1; var_0 <= level._id_128C4; var_0++ )
        _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( var_0, "lap_" + var_0 + "_time", 0, 0 );

    if ( level.dogtags.size > 0 )
        _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level._id_128C4 + 1, "dogtag_collected", level.gunnerdamagemodifier, level._id_12717 * -1 );
}

petrograd_interaction_delayed()
{
    self endon( "stop_timer" );

    while ( !isdefined( level.gameending ) )
        waitframe();

    for (;;)
    {
        if ( level.gameending > level.trial["tier3"] - 5000 && level.gameending < level.trial["tier3"] )
        {
            level.player playsound( "trial_sfx_failure_countdown" );
            wait 1;
            continue;
        }

        if ( level.gameending > level.trial["tier2"] - 5000 && level.gameending < level.trial["tier2"] )
        {
            level.player playsound( "trial_sfx_failure_countdown" );
            wait 1;
            continue;
        }

        if ( level.gameending > level.trial["tier1"] - 5000 && level.gameending < level.trial["tier1"] )
        {
            level.player playsound( "trial_sfx_failure_countdown" );
            wait 1;
            continue;
        }

        waitframe();
    }
}

hud_reward_tiers_tracking()
{
    self endon( "stop_timer" );
    self waittill( "trial_in_progress" );
    var_0 = 5;
    var_1 = [];
    var_1[0] = undefined;
    var_1[1] = level.trial["tier1"];
    var_1[2] = level.trial["tier2"];
    var_1[3] = level.trial["tier3"];
    level.reward_tier = 3;

    for (;;)
    {
        var_2 = level.reward_tier;

        if ( level.gameending <= level.trial["tier3"] )
        {
            _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 3 );
            level.reward_tier = 3;
        }
        else if ( level.gameending <= level.trial["tier2"] )
        {
            _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 2 );
            level.reward_tier = 2;
        }
        else if ( level.gameending <= level.trial["tier1"] )
        {
            _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 1 );
            level.reward_tier = 1;
        }
        else
        {
            _debug_rooftop_raid_exfil::trial_ui_set_reward_tier_preview( 0 );
            level.reward_tier = 0;
        }

        if ( level.reward_tier < var_2 )
            level.player playsound( "trial_sfx_failure" );

        waitframe();
    }
}

hud_besttime_update()
{
    var_0 = game["trial"]["best_time"];
    var_1 = game["trial"]["best_reward"];
    _debug_rooftop_raid_exfil::trial_ui_set_best_time( var_0 );
    _debug_rooftop_raid_exfil::trial_ui_set_reward_tier( var_1 );
}

hud_fade_to_black( var_0, var_1 )
{
    var_2 = newhudelem();
    var_2.x = 0;
    var_2.y = 0;
    var_2 setshader( "black", 640, 480 );
    var_2.alignx = "left";
    var_2.aligny = "top";
    var_2.sort = 1;
    var_2.horzalign = "fullscreen";
    var_2.vertalign = "fullscreen";
    var_2.foreground = 1;

    if ( istrue( var_1 ) )
    {
        var_2.alpha = 1;
        var_2 fadeovertime( var_0 );
        var_2.alpha = 0;
    }
    else
    {
        var_2.alpha = 0;
        var_2 fadeovertime( var_0 );
        var_2.alpha = 1;
    }
}

_id_121EE()
{
    var_0 = spawn( "script_model", level._id_128B4 );
    var_0 setmodel( "tag_origin" );
    level._id_12F99 = deleteheadicon( var_0 );
    setheadiconfriendlyimage( level._id_12F99, "icon_waypoint_marker" );
    setheadiconzoffset( level._id_12F99, 1 );
    setheadiconsnaptoedges( level._id_12F99, 0 );
    setheadicondrawthroughgeo( level._id_12F99, 1 );
    setheadiconmaxdistance( level._id_12F99, 0 );
    addclienttoheadiconmask( level._id_12F99, -50 );
    return var_0;
}

_id_1222E()
{
    if ( !isdefined( level._id_12F9C ) )
        level._id_12F9C = scripts\mp\objidpoolmanager::requestobjectiveid( 10 );

    objective_state( level._id_12F9C, "active" );
    objective_position( level._id_12F9C, level.start_timer );
    objective_setplayintro( level._id_12F9C, 0 );
    objective_icon( level._id_12F9C, "icon_waypoint_marker" );
    objective_setbackground( level._id_12F9C, 1 );
    objective_setfadedisabled( level._id_12F9C, 0 );
    objective_setshowoncompass( level._id_12F9C, 1 );
    objective_setminimapiconsize( level._id_12F9C, "icon_regular" );
    objective_setshowdistance( level._id_12F9C, 0 );
    objective_ping( level._id_12F9C );
    objective_setownerteam( level._id_12F9C, level.player.team );
    level scripts\engine\utility::flag_wait( "trial_completed" );
    objective_delete( level._id_12F9C );
}

dialog_init()
{
    game["dialog"]["trial_intro"] = "mp_petrograd_race_intro";
    game["dialog"]["trial_intro_short"] = "mp_petrograd_race_intro_s";
    game["dialog"]["trial_end_tier_0"] = "mp_petrograd_race_0star";
    game["dialog"]["trial_end_tier_0_alt"] = "mp_petrograd_obj_fail";
    game["dialog"]["trial_end_tier_1"] = "mp_petrograd_race_1star";
    game["dialog"]["trial_end_tier_2"] = "mp_petrograd_race_2star";
    game["dialog"]["trial_end_tier_3"] = "mp_petrograd_race_3star";
    game["dialog"]["trial_retry"] = "mp_petrograd_race_intro_s";
    game["dialog"]["fil_hurry_up"] = "mp_petrograd_obj_nag_hurry";
    game["dialog"]["race_move_to_next_checkpoint"] = "mp_petrograd_race_checkpoint";
    game["dialog"]["race_final_lap"] = "mp_petrograd_race_finallap";
    game["dialog"]["race_one_lap"] = "mp_petrograd_race_oneturn";
    game["dialog"]["race_use_atv"] = "mp_petrograd_race_useatv";
    game["dialog"]["race_good_lap"] = "mp_petrograd_race_boost";
    game["dialog"]["race_bad_lap"] = "mp_petrograd_race_front";
    game["dialog"]["race_speed_it_up"] = "mp_petrograd_race_nag";
    scripts\engine\utility::flag_wait( "trial_completed" );
    wait 0.8;
    level.player scripts\mp\utility\dialog::leaderdialogonplayer( "fil_start" );
}

getquestrewardgroupstablerewards()
{
    level endon( "trial_completed" );
    level._id_12740 = 0;
    level._id_12742 = 6;

    for (;;)
    {
        while ( level._id_12740 < level._id_12742 )
        {
            wait 1;
            level._id_12740++;
        }

        if ( isdefined( level.player.vehicle ) )
        {
            if ( randomint( 100 ) < 30 )
                level.player scripts\mp\utility\dialog::leaderdialogonplayer( "race_move_to_next_checkpoint" );
            else
                level.player scripts\mp\utility\dialog::leaderdialogonplayer( "race_speed_it_up" );

            level._id_12742 = level._id_12742 + 3;
        }

        level._id_12740 = 0;
        waitframe();
    }
}

_id_12C67()
{
    level endon( "trial_completed" );

    for (;;)
    {
        thread _debug_rooftop_raid_exfil::_id_128F4( 0 );

        while ( isdefined( level.player.vehicle ) )
            waitframe();

        thread _debug_rooftop_raid_exfil::_id_128F4( 1 );
        level.player thread scripts\mp\utility\dialog::leaderdialogonplayer( "race_use_atv" );

        while ( !isdefined( level.player.vehicle ) )
            waitframe();
    }
}

helirpgenemy()
{
    if ( self.target == "show" )
        self hide();

    while ( !isdefined( level.do_cache_2_prep ) )
        waitframe();

    for (;;)
    {
        if ( level.do_cache_2_prep == float( self.script_noteworthy ) )
        {
            switch ( self.target )
            {
                case "show":
                    self show();
                    break;
                case "hide":
                    self hide();
                    break;
                default:
                    break;
            }

            return;
        }

        waitframe();
    }
}

br_skipending()
{
    level endon( "trial_completed" );
    _debug_rooftop_raid_exfil::waittill_player_isdefined();

    for (;;)
    {
        var_0 = scripts\mp\utility\outline::outlineenableforplayer( level.br_standard_loadout, level.player, "outline_trial_vehicle", "level_script" );

        while ( !isdefined( level.player.vehicle ) )
            waitframe();

        scripts\mp\utility\outline::outlinedisable( var_0, level.br_standard_loadout );

        while ( isdefined( level.player.vehicle ) )
            waitframe();

        waitframe();
    }
}

watchdangerresetaction()
{
    foreach ( var_1 in level.dogtags )
        var_1 thread _id_1223E( var_1, level.player );
}

_id_1223E( var_0, var_1 )
{
    var_2 = 14;
    var_3 = ( 0, 0, 0 );
    var_4 = var_0.angles;

    if ( var_0 scripts\mp\gameobjects::touchingarbitraryuptrigger() )
    {
        var_4 = var_0 getworldupreferenceangles();
        var_3 = anglestoup( var_4 );

        if ( var_3[2] < 0 )
            var_2 = -14;
    }

    var_5[0] = spawn( "script_model", ( 0, 0, 0 ) );
    var_5[0] setmodel( "military_dogtags_iw8_orange" );
    var_6 = spawn( "trigger_radius", ( 0, 0, 0 ), 0, 32, 32 );

    if ( var_0 scripts\mp\gameobjects::touchingarbitraryuptrigger() )
    {
        if ( var_3[2] < 0 )
            var_5[0].angles = var_4;
    }

    var_7 = "any";
    var_8 = scripts\mp\gameobjects::createuseobject( level.player.team, var_6, var_5, ( 0, 0, 16 ) );
    var_8.victim = var_0;
    var_8.victimteam = level.player.team;
    var_9 = var_0.script_parameters;
    var_10 = var_0.origin + ( 0, 0, var_2 );
    var_8.trigger.origin = var_10;
    var_8.visuals[0].origin = var_10;
    var_8.visuals[0].removematchingents_byclassname = var_9;
    var_8.attacker = var_1;
    var_8.attackerteam = var_1.team;
    var_8.ownerteam = scripts\engine\utility::get_enemy_team( level.player.team );

    if ( isdefined( var_8.objidnum ) )
    {
        if ( var_8.objidnum != -1 )
        {
            var_11 = var_8.objidnum;
            scripts\mp\objidpoolmanager::update_objective_position( var_11, var_0.origin + ( 0, 0, 36 ) );
            scripts\mp\objidpoolmanager::update_objective_setbackground( var_11, 1 );
            scripts\mp\objidpoolmanager::objective_set_play_intro( var_8.objidnum, 0 );
            scripts\mp\objidpoolmanager::objective_set_play_outro( var_8.objidnum, 0 );
            var_8 scripts\mp\gameobjects::setobjectivestatusicons( "waypoint_dogtags_friendly", "waypoint_dogtags" );
        }
    }

    var_8.visuals[0] scriptmodelplayanim( "mp_dogtag_spin" );
    level._id_128A5 = scripts\engine\utility::array_add( level._id_128A5, var_8 );
    var_6 waittill( "trigger" );
    var_8 notify( "willdelete" );
    level.gunnerdamagemodifier++;
    level.gunship_assignedtargetmarkers_onnewai++;
    level.player thread scripts\mp\rank::scoreeventpopup( "tag_retrieved" );
    level._id_12717 = 1000 * level.gunnerdamagemodifier;
    _debug_rooftop_raid_exfil::trial_ui_set_stat_and_bonus_time( level._id_128C4 + 1, "dogtag_collected", level.gunnerdamagemodifier, level._id_12717 * -1 );
    level.player playsound( "mp_killconfirm_tags_pickup" );
    var_8 thread scripts\mp\gameobjects::deleteuseobject();

    for ( var_12 = 0; var_12 < var_8.visuals.size; var_12++ )
        var_8.visuals[var_12] delete();
}

hacking_lua_notify_func()
{
    level endon( "trial_completed" );
    self endon( "willdelete" );
    var_0 = getent( self.victim.targetname, "target" );

    while ( isdefined( self ) )
    {
        scripts\mp\gameobjects::disableobject();
        self.visuals[0] hide();
        level scripts\engine\utility::flag_wait( "trial_start" );

        if ( int( self.visuals[0].removematchingents_byclassname ) == 1 && var_0.targetname == "StartCheckpoint" && level.do_cache_2_prep == 1 )
        {
            scripts\mp\gameobjects::enableobject();
            self.visuals[0] show();
        }

        var_0 waittill( "trigger" );

        if ( int( self.visuals[0].removematchingents_byclassname ) == level.removelinkdamagemodifierontimeout && var_0.targetname == level.fulton_destroy.targetname )
        {
            var_1 = distance( self.visuals[0].origin, level.player.origin );
            var_2 = var_1 / 10000;
            self.visuals[0] scripts\engine\utility::delaycall( var_2, ::show );
            scripts\engine\utility::delaythread( var_2, scripts\mp\gameobjects::enableobject );
            playsoundatpos( self.visuals[0].origin, "mp_killconfirm_tags_drop" );
            waitframe();
            level.player waittill( "newcheckpoint" );
            waitframe();
        }
    }
}

heliplayloopropeanim()
{
    var_0 = scripts\engine\utility::getclosest( self.origin, getentarray( "col1", "targetname" ), 250 );
    var_1 = scripts\engine\utility::getclosest( self.origin, getentarray( "col2", "targetname" ), 250 );
    var_2 = scripts\engine\utility::getclosest( self.origin, level.x1opsnpc, 100 );

    if ( isdefined( var_1 ) )
        var_1 notsolid();

    var_3 = var_2.angles;
    var_2 hide();

    while ( !isdefined( level.do_cache_2_prep ) )
        waitframe();

    var_4 = float( self.script_noteworthy );

    while ( level.do_cache_2_prep < var_4 )
        waitframe();

    self rotateto( var_3, 2 );
    wait 2;
    var_2 show();
    self hide();

    if ( isdefined( var_0 ) )
    {
        var_0 notsolid();

        if ( isdefined( var_1 ) )
            var_1 solid();
    }
}

blockreviveanimation()
{
    level._id_1289C = ::_id_128A2;

    if ( !isdefined( game["trial"]["analytics"] ) )
    {
        game["trial"]["analytics"] = [];
        game["trial"]["analytics"]["best_lap1"] = 0;
        game["trial"]["analytics"]["best_lap2"] = 0;
        game["trial"]["analytics"]["best_lap3"] = 0;
    }
}

_id_128A2()
{
    var_0 = level.trial["missionID"];
    var_1 = getomnvar( "ui_trial_reward_tier" );
    var_2 = getomnvar( "ui_trial_best_time" );
    var_3 = int( game["trial"]["analytics"]["best_lap1"] );
    var_4 = int( game["trial"]["analytics"]["best_lap2"] );
    var_5 = int( game["trial"]["analytics"]["best_lap3"] );
    level.player dlog_recordplayerevent( "dlog_event_trial_complete_race", [ "id", var_0, "tier", var_1, "time", var_2, "lap1", var_3, "lap2", var_4, "lap3", var_5 ] );
}

_id_12D53()
{
    foreach ( var_1 in level.course_triggers )
        var_1 thread _id_120E1();

    foreach ( var_1 in level.failedtext )
        var_1 thread init_tracks();
}

_id_120E1()
{
    if ( isdefined( level.course_triggers ) )
    {
        foreach ( var_1 in level.course_triggers )
            var_1 thread _id_12914();
    }
}

_id_12914()
{
    level waittill( "trial_start" );
    self waittill( "trigger" );
    var_0 = scripts\engine\utility::getstructarray( "trigger_smoke_origin", "script_noteworthy" );
    var_1 = scripts\engine\utility::getstructarray( self.target, "targetname" );
    var_2 = scripts\engine\utility::array_intersection( var_0, var_1 );

    foreach ( var_4 in var_2 )
    {
        if ( isdefined( var_4.script_parameters ) )
            wait( float( var_4.script_parameters ) );

        magicgrenademanual( "smoke_grenade_mp", var_4.origin, ( 0, 0, -0.25 ), 0.05 );
    }
}

init_tracks()
{
    if ( isdefined( level.failedtext ) )
    {
        level.explosion = loadfx( "vfx/iw8_mp/gamemode/vfx_search_bombsite_destroy.vfx" );

        foreach ( var_1 in level.failedtext )
            var_1 thread _id_1290B();
    }
}

_id_1290B()
{
    self waittill( "trigger" );
    var_0 = getentarray( "trigger_explosion_origin", "script_noteworthy" );

    foreach ( var_2 in var_0 )
    {
        var_2 setmodel( "tag_origin" );
        playfxontag( level.explosion, var_2, "TAG_ORIGIN" );
        level.player playsound( "iw8_cruise_missile_exp" );
    }
}

keephudhiddentillfadein()
{
    level endon( "trial_completed" );
    wait 2;
    level scripts\engine\utility::flag_wait( "trial_start" );
    var_0 = getent( "StartCheckpoint", "targetname" );
    level._id_1288C = 0;

    for (;;)
    {
        while ( level._id_1288C > 3 )
            waitframe();

        var_1 = spawn( "script_model", var_0.origin );
        var_1 setmodel( "tag_origin" );
        var_1.angles = var_0.angles;
        var_1 rotateby( ( 0, 90, 0 ), 0.1 );
        wait 1;
        var_0.juggheli_spawner_jammer5_3 = var_1;
        playfxontag( scripts\engine\utility::getfx( "circle" ), var_1, "tag_origin" );

        if ( isdefined( var_0.script_noteworthy ) )
        {
            if ( var_0.script_noteworthy == "end" && level.removelinkdamagemodifierontimeout == level._id_128C4 )
            {
                var_2 = getent( var_0.script_noteworthy, "targetname" );
                var_1 = spawn( "script_model", var_2.origin );
                var_1 setmodel( "tag_origin" );
                var_1.angles = var_2.angles;
                var_1 rotateby( ( 90, 0, 0 ), 0.1 );
                wait 1;
                playfxontag( scripts\engine\utility::getfx( "circle" ), var_1, "tag_origin" );
                break;
            }
        }

        waitframe();
        var_0 = getent( var_0.target, "targetname" );
        level._id_1288C++;
    }
}

searchcircleorigin()
{
    level endon( "trial_completed" );
    self.brking_ispointinmovingcircle = self.angles;
    self._id_11FB1 = scripts\engine\utility::getclosest( self.origin, level._id_129D8, 250 );
    self.center = scripts\engine\utility::getclosest( self.origin, level.dialog_monitor_shieldstow, 250 );

    if ( isdefined( self._id_11FB1 ) )
        self._id_11FB1 linkto( self );

    if ( isdefined( self.center ) )
        self.center linkto( self );

    for (;;)
    {
        if ( isdefined( level.br_standard_loadout ) )
        {
            if ( distance( level.br_standard_loadout.origin, self.origin ) < level._id_128CD._id_11BAC * 2 )
            {
                var_0 = level.br_standard_loadout.origin[0] - self.origin[0];
                var_1 = level.br_standard_loadout.origin[1] - self.origin[1];
                var_2 = level.br_standard_loadout.origin[2] - self.origin[2];
                var_3 = var_0 * var_0;
                var_4 = var_1 * var_1;
                var_5 = var_2 * var_2;
                var_6 = sqrt( var_3 + var_4 );
                var_7 = var_0 / var_6;
                var_8 = acos( var_7 );
                var_9 = sqrt( var_3 + var_5 );
                var_10 = var_0 / var_9;
                var_11 = acos( var_10 );

                if ( var_11 > level._id_128CD.train_start_from_struct )
                    var_11 = level._id_128CD.train_start_from_struct;

                if ( var_1 < 0 )
                    self rotateto( ( self.brking_ispointinmovingcircle[0], -1 * var_8, self.brking_ispointinmovingcircle[2] ), 0.1 );
                else
                    self rotateto( ( self.brking_ispointinmovingcircle[0], var_8, self.brking_ispointinmovingcircle[2] ), 0.1 );

                waitframe();
                self.spawn_wheelsons = self.angles;

                if ( var_2 > 0 )
                    self rotateto( ( -1 * var_11, self.spawn_wheelsons[1], self.spawn_wheelsons[2] ), 0.1 );
            }
        }

        waitframe();
    }
}

_id_128AE()
{
    level endon( "trial_completed" );

    while ( !isdefined( level.br_standard_loadout ) || !isdefined( level.player ) )
        waitframe();

    for (;;)
    {
        self._id_12C74 = 0;
        level.player waittill( "shoot_flare" );
        self._id_12C74 = 1;
        wait 4;
    }
}

_id_128AD()
{
    self endon( "death" );

    while ( !isdefined( level.player ) )
        waitframe();

    level.player waittill( "shoot_flare" );
    self detonate();
}

_id_11FBB()
{
    level endon( "trial_completed" );
    level waittill( "trial_start" );

    if ( !istrue( level._id_128CD.oscope_ampl ) )
    {
        self._id_129C0 = deleteheadicon( self );
        setheadiconfriendlyimage( self._id_129C0, level._id_128CD.objectives_finale );
        setheadiconsnaptoedges( self._id_129C0, level._id_128CD.objectivespawner );
        addclienttoheadiconmask( self._id_129C0, level._id_128CD.objloc );
    }

    if ( istrue( level._id_128CD.laser ) )
    {
        self laseron();
        self.laser_on = 1;
    }

    for (;;)
    {
        if ( isdefined( level.br_standard_loadout ) )
        {
            if ( distance( level.br_standard_loadout.origin, self.origin ) <= level._id_128CD._id_11BAC )
            {
                if ( istrue( self._id_12C74 ) )
                {
                    wait 1;
                    continue;
                }

                var_0 = magicbullet( level._id_128CD.current_button_progress, self gettagorigin( level._id_128CD._id_12612 ) + level._id_128CD._id_11FC2, level.br_standard_loadout.origin );

                if ( istrue( level._id_128C6 ) )
                    var_0 thread _id_128AD();

                self hidepart( "tag_rocket" );
                wait( level._id_128CD.is_specops_gametype * 0.5 );
                self showpart( "tag_rocket" );
                wait( level._id_128CD.is_specops_gametype * 0.5 );
            }
        }

        waitframe();
    }
}

_id_128CC( var_0, var_1, var_2, var_3, var_4, var_5, var_6, var_7, var_8, var_9, var_10 )
{
    level._id_128CD = spawnstruct();

    if ( isdefined( var_0 ) )
        level._id_128CD.is_specops_gametype = var_0;
    else
        level._id_128CD.is_specops_gametype = 2.5;

    if ( isdefined( var_9 ) )
        level._id_128CD.train_start_from_struct = var_9;
    else
        level._id_128CD.train_start_from_struct = 35;

    if ( isdefined( var_2 ) )
        level._id_128CD._id_11BAC = var_2;
    else
        level._id_128CD._id_11BAC = 2500;

    if ( isdefined( var_6 ) )
        level._id_128CD.oscope_ampl = var_6;
    else
        level._id_128CD.oscope_ampl = 0;

    if ( isdefined( var_3 ) )
        level._id_128CD.objectivespawner = var_3;
    else
        level._id_128CD.objectivespawner = 4500;

    if ( isdefined( var_4 ) )
        level._id_128CD.objloc = var_4;
    else
        level._id_128CD.objloc = 40;

    if ( isdefined( var_5 ) )
        level._id_128CD.objectives_finale = var_5;
    else
        level._id_128CD.objectives_finale = "icon_navbar_enemy";

    if ( isdefined( var_7 ) )
        level._id_128CD._id_12612 = var_7;
    else
        level._id_128CD._id_12612 = "tag_silencer";

    if ( isdefined( var_8 ) )
        level._id_128CD._id_11FC2 = var_8;
    else
        level._id_128CD._id_11FC2 = ( 30, 0, 10 );

    if ( isdefined( var_1 ) )
        level._id_128CD.current_button_progress = var_1;
    else
        level._id_128CD.current_button_progress = "iw8_la_rpapa7_mp";

    if ( isdefined( var_10 ) )
        level._id_128CD.laser = var_10;
    else
        level._id_128CD.laser = 1;
}
